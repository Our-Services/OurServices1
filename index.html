<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="siteTitle">خدماتنا - تصميم وتطوير المشاريع</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Light Mode Styles (Default) */
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; scroll-behavior: smooth; transition: background-color 0.3s ease, color 0.3s ease; }
        .hero-section { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; padding: 4rem 1rem; border-bottom-left-radius: 50px; border-bottom-right-radius: 50px; }
        .section-heading { position: relative; display: inline-block; margin-bottom: 2rem; font-size: 2.25rem; font-weight: 700; color: #1e293b; }
        .section-heading::after { content: ''; position: absolute; bottom: -8px; right: 0; width: 70%; height: 4px; background-color: #6366f1; border-radius: 2px; }
        .card { background-color: white; border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); padding: 2rem; transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .btn-primary { background-color: #6366f1; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; }
        .btn-primary:hover { background-color: #4f46e5; transform: translateY(-2px); }
        .contact-link { display: inline-flex; align-items: center; background-color: #10b981; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; }
        .contact-link:hover { background-color: #059669; transform: translateY(-2px); }
        .whatsapp-icon { width: 24px; height: 24px; margin-left: 0.5rem; }
        .telegram-icon { width: 24px; height: 24px; margin-left: 0.5rem; fill: white; }
        .navbar { background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); border-bottom-left-radius: 1rem; border-bottom-right-radius: 1rem; transition: background-color 0.3s ease, box-shadow 0.3s ease; }
        .nav-link { color: #334155; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.3s ease, color 0.3s ease; }
        .nav-link:hover { background-color: #e2e8f0; color: #1e293b; }
        .hamburger-icon { display: none; cursor: pointer; flex-direction: column; justify-content: space-between; width: 30px; height: 20px; }
        .hamburger-icon span { display: block; width: 100%; height: 3px; background-color: #334155; border-radius: 2px; transition: all 0.3s ease; }
        .hamburger-icon.open span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        .hamburger-icon.open span:nth-child(2) { opacity: 0; }
        .hamburger-icon.open span:nth-child(3) { transform: translateY(-9px) rotate(-45deg); }

        /* Dark Mode Styles */
        body.dark { background-color: #1a202c; color: #e2e8f0; }
        body.dark .navbar { background-color: rgba(26, 32, 44, 0.95); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); }
        body.dark .nav-link { color: #cbd5e0; }
        body.dark .nav-link:hover { background-color: #2d3748; color: #f7fafc; }
        body.dark .section-heading { color: #f7fafc; }
        body.dark .section-heading::after { background-color: #8b5cf6; }
        body.dark .card { background-color: #2d3748; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1); color: #cbd5e0; }
        body.dark .card h3 { color: #a78bfa; }
        body.dark .card p { color: #cbd5e0; }
        body.dark .hamburger-icon span { background-color: #e2e8f0; }
        body.dark .nav-links-container { background-color: rgba(26, 32, 44, 0.98); }
        body.dark .hero-section .bg-yellow-400 { background-color: #f6ad55; color: #1a202c; }
        body.dark #about-us { background-color: #2d3748; }
        body.dark #contact { background-color: #1a202c; }
        body.dark #comments { background-color: #1a202c; }
        body.dark #darkModeToggle { background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: background-color 0.3s ease; }
        body.dark #darkModeToggle:hover { background-color: rgba(255, 255, 255, 0.1); }
        .dark-mode-icon { width: 24px; height: 24px; color: #334155; }
        body.dark .dark-mode-icon { color: #f7fafc; }

        /* Language Dropdown Styles */
        .language-dropdown-container { position: relative; display: inline-block; }
        .language-dropdown-button { background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: background-color 0.3s ease; display: flex; align-items: center; justify-content: center; font-weight: 500; color: #334155; }
        .language-dropdown-button:hover { background-color: rgba(0, 0, 0, 0.05); }
        body.dark .language-dropdown-button { color: #e2e8f0; }
        body.dark .language-dropdown-button:hover { background-color: rgba(255, 255, 255, 0.1); }
        .language-icon { width: 24px; height: 24px; margin-right: 0.25rem; }
        .language-dropdown-menu { position: absolute; top: 100%; right: 0; background-color: white; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); min-width: 120px; z-index: 1001; overflow: hidden; display: none; }
        body.dark .language-dropdown-menu { background-color: #2d3748; box-shadow: 0 44px 6px rgba(0, 0, 0, 0.3); }
        .language-dropdown-menu.active { display: block; }
        .language-dropdown-menu li { padding: 0.75rem 1rem; cursor: pointer; color: #334155; transition: background-color 0.2s ease; }
        .language-dropdown-menu li:hover { background-color: #e2e8f0; }
        body.dark .language-dropdown-menu li { color: #e2e8f0; }
        body.dark .language-dropdown-menu li:hover { background-color: #4a5568; }

        /* Comment & UI Styles */
        #customAlertModal { transition: opacity 0.3s ease; }
        #customAlertModal.hidden { opacity: 0; pointer-events: none; }
        #customAlertModal .modal-buttons { display: flex; flex-direction: column; justify-content: center; gap: 1rem; margin-top: 1rem; }
        #customAlertModal .modal-buttons button { padding: 0.5rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; }
        #customAlertModal .modal-buttons .confirm-btn { background-color: #ef4444; color: white; }
        #customAlertModal .modal-buttons .confirm-btn:hover { background-color: #dc2626; }
        #customAlertModal .modal-buttons .cancel-btn { background-color: #cbd5e0; color: #334155; }
        body.dark #customAlertModal .modal-buttons .cancel-btn { background-color: #4a5568; color: #e2e8f0; }
        body.dark #customAlertModal .modal-buttons .cancel-btn:hover { background-color: #64748b; }
        #commentsList > div { background-color: #00000009; transition: background-color 0.3s ease, color 0.3s ease; }
        #commentsList > div p { color: rgb(65, 77, 102); }
        body.dark #commentsList > div { background-color: #43526b42; }
        body.dark #commentsList > div p { color: #e2e8f0; }
        .custom-file-input { position: relative; overflow: hidden; display: inline-block; cursor: pointer; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; background-color: #f8fafc; color: #334155; border: 1px solid #e2e8f0; text-align: center; }
        .custom-file-input:hover { background-color: #e2e8f0; border-color: #cbd5e0; }
        .custom-file-input input[type="file"] { position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
        body.dark .custom-file-input { background-color: #334155; color: #e2e8f0; border-color: #475569; }
        body.dark .custom-file-input:hover { background-color: #4a5568; border-color: #64748b; }
        #imagePreview { max-width: 100px; max-height: 100px; margin-top: 1rem; border-radius: 0.5rem; object-fit: cover; }
        #comments input[type="text"], #comments textarea, #developerPasswordInput, #orderForm input[type="text"], #orderForm input[type="email"], #orderForm input[type="tel"], #orderForm select, #orderForm textarea { background-color: #f6f7ff; color: #1a202c; border-color: #e2e8f0; }
        #comments input[type="text"]::placeholder, #comments textarea::placeholder, #developerPasswordInput::placeholder, #orderForm input::placeholder, #orderForm textarea::placeholder { color: #64748b; }
        body.dark #comments input[type="text"], body.dark #comments textarea, body.dark #developerPasswordInput, body.dark #orderForm input, body.dark #orderForm select, body.dark #orderForm textarea { background-color: #334155; color: #e2e8f0; border-color: #475569; }
        body.dark #comments input[type="text"]::placeholder, body.dark #comments textarea::placeholder, body.dark #developerPasswordInput::placeholder, body.dark #orderForm input::placeholder, body.dark #orderForm textarea::placeholder { color: #94a3b8; }
        
        @media (max-width: 767px) {
            .hamburger-icon { display: flex; }
            .nav-links-container { display: none; flex-direction: column; width: 100%; background-color: rgba(255, 255, 255, 0.98); padding-bottom: 1rem; border-radius: 1rem; }
            body.dark .nav-links-container { background-color: rgba(26, 32, 44, 0.98); }
            .nav-links-container.open { display: flex; }
            .nav-link { padding: 0.75rem 1rem; text-align: center; }
        }
        
        #developerModeIndicator { position: fixed; bottom: 4rem; right: 4rem; background-color: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; z-index: 50; display: none; }
        body.dark #developerModeIndicator { background-color: #dc2626; }
        #fullImageModal, #orderModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        #fullImageModal.active, #orderModal.active { opacity: 1; pointer-events: auto; }
        #fullImageModal img { max-width: 90%; max-height: 90%; border-radius: 0.5rem; }
        .comment-image { width: 100px; height: 100px; object-fit: cover; border-radius: 0.5rem; cursor: pointer; transition: transform 0.2s ease; }
        .comment-image:hover { transform: scale(1.05); }

        /* Star Rating Styles */
        .star-rating { display: flex; direction: ltr; align-items: center; gap: 0.125rem; }
        .star-rating svg { width: 1.25rem; height: 1.25rem; color: #cbd5e0; }
        .star-rating.interactive svg { cursor: pointer; }
        .star-rating svg.filled { color: #f59e0b; }
        body.dark .star-rating svg { color: #4a5568; }
        body.dark .star-rating svg.filled { color: #f59e0b; }
        #commentForm .star-rating svg { width: 1.5rem; height: 1.5rem; transition: color 0.2s ease, transform 0.2s ease; }
        #commentForm .star-rating.interactive svg:hover { color: #f59e0b; transform: scale(1.1); }
        
        /* Comment Actions (Like/Dislike) Styles */
        .comment-actions { display: flex; align-items: center; gap: 1rem; margin-top: 0.75rem; }
        .action-btn { background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.35rem; font-size: 0.875rem; color: #64748b; transition: color 0.2s ease; padding: 0.25rem; border-radius: 9999px; }
        .action-btn:hover { color: #1e293b; }
        .action-btn.liked { color: #4f46e5; }
        .action-btn.disliked { color: #ef4444; }
        .action-btn svg { width: 1.2rem; height: 1.2rem; }
        body.dark .action-btn { color: #94a3b8; }
        body.dark .action-btn:hover { color: #e2e8f0; }
        body.dark .action-btn.liked { color: #818cf8; }
        body.dark .action-btn.disliked { color: #f87171; }
        .dev-action-btn { color: #ef4444; }
        body.dark .dev-action-btn { color: #f87171; }
        .dev-action-btn:hover { opacity: 0.7; }
        
        /* Styling for the green 'Order Now' button */
        .btn-order-now {
            background-color: #10B981; /* green-500 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .btn-order-now:hover, .btn-order-now:active {
            background-color: #047857; /* A darker green for hover/active state */
            transform: translateY(-2px);
        }

        /* Styling for the navbar 'Order Now' button */
        .nav-link.order-now-btn {
            background-color: #10B981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .nav-link.order-now-btn:hover, .nav-link.order-now-btn:active {
            background-color: #059669;
            color: white;
            transform: translateY(-2px);
        }

        /* Styling for the popup order form container */
        .order-form-container {
            background-color: white;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Dark mode styling for the popup order form container */
        body.dark .order-form-container {
            background-color: #2d3748; /* Dark gray background */
            color: #e2e8f0; /* Light text for dark mode */
        }

        /* Specific styling for the form submit button in the modal */
        #submitOrderBtn {
            background-color: #10B981; /* green-500 */
        }
        #submitOrderBtn:hover, #submitOrderBtn:active {
            background-color: #047857; /* darker green for hover and active states */
        }

        .custom-file-input {
            position: relative;
            overflow: hidden;
            display: inline-block;
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            background-color: #f8fafc;
            color: #334155;
            border: 1px solid #e2e8f0;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            text-align: center;
        }
        .custom-file-input:hover {
            background-color: #e2e8f0;
            border-color: #cbd5e0;
        }
        .custom-file-input input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        body.dark .custom-file-input {
            background-color: #334155;
            color: #e2e8f0;
            border-color: #475569;
        }
        body.dark .custom-file-input:hover {
            background-color: #4a5568;
            border-color: #64748b;
        }
        
        .device-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #64748b;
            font-size: 0.875rem;
        }

        body.dark .device-info {
            color: #94a3b8;
        }
        
        .file-list-container {
            margin-top: 0.5rem;
        }
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #e2e8f0;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            word-break: break-all;
        }
        body.dark .file-item {
            background-color: #4a5568;
        }
        .file-item .file-name {
            font-size: 0.875rem;
            color: #334155;
        }
        body.dark .file-item .file-name {
            color: #f7fafc;
        }
        .file-item .remove-btn {
            color: #ef4444;
            margin-right: 0.5rem;
            cursor: pointer;
        }
        .file-item .remove-btn:hover {
            color: #b91c1c;
        }

        .map-link {
            text-decoration: underline;
            color: #6366f1;
            transition: color 0.2s ease;
        }
        .map-link:hover {
            color: #4f46e5;
        }
    </style>
</head>
<body class="font-sans antialiased">

    <div id="customAlertModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[2000] hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="customAlertMessage" class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4"></p>
            <div id="customAlertButtons" class="modal-buttons"></div>
        </div>
    </div>

    <div id="fullImageModal">
        <img id="fullImage" src="#" alt="Full size comment image">
    </div>

    <!-- Order Now Modal -->
    <div id="orderModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[3000] hidden">
        <div class="order-form-container p-8 rounded-xl shadow-2xl max-w-lg w-full m-4 relative">
            <button id="closeOrderModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-2xl font-bold text-center mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="orderFormTitle">نموذج طلب خدمة</h2>
            <form id="orderForm" action="https://formspree.io/f/xrbllnal" method="POST" class="space-y-4">
                <div>
                    <label for="orderName" class="block text-sm font-medium" data-lang-key="orderNameLabel">الاسم الكامل:</label>
                    <input type="text" id="orderName" name="name" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderNamePlaceholder" placeholder="الاسم الكامل" required>
                </div>
                <div>
                    <label for="orderEmail" class="block text-sm font-medium" data-lang-key="orderEmailLabel">البريد الإلكتروني:</label>
                    <input type="email" id="orderEmail" name="email" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderEmailPlaceholder" placeholder="yourname@example.com" required>
                </div>
                <div>
                    <label for="orderPhone" class="block text-sm font-medium" data-lang-key="orderPhoneLabel">رقم الهاتف:</label>
                    <input type="tel" id="orderPhone" name="phone" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderPhonePlaceholder" placeholder="+966 50 123 4567" required>
                </div>
                <div>
                    <label for="orderService" class="block text-sm font-medium" data-lang-key="orderServiceLabel">نوع الخدمة المطلوبة:</label>
                    <select id="orderService" name="service" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600">
                        <option value="" data-lang-key="orderServiceSelect" disabled selected>اختر خدمة...</option>
                        <option value="تصميم ثلاثي الأبعاد" data-lang-key="service1Title">تصميم ثلاثي الأبعاد</option>
                        <option value="عروض تقديمية (بوربوينت)" data-lang-key="service2Title">عروض تقديمية (بوربوينت)</option>
                        <option value="تنسيق ملفات إكسل" data-lang-key="service3Title">تنسيق ملفات إكسل</option>
                        <option value="تصاميم هندسية ومخططات" data-lang-key="service4Title">تصاميم هندسية ومخططات</option>
                        <option value="كتابة وتنسيق تقارير" data-lang-key="service5Title">كتابة وتنسيق تقارير</option>
                        <option value="تصميم وتعديل فيديوهات وصور" data-lang-key="service6Title">تصميم وتعديل فيديوهات وصور</option>
                        <option value="برمجة وتطوير مواقع الويب" data-lang-key="service7Title">برمجة وتطوير مواقع الويب</option>
                        <option value="أخرى" data-lang-key="orderServiceOther">أخرى...</option>
                    </select>
                </div>
                <div id="otherServiceField" class="hidden">
                    <label for="otherServiceText" class="block text-sm font-medium" data-lang-key="orderServiceOtherLabel">الرجاء تحديد الخدمة المطلوبة:</label>
                    <input type="text" id="otherServiceText" name="other_service" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderServiceOtherPlaceholder" placeholder="اكتب الخدمة المخصصة هنا...">
                </div>
                <div>
                    <label for="orderMessage" class="block text-sm font-medium" data-lang-key="orderMessageLabel">تفاصيل المشروع:</label>
                    <textarea id="orderMessage" name="details" rows="5" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderMessagePlaceholder" placeholder="اشرح متطلبات مشروعك بالتفصيل..." required></textarea>
                </div>
                <div>
                    <label for="orderFiles" class="block text-sm font-medium" data-lang-key="orderFilesLabel">إضافة صور (اختياري):</label>
                    <div class="relative mt-1">
                        <!-- Updated to accept only image files -->
                        <input type="file" id="orderFiles" name="files" multiple accept="image/jpeg,image/png,image/gif,image/jpg" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                        <div class="custom-file-input"><span id="orderFileInputText" data-lang-key="fileInputChoose">اختيار صور</span></div>
                    </div>
                    <div id="orderImagesPreview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mt-4"></div>
                </div>
                <!-- Geolocation field for the order form -->
                <div id="orderGeolocationField" class="hidden">
                    <input type="hidden" id="orderGeolocation" name="geolocation_link">
                </div>
                <button type="submit" id="submitOrderBtn" class="btn-primary w-full" data-lang-key="orderSubmitBtn">تقديم الطلب</button>
            </form>
        </div>
    </div>

    <nav class="navbar py-4 px-6">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <a href="#hero" class="text-2xl font-bold text-indigo-700" data-lang-key="siteTitle">خدماتنا</a>
            <div class="flex items-center gap-4 sm:gap-6">
                <div class="language-dropdown-container">
                    <button id="languageDropdownButton" class="language-dropdown-button" aria-label="Toggle language dropdown">
                        <svg class="language-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v3h-1c-.9 0-1.64.58-1.9 1.39-.77-2.31-1.04-4.83-.5-7.44h6.89c.54 2.61.27 5.13-.5 7.44zM12 4.07c3.95.49 7 3.85 7 7.93 0 .62-.08 1.21-.21 1.79L15 9V8c0-1.1-.9-2-2-2H9v-.93c.71-.1 1.45-.17 2.21-.17.76 0 1.5.07 2.21.17z"/></svg>
                        <span id="currentLanguageText">AR</span>
                    </button>
                    <!-- Fixed HTML tag from <ul-tag> to <ul> -->
                    <ul id="languageDropdownMenu" class="language-dropdown-menu">
                        <li data-lang="ar">العربية</li>
                        <li data-lang="en">English</li>
                        <li data-lang="zh">中文</li>
                    </ul>
                </div>
                <button id="darkModeToggle" aria-label="Toggle dark mode">
                    <svg class="dark-mode-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path id="darkModeIconPath" d="M12 3a9 9 0 109 9c0-.46-.04-.92-.12-1.36a5.999 5.999 0 01-8.588-8.588C12.92 3.04 12.46 3 12 3z"/></svg>
                </button>
                <div class="hamburger-icon md:hidden" id="hamburger"><span></span><span></span><span></span></div>
                <div class="nav-links-container hidden md:flex gap-6" id="navLinks">
                    <a href="#hero" class="nav-link" data-lang-key="navHome">الرئيسية</a>
                    <a href="#features" class="nav-link" data-lang-key="navWhyChooseUs">لماذا تختارنا؟</a>
                    <a href="#about-us" class="nav-link" data-lang-key="navAboutUs">من نحن؟</a>
                    <a href="#services" class="nav-link" data-lang-key="navServices">ماذا نقدم؟</a>
                    <!-- Re-added "Contact Us" link to navbar -->
                    <a href="#contact" class="nav-link" data-lang-key="navContact">تواصل معنا</a>
                    <a href="#comments" class="nav-link" data-lang-key="navComments">التعليقات</a>
                    <!-- Changed "Order Now" to a button to prevent JS error -->
                    <button id="orderNowNavBtn" class="nav-link text-white bg-indigo-500 hover:bg-indigo-600 rounded-lg px-4 py-2" data-lang-key="orderNowBtn">اطلب الآن</button>
                </div>
            </div>
        </div>
    </nav>

    <header id="hero" class="hero-section text-center">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold mb-4 leading-tight" data-lang-key="heroTitle">مصمم جميع أنواع المشاريع والمواقع والتصاميم والبحوث والواجبات</h1>
            <p class="text-2xl sm:text-3xl font-light mb-8"><span class="bg-yellow-400 text-gray-900 px-4 py-2 rounded-lg shadow-lg inline-block transform -rotate-1 skew-x-2" data-lang-key="heroDiscount">خصم 30% لفترة محدودة على كامل الخدمات</span></p>
            <p class="text-lg sm:text-xl font-light mb-8" data-lang-key="heroSubtitle">نقدم لكم حلولاً متكاملة لتلبية جميع احتياجاتكم الأكاديمية والمهنية</p>
            <!-- New prominent "Order Now" button -->
            <button id="heroOrderNowBtn" class="btn-order-now inline-block text-lg" data-lang-key="orderNowBtn">اطلب الآن</button>
        </div>
    </header>

    <main>
        <section id="features" class="py-16 px-4">
            <div class="max-w-6xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="featuresHeading">لماذا تختارنا؟</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m1.636 6.364l.707-.707M6 21v-1m6.364-1.636l-.707-.707M12 21h-1m-4.636-1.636l-.707.707M3 12h1m-.707-6.364l.707-.707M12 3v1m-6.364 1.636l-.707.707M21 12h-1m-4.636-1.636l-.707-.707M12 21v-1m6.364-1.636l-.707-.707M12 3v1m-6.364 1.636l-.707.707M21 12h-1"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature1Title">تنسيقات شكل رائعة</h3><p class="text-gray-600" data-lang-key="feature1Desc">نقدم العديد من التنسيقات الجمالية التي تبرز عملك.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature2Title">تنسيق كلام احترافي</h3><p class="text-gray-600" data-lang-key="feature2Desc">تنسيق دقيق للمحتوى في البحوث والمشاريع.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature3Title">أكثر من 100 نوع خط</h3><p class="text-gray-600" data-lang-key="feature3Desc">اختر من مجموعة واسعة من الخطوط المميزة.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m-4 8h4m10-8h4m-4 8h4M7 12h10l4-8H3l4 8zm0 0v8a2 2 0 002 2h6a2 2 0 002-2v-8m-12 4h.01M17 12h.01"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature4Title">عروض تقديمية مميزة</h3><p class="text-gray-600" data-lang-key="feature4Desc">تصميم عروض بوربوينت جذابة ومبتكرة.</p></div>
                </div>
            </div>
        </section>

        <section id="about-us" class="py-16 px-4 bg-white">
            <div class="max-w-6xl mx-auto text-center">
                <h2 class="section-heading mb-12" data-lang-key="aboutUsHeading">من نحن؟ </h2>
                <div class="card p-8 md:p-12">
                    <p class="text-lg md:text-xl leading-relaxed text-gray-700" data-lang-key="aboutUsParagraph1">نحن فريق متقدم من خريجي جامعة UCSI الماليزية، نجمع بين المعرفة الأكاديمية العميقة والخبرة العملية الواسعة في تصميم وتنفيذ العديد من المشاريع الكبيرة والصغيرة.</p></div>
        </section>

        <section id="services" class="py-16 px-4">
            <div class="max-w-6xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="servicesHeading">ماذا نقدم؟</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service1Title">تصميم ثلاثي الأبعاد</h3><p class="text-gray-600" data-lang-key="service1Desc">تصميم جميع أنواع القطع ثلاثية الأبعاد على برامج الأوتوكاد وبرامج الطباعة ثلاثية الأبعاد بجميع صيغ الملفات القابلة للطباعة.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service2Title">عروض تقديمية (بوربوينت)</h3><p class="text-gray-600" data-lang-key="service2Desc">تصميم عروض تقديمية على البوربوينت مع كامل التنسيق وإضافة الصور والحركات المرئية.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service3Title">تنسيق ملفات إكسل</h3><p class="text-gray-600" data-lang-key="service3Desc">تصميم وتعديل وتنسيق ملفات إكسل باحترافية عالية.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service4Title">تصاميم هندسية ومخططات</h3><p class="text-gray-600" data-lang-key="service4Desc">تصاميم هندسية، مخططات، كهرباء، وغيرها من الأعمال الهندسية المتخصصة.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service5Title">كتابة وتنسيق تقارير</h3><p class="text-gray-600" data-lang-key="service5Desc">كتابة وتنسيق التقارير على برنامج الوورد بجودة ودقة عالية.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service6Title">تصميم وتعديل فيديوهات وصور</h3><p class="text-gray-600" data-lang-key="service6Desc">تصميم وتعديل الفيديوهات والصور بجودة عالية لتناسب جميع احتياجاتكم.</p></div>
                    <div class="card lg:col-span-3"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service7Title">برمجة وتطوير مواقع الويب</h3><p class="text-gray-600" data-lang-key="service7Desc">برمجة مواقع ويب تفاعلية وجمالية باستخدام لغة JavaScript وتنسيق الشكل باستخدام CSS، مع إضافة الموقع على سيرفر وإنشاء رابط خاص به.</p></div>
                </div>
            </div>
        </section>

        <section id="contact" class="py-16 px-4 bg-gray-100">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="section-heading mb-12" data-lang-key="contactHeading">للتواصل معنا</h2>
                <p class="text-lg md:text-xl mb-8" data-lang-key="contactSubtitle">يسعدنا استقبال استفساراتكم وطلباتكم عبر وسائل التواصل التالية:</p>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-6">
                    <a href="https://wa.me/966500900329" target="_blank" class="contact-link"><svg class="whatsapp-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.58 15.36 3.42 16.92L2.06 22L7.3 20.64C8.86 21.49 10.56 21.94 12.29 21.94H12.04C17.5 21.94 21.95 17.49 21.95 12.04C21.95 6.58 17.5 2 12.04 2ZM17.29 15.5L16.4 17.46C16.14 17.97 15.54 18.15 15.03 17.89C13.97 17.34 12.78 16.71 11.66 15.93C10.27 14.96 9.17 13.82 8.21 12.43C7.43 11.31 6.8 10.12 6.25 9.06C5.99 8.55 6.17 7.95 6.68 7.69L8.64 6.8C9.15 6.54 9.75 6.72 10.01 7.23L10.66 8.59C10.92 9.1 10.74 9.7 10.23 9.96L9.62 10.27C9.28 10.45 9.16 10.86 9.34 11.2C9.89 12.26 10.74 13.11 11.8 13.66C12.14 13.84 12.55 13.72 12.73 13.38L13.04 12.77C13.3 12.26 13.9 12.08 14.41 12.34L15.77 12.99C16.28 13.25 16.46 13.85 16.2 14.36L15.5 15.5ZM12.04 4C16.46 4 20.04 7.58 20.04 12.04C20.04 16.46 16.46 20.04 12.04 20.04C10.61 20.04 9.25 19.68 8.05 18.99L7.66 18.77L4.69 19.53L5.45 16.56L5.23 16.17C4.54 14.97 4.18 13.61 4.18 12.04C4.18 7.58 7.76 4 12.04 4Z"/></svg><span data-lang-key="whatsappNumberKSA">0500900329 داخل المملكة</span></a>
                    <a href="https://wa.me/60163340537" target="_blank" class="contact-link"><svg class="whatsapp-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v3h-1c-.9 0-1.64.58-1.9 1.39-.77-2.31-1.04-4.83-.5-7.44h6.89c.54 2.61.27 5.13-.5 7.44zM12 4.07c3.95.49 7 3.85 7 7.93 0 .62-.08 1.21-.21 1.79L15 9V8c0-1.1-.9-2-2-2H9v-.93c.71-.1 1.45-.17 2.21-.17.76 0 1.5.07 2.21.17z"/></svg><span data-lang-key="whatsappNumberOutsideKSA">+60163340537 خارج المملكة</span></a>
                    <a href="https://t.me/AHMADxx41" target="_blank" class="contact-link bg-blue-500 hover:bg-blue-600"><svg class="telegram-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.35 7.6l-2.45 7.42c-.22.68-.83.92-1.39.63l-2.73-2.1c-.24-.19-.48-.2-.72-.01l-1.35 1.04c-.3.23-.74.07-.82-.3l-.9-4.22c-.09-.43.14-.86.53-1.02l9.08-3.41c.42-.16.85.16.85.6v.01c-.01.35-.13.6-.33.72zm-4.38 5.75l.95-.73c.12-.1.29-.1.41 0l2.36 1.83c.1.08.13.23.07.35l-.83.74c-.08.07-.19.1-.3.07l-2.5-1.92c-.1-.08-.13-.23-.07-.35zm1.53-2.85l-4.52 3.49-1.96-1.51c-.1-.08-.24-.05-.32.06l-.72.93c-.08.1-.06.26.04.34l2.12 1.63c.1.08.24.05.32-.06l5.36-4.13c.1-.08.06-.23-.04-.32l-1.22-1.24c-.11-.11-.27-.11-.38 0z"/></svg><span data-lang-key="telegramContact">التواصل عبر التلجرام</span></a>
                </div>
            </div>
        </section>

        <section id="comments" class="py-16 px-4">
            <div class="max-w-4xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="commentsHeading">التعليقات</h2>
                <div class="card p-8 md:p-12">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="leaveComment">أضف تعليقك</h3>
                    <form id="commentForm" class="space-y-4">
                        <div>
                            <label for="commentName" class="block text-sm font-medium" data-lang-key="commentNameLabel">اسمك:</label>
                            <input type="text" id="commentName" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="commentNamePlaceholder" placeholder="ادخل اسمك" required>
                        </div>
                        <div>
                            <label for="commentText" class="block text-sm font-medium" data-lang-key="commentTextLabel">تعليقك:</label>
                            <textarea id="commentText" rows="4" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="commentTextPlaceholder" placeholder="اكتب تعليقك هنا..." required></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium" data-lang-key="commentRatingLabel">تقييمك:</label>
                            <div id="starRatingInput" class="star-rating interactive flex mt-1"></div>
                            <input type="hidden" id="commentRatingValue" value="0">
                        </div>
                        <div>
                            <label for="commentImage" class="block text-sm font-medium" data-lang-key="commentImageLabel">إضافة صورة (اختياري):</label>
                            <div class="relative mt-1">
                                <input type="file" id="commentImage" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                                <div class="custom-file-input"><span id="fileInputText" data-lang-key="fileInputChoose">اختيار ملف</span></div>
                            </div>
                            <img id="imagePreview" src="#" alt="Image Preview" class="hidden">
                        </div>
                        <button type="submit" class="btn-primary w-full" data-lang-key="commentSubmitBtn">إرسال التعليق</button>
                    </form>
                    <hr class="my-8 border-gray-200 dark:border-gray-600">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="allComments">جميع التعليقات</h3>
                    <div id="commentsList" class="space-y-6">
                        <p id="commentsLoading" class="text-center text-gray-500 dark:text-gray-400" data-lang-key="commentsLoading">جاري تحميل التعليقات...</p>
                        <p id="noComments" class="text-center text-gray-500 dark:text-gray-400 hidden" data-lang-key="noComments">لا توجد تعليقات حتى الآن. كن أول من يعلق!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8 text-center">
        <p id="footerCopyright" data-lang-key="footerText">© 2025 جميع الحقوق محفوظة لفريق التصميم والمشاريع.</p>
    </footer>

    <div id="modeIndicator" class="fixed bottom-4 right-4 bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold z-50">الوضع الفاتح</div>
    <div id="developerModeIndicator" class="hidden">وضع المطور</div>

    <script type="module">
        // Firebase Imports
        // تم تحديث روابط مكتبات Firebase إلى أحدث إصدار لتحسين الأمان والأداء
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, doc, deleteDoc, runTransaction, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Initialization
        // تم استبدال مفاتيح Firebase Config بمفتاح فارغ ليتم توفيره من البيئة تلقائيًا
        const firebaseConfig = {
            apiKey: "",
            authDomain: "ourservices-c5658.firebaseapp.com",
            projectId: "ourservices-c5658",
            storageBucket: "ourservices-c5658.appspot.com",
            messagingSenderId: "951641862997",
            appId: "1:951641862997:web:4744607ef9c0c516d9f5dc",
            measurementId: "G-5LTEVPPJW1"
        };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let app, db, auth, userId;
        let isAuthReady = false;
        let isDeveloperMode = false;
        const DEVELOPER_MODE_SECRET = "Ahmad@2006";
        const GEMINI_API_KEY = "AIzaSyCqjjC8Klto6AtPE1Ac7ucxiS0juSdwM5E";
        const IMGBB_API_KEY = "c6af93a30efee65fec6b505a82033875";
        const FORMSPREE_ENDPOINT = "https://formspree.io/f/xrbllnal";

        // DOM Elements
        const customAlertModal = document.getElementById('customAlertModal');
        const customAlertMessage = document.getElementById('customAlertMessage');
        const customAlertButtons = document.getElementById('customAlertButtons');
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIconPath = document.getElementById('darkModeIconPath');
        const body = document.body;
        const modeIndicator = document.getElementById('modeIndicator');
        const developerModeIndicator = document.getElementById('developerModeIndicator');
        const languageDropdownButton = document.getElementById('languageDropdownButton');
        const languageDropdownMenu = document.getElementById('languageDropdownMenu');
        const commentForm = document.getElementById('commentForm');
        const commentsList = document.getElementById('commentsList');
        const commentsLoading = document.getElementById('commentsLoading');
        const noComments = document.getElementById('noComments');
        const footerCopyright = document.getElementById('footerCopyright');
        const commentImageInput = document.getElementById('commentImage');
        const imagePreview = document.getElementById('imagePreview');
        const fullImageModal = document.getElementById('fullImageModal');
        const fullImage = document.getElementById('fullImage');
        const fileInputText = document.getElementById('fileInputText');
        const starRatingInputContainer = document.getElementById('starRatingInput');
        const commentRatingValue = document.getElementById('commentRatingValue');
        
        // New Order Form Elements
        const orderModal = document.getElementById('orderModal');
        const closeOrderModal = document.getElementById('closeOrderModal');
        const heroOrderNowBtn = document.getElementById('heroOrderNowBtn');
        const orderNowNavBtn = document.getElementById('orderNowNavBtn');
        const orderForm = document.getElementById('orderForm');
        const orderServiceSelect = document.getElementById('orderService');
        const otherServiceField = document.getElementById('otherServiceField');
        const otherServiceText = document.getElementById('otherServiceText');
        const submitOrderBtn = document.getElementById('submitOrderBtn');
        const orderFilesInput = document.getElementById('orderFiles');
        const orderFileInputText = document.getElementById('orderFileInputText');
        const orderImagesPreview = document.getElementById('orderImagesPreview');
        const orderGeolocationInput = document.getElementById('orderGeolocation');
        
        // List to hold files chosen for the order form
        let orderFiles = [];
        let userLocation = { latitude: null, longitude: null };

        async function initFirebase() {
            try {
                // تم إعداد Firebase Config ليكون جاهزًا للعمل مع بيئة العرض
                const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
                    // Fallback to user's config if not in a controlled environment
                    apiKey: "AIzaSyBbL9kbE7oP5CW4HmZJGCCmZRY2L5wxxkM",
                    authDomain: "ourservices-c5658.firebaseapp.com",
                    projectId: "ourservices-c5658",
                    storageBucket: "ourservices-c5658.appspot.com",
                    messagingSenderId: "951641862997",
                    appId: "1:951641862997:web:4744607ef9c0c516d9f5dc",
                    measurementId: "G-5LTEVPPJW1"
                };

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Use the provided auth token for sign-in
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        loadComments();
                    } else {
                        // Await signInAnonymously to ensure userId is available
                        await signInAnonymously(auth);
                    }
                });
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showAlert("alertFirebaseInitError");
            }
        }
        
        const translations = {
            ar: { 
                siteTitle: "خدماتنا - تصميم وتطوير المشاريع", navHome: "الرئيسية", navWhyChooseUs: "لماذا تختارنا؟", navAboutUs: "من نحن؟", navServices: "ماذا نقدم؟", navContact: "تواصل معنا", navComments: "التعليقات", heroTitle: "مصمم جميع أنواع المشاريع والمواقع والتصاميم والبحوث والواجبات", heroDiscount: "خصم 30% لفترة محدودة على كامل الخدمات", heroSubtitle: "نقدم لكم حلولاً متكاملة لتلبية جميع احتياجاتكم الأكاديمية والمهنية", heroContactBtn: "تواصل معنا الآن", featuresHeading: "لماذا تختارنا؟", feature1Title: "تنسيقات شكل رائعة", feature1Desc: "نقدم العديد من التنسيقات الجمالية التي تبرز عملك.", feature2Title: "تنسيق كلام احترافي", feature2Desc: "تنسيق دقيق للمحتوى في البحوث والمشاريع.", feature3Title: "أكثر من 100 نوع خط", feature3Desc: "اختر من مجموعة واسعة من الخطوط المميزة.", feature4Title: "عروض تقديمية مميزة", feature4Desc: "تصميم عروض بوربوينت جذابة ومبتكرة.", aboutUsHeading: "من نحن؟", aboutUsParagraph1: "نحن فريق متقدم من خريجي جامعة UCSI الماليزية، نجمع بين المعرفة الأكاديمية العميقة والخبرة العملية الواسعة في تصميم وتنفيذ العديد من المشاريع الكبيرة والصغيرة.", aboutUsParagraph2: "نلتزم بتقديم خدمات عالية الجودة بأسعار تنافسية للغاية، مع التركيز الدائم على تحقيق رضا العميل كشعارنا الأول والأخير ✨.", servicesHeading: "ماذا نقدم؟", service1Title: "تصميم ثلاثي الأبعاد", service1Desc: "تصميم جميع أنواع القطع ثلاثية الأبعاد على برامج الأوتوكاد وبرامج الطباعة ثلاثية الأبعاد بجميع صيغ الملفات القابلة للطباعة.", service2Title: "عروض تقديمية (بوربوينت)", service2Desc: "تصميم عروض تقديمية على البوربوينت مع كامل التنسيق وإضافة الصور والحركات المرئية.", service3Title: "تنسيق ملفات إكسل", service3Desc: "تصميم وتعديل وتنسيق ملفات إكسل باحترافية عالية.", service4Title: "تصاميم هندسية ومخططات", service4Desc: "تصاميم هندسية، مخططات، كهرباء، وغيرها من الأعمال الهندسية المتخصصة.", service5Title: "كتابة وتنسيق تقارير", service5Desc: "كتابة وتنسيق التقارير على برنامج الوورد بجودة ودقة عالية.", service6Title: "تصميم وتعديل فيديوهات وصور", service6Desc: "تصميم وتعديل الفيديوهات والصور بجودة عالية لتناسب جميع احتياجاتكم.", service7Title: "برمجة وتطوير مواقع الويب", service7Desc: "برمجة مواقع ويب تفاعلية وجمالية باستخدام لغة JavaScript وتنسيق الشكل باستخدام CSS، مع إضافة الموقع على سيرفر وإنشاء رابط خاص به.", contactHeading: "للتواصل معنا", contactSubtitle: "يسعدنا استقبال استفساراتكم وطلباتكم عبر وسائل التواصل التالية:", whatsappNumberKSA: "0500900329 داخل المملكة", whatsappNumberOutsideKSA: "+60163340537 خارج المملكة", telegramContact: "التواصل عبر التلجرام", footerText: "© 2025 جميع الحقوق محفوظة لفريق التصميم والمشاريع.", modeLight: "الوضع الفاتح", modeDark: "الوضع الداكن", commentsHeading: "التعليقات", leaveComment: "أضف تعليقك", commentNameLabel: "اسمك:", commentNamePlaceholder: "ادخل اسمك", commentTextLabel: "تعليقك:", commentTextPlaceholder: "اكتب تعليقك هنا...", commentRatingLabel: "تقييمك:", commentImageLabel: "إضافة صورة (اختياري):", fileInputChoose: "اختيار ملف", fileInputNoFile: "لم يتم اختيار أي ملف", commentSubmitBtn: "إرسال التعليق", allComments: "جميع التعليقات", commentsLoading: "جاري تحميل التعليقات...", noComments: "لا توجد تعليقات حتى الآن. كن أول من يعلق!", commentDateUnavailable: "التاريخ غير متوفر", alertNameTextEmpty: "الرجاء إدخال اسمك.", alertCommentTextEmpty: "الرجاء إدخال تعليقك.", alertCommentAddedSuccess: "تم إرسال تعليقك بنجاح!", alertCommentAddError: "حدث خطأ أثناء إضافة التعليق. الرجاء المحاولة مرة أخرى.", alertFirebaseInitError: "فشل تهيئة Firebase. قد لا تعمل التعليقات بشكل صحيح.", alertFirebaseNotReady: "Firebase غير جاهز بعد. الرجاء الانتظار.", alertDeleteConfirm: "هل أنت متأكد أنك تريد حذف هذا التعليق؟", alertDeleteSuccess: "تم حذف التعليق بنجاح!", alertDeleteError: "حدث خطأ أثناء حذف التعليق. الرجاء المحاولة مرة أخرى.", alertNoPermission: "ليس لديك صلاحية لحذف هذا التعليق.", alertDeveloperModePrompt: "الرجاء إدخال الكود السري للدخول إلى وضع المطور:", alertDeveloperModeSuccess: "تم تفعيل وضع المطور بنجاح!", alertDeveloperModeInvalid: "الكود السري غير صحيح. الرجاء المحاولة مرة أخرى.", alertDeveloperModeExit: "تم الخروج من وضع المطور.", confirmText: "نعم", cancelText: "إلغاء", customAlertClose: "حسناً", developerModeIndicatorText: "وضع المطور", translateBtnText: "ترجمة", translateError: "فشل في الترجمة.", imageUploadError: "فشل رفع الصورة. الرجاء المحاولة مرة أخرى.", resetDislikesConfirm: "هل أنت متأكد من إعادة تعيين الإعجابات السلبية؟", resetDislikesSuccess: "تم إعادة تعيين الإعجابات السلبية بنجاح!", resetDislikesError: "فشل إعادة تعيين الإعجابات السلبية.",
                // New translations for the order form
                orderNowBtn: "اطلب الآن",
                orderFormTitle: "نموذج طلب خدمة",
                orderNameLabel: "الاسم الكامل:",
                orderNamePlaceholder: "الاسم الكامل",
                orderEmailLabel: "البريد الإلكتروني:",
                orderEmailPlaceholder: "yourname@example.com",
                orderPhoneLabel: "رقم الهاتف:",
                orderPhonePlaceholder: "+966 50 123 4567",
                orderServiceLabel: "نوع الخدمة المطلوبة:",
                orderServiceSelect: "اختر خدمة...",
                orderServiceOther: "أخرى...",
                orderServiceOtherLabel: "الرجاء تحديد الخدمة المطلوبة:",
                orderServiceOtherPlaceholder: "اكتب الخدمة المخصصة هنا...",
                orderMessageLabel: "تفاصيل المشروع:",
                orderMessagePlaceholder: "اشرح متطلبات مشروعك بالتفصيل...",
                orderFilesLabel: "إضافة صور (اختياري):", // Added translation
                orderSubmitBtn: "تقديم الطلب",
                orderSuccess: "شكراً لك! تم استلام طلبك بنجاح. سنتواصل معك في أقرب وقت ممكن.",
                orderError: "حدث خطأ أثناء إرسال طلبك. الرجاء المحاولة مرة أخرى.",
                orderFieldRequired: "This field is required.",
                locationUnavailable: "الموقع غير متوفر"
            },
            en: { 
                siteTitle: "Our Services - Project Design & Development", navHome: "Home", navWhyChooseUs: "Why Choose Us?", navAboutUs: "About Us", navServices: "What We Offer?", navContact: "Contact Us", navComments: "Comments", heroTitle: "Designer of all types of projects, websites, designs, research, and assignments", heroDiscount: "30% discount for a limited time on all services", heroSubtitle: "We offer integrated solutions to meet all your academic and professional needs", heroContactBtn: "Contact Us Now", featuresHeading: "Why Choose Us?", feature1Title: "Excellent Visual Formats", feature1Desc: "We provide many aesthetic formats that highlight your work.", feature2Title: "Professional Text Formatting", feature2Desc: "Precise content formatting for research and projects.", feature3Title: "Over 100 Font Types", feature3Desc: "Choose from a wide range of distinctive fonts.", feature4Title: "Outstanding Presentations", feature4Desc: "Designing attractive and innovative PowerPoint presentations.", aboutUsHeading: "Who Are We?", aboutUsParagraph1: "We are an advanced team of UCSI Malaysian University graduates, combining deep academic knowledge with extensive practical experience in designing and implementing many large and small projects.", aboutUsParagraph2: "We are committed to providing high-quality services at highly competitive prices, with a constant focus on achieving customer satisfaction as our first and last motto ✨.", servicesHeading: "What We Offer?", service1Title: "3D Design", service1Desc: "Designing all types of 3D parts on AutoCAD and 3D printing software in all printable file formats.", service2Title: "Presentations (PowerPoint)", service2Desc: "Designing PowerPoint presentations with full formatting and adding images and visual effects.", service3Title: "Excel File Formatting", service3Desc: "Designing, modifying, and formatting Excel files with high professionalism.", service4Title: "Engineering Designs & Plans", service4Desc: "Engineering designs, plans, electrical works, and other specialized engineering works.", service5Title: "Report Writing & Formatting", service5Desc: "Writing and formatting reports in Word with high quality and accuracy.", service6Title: "Video & Photo Design/Editing", service6Desc: "Designing and editing videos and photos with high quality to suit all your needs.", service7Title: "Web Programming & Development", service7Desc: "Programming interactive and aesthetic websites using JavaScript and styling with CSS, including hosting the site on a server and creating a dedicated link.", contactHeading: "Contact Us", contactSubtitle: "We are happy to receive your inquiries and requests via the following channels:", whatsappNumberKSA: "0500900329 Inside KSA", whatsappNumberOutsideKSA: "+60163340537 Outside KSA", telegramContact: "Contact via Telegram", footerText: "© 2025 All rights reserved for the Design and Projects Team.", modeLight: "Light Mode", modeDark: "Dark Mode", commentsHeading: "Comments", leaveComment: "Leave a comment", commentNameLabel: "Your Name:", commentNamePlaceholder: "Enter your name", commentTextLabel: "Your Comment:", commentTextPlaceholder: "Write your comment here...", commentRatingLabel: "Your Rating:", commentImageLabel: "Add an image (optional):", fileInputChoose: "Choose file", fileInputNoFile: "No file chosen", commentSubmitBtn: "Submit Comment", allComments: "All Comments", commentsLoading: "Loading comments...", noComments: "No comments yet. Be the first to comment!", commentDateUnavailable: "Date Unavailable", alertNameTextEmpty: "Please enter your name.", alertCommentTextEmpty: "Please enter your comment.", alertCommentAddedSuccess: "Comment submitted successfully!", alertCommentAddError: "An error occurred while adding the comment. Please try again.", alertFirebaseInitError: "Firebase initialization failed. Comments may not work correctly.", alertFirebaseNotReady: "Firebase is not ready yet. Please wait.", alertDeleteConfirm: "Are you sure you want to delete this comment?", alertDeleteSuccess: "Comment deleted successfully!", alertDeleteError: "An error occurred while deleting the comment. Please try again.", alertNoPermission: "You do not have permission to delete this comment.", alertDeveloperModePrompt: "Please enter the secret code to enter developer mode:", alertDeveloperModeSuccess: "Developer mode activated successfully!", alertDeveloperModeInvalid: "Incorrect secret code. Please try again.", alertDeveloperModeExit: "Exited developer mode.", confirmText: "Yes", cancelText: "Cancel", customAlertClose: "OK", developerModeIndicatorText: "Developer Mode", translateBtnText: "Translate", translateError: "Translation failed.", imageUploadError: "Image upload failed. Please try again.", resetDislikesConfirm: "Are you sure you want to reset the dislikes?", resetDislikesSuccess: "Dislikes reset successfully!", resetDislikesError: "Failed to reset dislikes.",
                // New translations for the order form
                orderNowBtn: "Order Now",
                orderFormTitle: "Service Request Form",
                orderNameLabel: "Full Name:",
                orderNamePlaceholder: "Full Name",
                orderEmailLabel: "Email Address:",
                orderEmailPlaceholder: "yourname@example.com",
                orderPhoneLabel: "Phone Number:",
                orderPhonePlaceholder: "+966 50 123 4567",
                orderServiceLabel: "Requested Service:",
                orderServiceSelect: "Select a service...",
                orderServiceOther: "Other...",
                orderServiceOtherLabel: "Please specify the requested service:",
                orderServiceOtherPlaceholder: "Write your custom service here...",
                orderMessageLabel: "Project Details:",
                orderMessagePlaceholder: "Explain your project requirements in detail...",
                orderFilesLabel: "Add images (optional):",
                orderSubmitBtn: "Submit Request",
                orderSuccess: "Thank you! Your request has been received successfully. We will contact you as soon as possible.",
                orderError: "An error occurred while submitting your request. Please try again.",
                orderFieldRequired: "This field is required.",
                locationUnavailable: "Location unavailable"
            },
            zh: { 
                siteTitle: "我们的服务 - 项目设计与开发", navHome: "首页", navWhyChooseUs: "为什么选择我们？", navAboutUs: "关于我们", navServices: "我们提供什么？", navContact: "联系我们", navComments: "评论", heroTitle: "各类项目、网站、设计、研究和作业的设计师", heroDiscount: "所有服务限时30%折扣", heroSubtitle: "我们提供全面的解决方案，满足您所有的学术和专业需求", heroContactBtn: "立即联系我们", featuresHeading: "为什么选择我们？", feature1Title: "出色的视觉格式", feature1Desc: "我们提供多种美观的格式，突出您的作品。", feature2Title: "专业的文本格式", feature2Desc: "研究和项目内容的精确格式化。", feature3Title: "超过100种字体", feature3Desc: "从各种独特的字体中选择。", feature4Title: "出色的演示文稿", feature4Desc: "设计有吸引力且创新的PowerPoint演示文稿。", aboutUsHeading: "我们是谁？", aboutUsParagraph1: "我们是一支由马来西亚UCSI大学毕业生组成的先进团队，结合了深厚的学术知识和丰富的实践经验，在设计和实施许多大型和小型项目方面。", aboutUsParagraph2: "我们致力于以极具竞争力的价格提供高质量的服务，始终将客户满意度作为我们的首要宗旨✨。", servicesHeading: "我们提供什么？", service1Title: "3D设计", service1Desc: "使用AutoCAD和3D打印软件设计所有类型的3D零件，支持所有可打印文件格式。", service2Title: "演示文稿（PowerPoint）", service2Desc: "设计PowerPoint演示文稿，包括完整的格式设置、图片和视觉效果。", service3Title: "Excel文件格式化", service3Desc: "高专业地设计、修改和格式化Excel文件。", service4Title: "工程设计与规划", service4Desc: "工程设计、规划、电气工程及其他专业工程工作。", service5Title: "报告撰写与格式化", service5Desc: "高质量、高精度地撰写和格式化Word报告。", service6Title: "视频和照片设计/编辑", service6Desc: "高质量地设计和编辑视频和照片，以满足您的所有需求。", service7Title: "网站编程与开发", service7Desc: "使用JavaScript编程交互式和美观的网站，并使用CSS进行样式设置，包括将网站托管到服务器并创建专用链接。", contactHeading: "联系我们", contactSubtitle: "我们很高高兴通过以下方式接收您的咨询和请求：", whatsappNumberKSA: "0500900329 沙特阿拉伯境内", whatsappNumberOutsideKSA: "+60163340537 沙特阿拉伯境外", telegramContact: "通过Telegram联系", footerText: "© 2025 所有权利由设计与项目团队保留。", modeLight: "浅色模式", modeDark: "深色模式", commentsHeading: "评论", leaveComment: "发表评论", commentNameLabel: "您的姓名：", commentNamePlaceholder: "输入您的姓名", commentTextLabel: "您的评论：", commentTextPlaceholder: "在此处撰写您的评论...", commentRatingLabel: "您的评分：", commentImageLabel: "添加图片（可选）：", fileInputChoose: "选择文件", fileInputNoFile: "未选择任何文件", commentSubmitBtn: "提交评论", allComments: "所有评论", commentsLoading: "正在加载评论...", noComments: "暂无评论。成为第一个评论的人！", commentDateUnavailable: "日期不可用", alertNameTextEmpty: "请输入您的姓名。", alertCommentTextEmpty: "请输入您的评论。", alertCommentAddedSuccess: "评论添加成功！", alertCommentAddError: "添加评论时发生错误。请重试。", alertFirebaseInitError: "Firebase初始化失败。评论可能无法正常工作。", alertFirebaseNotReady: "Firebase尚未准备好。请稍候。", alertDeleteConfirm: "您确定要删除此评论吗？", alertDeleteSuccess: "评论删除成功！", alertDeleteError: "删除评论时发生错误。请重试。", alertNoPermission: "您没有权限删除此评论。", alertDeveloperModePrompt: "请输入密码进入开发者模式：", alertDeveloperModeSuccess: "开发者模式已成功激活！", alertDeveloperModeInvalid: "密码不正确。请重试。", alertDeveloperModeExit: "已退出开发者模式。", confirmText: "是", cancelText: "取消", customAlertClose: "确定", developerModeIndicatorText: "开发者模式", translateBtnText: "翻译", translateError: "翻译失败。", imageUploadError: "图片上传失败。请重试。", resetDislikesConfirm: "您确定要重置“不喜欢”吗？", resetDislikesSuccess: "“不喜欢”已成功重置！", resetDislikesError: "重置“不喜欢”失败。",
                // New translations for the order form
                orderNowBtn: "立即订购",
                orderFormTitle: "服务请求表",
                orderNameLabel: "全名：",
                orderNamePlaceholder: "全名",
                orderEmailLabel: "电子邮件地址：",
                orderEmailPlaceholder: "yourname@example.com",
                orderPhoneLabel: "电话号码：",
                orderPhonePlaceholder: "+966 50 123 4567",
                orderServiceLabel: "请求的服务：",
                orderServiceSelect: "选择服务...",
                orderServiceOther: "其他...",
                orderServiceOtherLabel: "请注明所需的服务：",
                orderServiceOtherPlaceholder: "在此处填写您的定制服务...",
                orderMessageLabel: "项目详情：",
                orderMessagePlaceholder: "详细说明您的项目要求...",
                orderFilesLabel: "添加图片（可选）：",
                orderSubmitBtn: "提交请求",
                orderSuccess: "Thank you! Your request has been received successfully. We will contact you as soon as possible.",
                orderError: "An error occurred while submitting your request. Please try again.",
                orderFieldRequired: "This field is required.",
                locationUnavailable: "位置不可用"
            }
        };

        let currentLang = localStorage.getItem('lang') || 'ar';
        const htmlElement = document.documentElement;

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            htmlElement.lang = lang;
            htmlElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const translation = translations[currentLang]?.[key] || translations.en[key];
                if (translation) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
                        element.placeholder = translation;
                        if (element.tagName === 'SELECT' && element.options[0]) {
                            element.options[0].textContent = translation;
                        }
                    } else {
                        element.textContent = translation;
                    }
                }
            });

            // Update text content for option elements manually
            const serviceOptions = orderServiceSelect.options;
            const serviceTitles = [
                'service1Title', 'service2Title', 'service3Title', 'service4Title', 'service5Title', 'service6Title', 'service7Title', 'orderServiceOther'
            ];
            for (let i = 1; i < serviceOptions.length; i++) {
                const key = serviceTitles[i - 1];
                const translation = translations[currentLang]?.[key] || translations.en[key];
                serviceOptions[i].textContent = translation;
            }
            
            document.getElementById('currentLanguageText').textContent = lang.toUpperCase();
            updateModeIndicatorText();
            updateDeveloperModeIndicatorText();
            loadComments();
        }

        function showAlert(messageKey, type = 'alert', onConfirm = null) {
            customAlertMessage.textContent = translations[currentLang][messageKey] || messageKey;
            customAlertButtons.innerHTML = '';
            if (type === 'alert') {
                const closeBtn = document.createElement('button');
                closeBtn.className = 'btn-primary';
                closeBtn.textContent = translations[currentLang].customAlertClose;
                closeBtn.onclick = () => customAlertModal.classList.add('hidden');
                customAlertButtons.appendChild(closeBtn);
            } else if (type === 'confirm') {
                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'confirm-btn';
                confirmBtn.textContent = translations[currentLang].confirmText;
                confirmBtn.onclick = () => { customAlertModal.classList.add('hidden'); if (onConfirm) onConfirm(true); };

                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'cancel-btn';
                cancelBtn.textContent = translations[currentLang].cancelText;
                cancelBtn.onclick = () => { customAlertModal.classList.add('hidden'); if (onConfirm) onConfirm(false); };
                
                customAlertButtons.appendChild(confirmBtn);
                customAlertButtons.appendChild(cancelBtn);
            } else if (type === 'prompt') {
                customAlertButtons.innerHTML = '';
                const passwordInput = document.createElement('input');
                passwordInput.type = 'password';
                passwordInput.id = 'developerPasswordInput';
                passwordInput.className = 'mt-4 block w-full rounded-md shadow-sm p-2';
                passwordInput.placeholder = 'Secret Code...';
                customAlertButtons.appendChild(passwordInput);

                const submitBtn = document.createElement('button');
                submitBtn.className = 'btn-primary mt-4';
                submitBtn.textContent = translations[currentLang].confirmText;
                submitBtn.onclick = () => {
                    if (passwordInput.value === DEVELOPER_MODE_SECRET) {
                        isDeveloperMode = true;
                        customAlertModal.classList.add('hidden');
                        showAlert("alertDeveloperModeSuccess");
                        developerModeIndicator.style.display = 'block';
                        updateDeveloperModeIndicatorText();
                        loadComments();
                    } else {
                        showAlert("alertDeveloperModeInvalid");
                    }
                };
                customAlertButtons.appendChild(submitBtn);
            }
            customAlertModal.classList.remove('hidden');
        }

        hamburger.addEventListener('click', () => {
            navLinks.classList.toggle('hidden');
            navLinks.classList.toggle('open');
            hamburger.classList.toggle('open');
        });

        navLinks.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 767) {
                    navLinks.classList.add('hidden');
                    navLinks.classList.remove('open');
                    hamburger.classList.remove('open');
                }
            });
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const targetId = this.getAttribute('href');
                // Fix: Check for an empty or invalid hash to prevent the SyntaxError
                if (!targetId || targetId === '#') {
                    e.preventDefault();
                    return;
                }
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    e.preventDefault();
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        function updateModeIndicatorText() {
            if (modeIndicator) {
                if (body.classList.contains('dark')) {
                    modeIndicator.textContent = translations[currentLang].modeDark;
                    modeIndicator.className = 'fixed bottom-4 right-4 bg-gray-700 text-gray-100 px-3 py-1 rounded-full text-xs font-semibold z-50';
                } else {
                    modeIndicator.textContent = translations[currentLang].modeLight;
                    modeIndicator.className = 'fixed bottom-4 right-4 bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold z-50';
                }
            }
        }
        
        function applyDarkMode(isDark) {
            if (isDark) {
                body.classList.add('dark');
                darkModeIconPath.setAttribute('d', 'M12 2.5a.5.5 0 01.5.5v2a.5.5 0 01-1 0v-2a.5.5 0 01.5-.5zM18.364 5.636a.5.5 0 01.354.854l-1.414 1.414a.5.5 0 01-.707-.707l1.414-1.414a.5.5 0 01.353-.147zM21.5 12a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM18.364 18.364a.5.5 0 01-.354.854l-1.414-1.414a.5.5 0 01.707.707l1.414 1.414a.5.5 0 01-.353.147zM12 21.5a.5.5 0 01-.5-.5v-2a.5.5 0 011 0v2a.5.5 0 01-.5.5zM5.636 18.364a.5.5 0 01-.354-.854l1.414-1.414a.5.5 0 01.707.707l-1.414 1.414a.5.5 0 01-.353.147zM2.5 12a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM5.636 5.636a.5.5 0 01.354-.854l1.414 1.414a.5.5 0 01-.707.707L5.283 5.99a.5.5 0 01.353-.147zM12 7a5 5 0 100 10 5 5 0 000-10z');
            } else {
                body.classList.remove('dark');
                darkModeIconPath.setAttribute('d', 'M12 3a9 9 0 109 9c0-.46-.04-.92-.12-1.36a5.999 5.999 0 01-8.588-8.588C12.92 3.04 12.46 3 12 3z');
            }
            updateModeIndicatorText();
        }

        darkModeToggle.addEventListener('click', () => {
            const isDark = !body.classList.contains('dark');
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
            applyDarkMode(isDark);
        });

        languageDropdownButton.addEventListener('click', (e) => {
            languageDropdownMenu.classList.toggle('active');
            e.stopPropagation();
        });

        document.addEventListener('click', (e) => {
            if (!languageDropdownMenu.contains(e.target) && !languageDropdownButton.contains(e.target)) {
                languageDropdownMenu.classList.remove('active');
            }
        });

        languageDropdownMenu.querySelectorAll('li').forEach(item => {
            item.addEventListener('click', (e) => {
                setLanguage(e.target.getAttribute('data-lang'));
                languageDropdownMenu.classList.remove('active');
            });
        });
        
        commentImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    imagePreview.src = event.target.result;
                    imagePreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
                fileInputText.textContent = file.name.length > 20 ? file.name.substring(0, 17) + '...' : file.name;
            } else {
                imagePreview.src = '#';
                imagePreview.classList.add('hidden');
                fileInputText.textContent = translations[currentLang].fileInputChoose;
            }
        });

        function setupStarRating(container, input) {
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('span');
                star.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"></path></svg>`;
                star.dataset.value = i;
                container.appendChild(star);
            }
            
            const stars = container.querySelectorAll('span');
            const updateStars = (rating) => {
                stars.forEach(star => star.querySelector('svg').classList.toggle('filled', star.dataset.value <= rating));
            };

            container.addEventListener('click', e => {
                const star = e.target.closest('span');
                if (star) {
                    input.value = star.dataset.value;
                    updateStars(input.value);
                }
            });

            container.addEventListener('mouseover', e => {
                const star = e.target.closest('span');
                if (star) updateStars(star.dataset.value);
            });
            
            container.addEventListener('mouseout', () => updateStars(input.value));
            updateStars(input.value);
        }

        commentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }

            const commentName = document.getElementById('commentName').value.trim();
            const commentText = document.getElementById('commentText').value.trim();
            const rating = parseInt(commentRatingValue.value, 10);
            const commentImageFile = commentImageInput.files[0];

            if (!commentName) { showAlert('alertNameTextEmpty'); return; }
            if (!commentText) { showAlert('alertCommentTextEmpty'); return; }

            let imageUrl = null;
            if (commentImageFile) {
                const formData = new FormData();
                formData.append("image", commentImageFile);
                try {
                    const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
                    const result = await res.json();
                    if (result.success) imageUrl = result.data.url;
                    else throw new Error(result.error.message);
                } catch (err) {
                    console.error("Image upload failed:", err);
                    showAlert("imageUploadError");
                    return;
                }
            }

            // Get device and location info before submitting the comment
            const { device, browser, deviceName } = getDeviceInfo();
            
            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/comments`), {
                    name: commentName,
                    text: commentText,
                    rating,
                    imageUrl,
                    timestamp: serverTimestamp(),
                    userId,
                    likes: 0,
                    dislikes: 0,
                    likedBy: [],
                    dislikedBy: [],
                    device,
                    browser,
                    deviceName,
                    latitude: userLocation.latitude,
                    longitude: userLocation.longitude
                });
                commentForm.reset();
                imagePreview.classList.add('hidden');
                fileInputText.textContent = translations[currentLang].fileInputChoose;
                commentRatingValue.value = "0";
                setupStarRating(starRatingInputContainer, commentRatingValue);
                showAlert("alertCommentAddedSuccess");
            } catch (err) {
                console.error("Error adding comment: ", err);
                showAlert("alertCommentAddError");
            }
        });
        
        function createStarDisplay(rating) {
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                starsHTML += `<svg class="${i <= rating ? 'filled' : ''}" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"></path></svg>`;
            }
            return `<div class="star-rating">${starsHTML}</div>`;
        }
        
        function getDeviceIcon(device) {
            if (device === 'Desktop') {
                return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor"><rect width="20" height="14" x="2" y="3" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>`;
            } else if (device === 'Tablet') {
                return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tablet"><rect width="18" height="14" x="3" y="5" rx="2"/><path d="M7 19h10"/></svg>`;
            } else if (device === 'Mobile') {
                return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smartphone"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>`;
            }
            return '';
        }

        // Updated getDeviceInfo function
        function getDeviceInfo() {
            const userAgent = navigator.userAgent;
            let device = "Desktop";
            let browser = "Unknown";
            let os = "Unknown OS";
            let deviceModel = "";

            if (/(tablet|ipad|playbook)|(android(?!.*mobile))|(kindle)|(silk)|(gt\-p)|(sm\-t)/i.test(userAgent)) {
                device = "Tablet";
            } else if (/(Mobi|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini)/i.test(userAgent)) {
                device = "Mobile";
            }

            if (userAgent.indexOf("Chrome") !== -1 && userAgent.indexOf("Edg") === -1) {
                browser = "Chrome";
            } else if (userAgent.indexOf("Firefox") !== -1) {
                browser = "Firefox";
            } else if (userAgent.indexOf("Safari") !== -1 && userAgent.indexOf("Chrome") === -1) {
                browser = "Safari";
            } else if (userAgent.indexOf("Edge") !== -1) {
                browser = "Edge";
            } else if (userAgent.indexOf("Opera") !== -1 || userAgent.indexOf("OPR") !== -1) {
                browser = "Opera";
            }

            if (userAgent.indexOf("Win") !== -1) os = "Windows";
            if (userAgent.indexOf("Mac") !== -1) os = "MacOS";
            if (userAgent.indexOf("Linux") !== -1) os = "Linux";
            if (userAgent.indexOf("Android") !== -1) os = "Android";
            if (userAgent.match(/iPhone/i)) {
                const iphoneModel = userAgent.match(/iPhone\s(.*?);/i);
                if (iphoneModel && iphoneModel[1]) {
                    deviceModel = `iPhone ${iphoneModel[1].replace(';','')}`;
                } else {
                    deviceModel = 'iPhone';
                }
            } else if (userAgent.match(/iPad/i)) {
                deviceModel = 'iPad';
            } else if (userAgent.match(/Android/i)) {
                const androidModel = userAgent.match(/Android\s[0-9.]+;\s([^;)]*)/i);
                if (androidModel && androidModel[1]) {
                    deviceModel = androidModel[1];
                } else {
                    deviceModel = 'Android Device';
                }
            }
            
            const deviceName = deviceModel ? `${os} - ${deviceModel}` : `${os} - ${device}`;

            return { device, browser, deviceName };
        }

        async function getGeolocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            userLocation = {
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                            };
                            resolve(userLocation);
                        },
                        (error) => {
                            let errorMessage = "Geolocation permission denied or location is unavailable.";
                            if (error.code === error.PERMISSION_DENIED) {
                                errorMessage = "Geolocation permission was denied by the user or disabled by a permissions policy.";
                            } else if (error.message) {
                                errorMessage = `Geolocation error: ${error.message}`;
                            }
                            console.error(errorMessage);
                            userLocation = { latitude: null, longitude: null };
                            resolve(userLocation);
                        }
                    );
                } else {
                    console.log("Geolocation is not supported by this browser.");
                    userLocation = { latitude: null, longitude: null };
                    resolve(userLocation);
                }
            });
        }

        async function handleReaction(commentId, reactionType) {
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }
            const commentRef = doc(db, `artifacts/${appId}/public/data/comments`, commentId);
            try {
                await runTransaction(db, async (transaction) => {
                    const commentDoc = await transaction.get(commentRef);
                    if (!commentDoc.exists()) throw "Document does not exist!";
                    const data = commentDoc.data();
                    let { likes, dislikes, likedBy, dislikedBy } = data;
                    likedBy = likedBy || []; dislikedBy = dislikedBy || [];
                    const hasLiked = likedBy.includes(userId);
                    const hasDisliked = dislikedBy.includes(userId);

                    if (reactionType === 'like') {
                        if (hasLiked) { transaction.update(commentRef, { likes: likes - 1, likedBy: arrayRemove(userId) }); } 
                        else {
                            const updates = { likes: likes + 1, likedBy: arrayUnion(userId) };
                            if (hasDisliked) { updates.dislikes = dislikes - 1; updates.dislikedBy = arrayRemove(userId); }
                            transaction.update(commentRef, updates);
                        }
                    } else if (reactionType === 'dislike') {
                        if (hasDisliked) { transaction.update(commentRef, { dislikes: dislikes - 1, dislikedBy: arrayRemove(userId) }); } 
                        else {
                            const updates = { dislikes: dislikes + 1, dislikedBy: arrayUnion(userId) };
                            if (hasLiked) { updates.likes = likes - 1; updates.likedBy = arrayRemove(userId); }
                            transaction.update(commentRef, updates);
                        }
                    }
                });
            } catch (e) { console.error("Reaction transaction failed: ", e); }
        }
        
        async function resetDislikes(commentId) {
            showAlert("resetDislikesConfirm", 'confirm', async (confirmed) => {
                if (confirmed) {
                    const commentRef = doc(db, `artifacts/${appId}/public/data/comments`, commentId);
                    try {
                        await runTransaction(db, async (t) => t.update(commentRef, { dislikes: 0, dislikedBy: [] }));
                        showAlert("resetDislikesSuccess");
                    } catch (e) { console.error("Error resetting dislikes:", e); showAlert("resetDislikesError"); }
                }
            });
        }

        async function deleteComment(commentId, commentUserId) {
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }
            if (userId !== commentUserId && !isDeveloperMode) { showAlert("alertNoPermission"); return; }
            showAlert("alertDeleteConfirm", 'confirm', async (confirmed) => {
                if (confirmed) {
                    try {
                        await deleteDoc(doc(db, `artifacts/${appId}/public/data/comments`, commentId));
                        showAlert("alertDeleteSuccess");
                    } catch (e) { console.error("Error deleting document: ", e); showAlert("alertDeleteError"); }
                }
            });
        }
        
        const commentTextCache = new Map();
        
        async function translateComment(commentText, originalText, targetLang) {
            if (!originalText) return;
            if (commentText.dataset.lang === targetLang) {
                return;
            }
            if (commentTextCache.has(`${originalText}-${targetLang}`)) {
                commentText.textContent = commentTextCache.get(`${originalText}-${targetLang}`);
                commentText.dataset.lang = targetLang;
                return;
            }

            const fallbackTranslation = {
                'en': 'Translation failed. Please try again later.',
                'ar': 'فشل في الترجمة. الرجاء المحاولة لاحقاً.',
                'zh': '翻译失败。请稍后再试。'
            };

            const prompt = `Translate the following text to the ${targetLang} language. Provide only the translated text, without any additional explanatory phrases like "Here is the translation:":\n\n${originalText}`;
            commentText.textContent = `${translations[currentLang].commentsLoading}...`;

            const maxRetries = 3;
            let currentRetry = 0;
            let successful = false;

            while (currentRetry < maxRetries && !successful) {
                try {
                    const apiKey = GEMINI_API_KEY;
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const payload = { contents: [{ parts: [{ text: prompt }] }] };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.json();
                        console.error("Translation API request failed:", response.status, errorBody);
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content?.parts?.[0]?.text) {
                        const translatedText = result.candidates[0].content.parts[0].text;
                        commentText.textContent = translatedText.trim();
                        commentText.dataset.lang = targetLang;
                        commentTextCache.set(`${originalText}-${targetLang}`, translatedText.trim());
                        successful = true;
                    } else {
                        console.error("Invalid response from translation API:", result);
                        commentText.textContent = fallbackTranslation[targetLang];
                        successful = true;
                    }

                } catch (e) {
                    console.error("Error during translation attempt:", currentRetry + 1, e);
                    if (currentRetry < maxRetries - 1) {
                        await new Promise(res => setTimeout(res, (2 ** currentRetry) * 1000));
                    } else {
                        commentText.textContent = translations[currentLang].translateError;
                    }
                }
                currentRetry++;
            }
        }
        
        async function translateAllComments() {
            const comments = document.querySelectorAll('#commentsList [data-comment-text-id]');
            for (const commentTextElement of comments) {
                const originalText = commentTextElement.dataset.originalText;
                if (originalText) {
                    await translateComment(commentTextElement, originalText, currentLang);
                }
            }
        }


        function loadComments() {
            if (!db) return;
            // تمت إزالة orderBy لتجنب أخطاء الفهرس، وسيتم ترتيب التعليقات في JavaScript
            const q = query(collection(db, `artifacts/${appId}/public/data/comments`));
            const unsubscribe = onSnapshot(q, async (snapshot) => {
                let comments = [];
                snapshot.docs.forEach((doc) => {
                    comments.push({ ...doc.data(), id: doc.id });
                });

                // ترتيب التعليقات باستخدام JavaScript
                comments.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));

                commentsList.innerHTML = '';
                commentsLoading.classList.add('hidden');
                noComments.classList.toggle('hidden', comments.length > 0);

                comments.forEach((comment) => {
                    const commentId = comment.id;
                    const commentElement = document.createElement('div');
                    commentElement.className = 'p-4 rounded-lg shadow-sm relative';
                    commentElement.dataset.commentId = commentId;

                    const hasLiked = comment.likedBy?.includes(userId);
                    const hasDisliked = comment.dislikedBy?.includes(userId);
                    const originalText = comment.text;
                    const commentDate = comment.timestamp ? new Date(comment.timestamp.toDate()).toLocaleString(currentLang) : translations[currentLang].commentDateUnavailable;
                    
                    // Added geolocation to the dev info HTML
                    const geolocationHTML = (comment.latitude && comment.longitude) ? 
                        `<a href="https://www.google.com/maps/search/?api=1&query=${comment.latitude},${comment.longitude}" target="_blank" class="map-link">عرض الموقع</a>` : translations[currentLang].locationUnavailable;

                    const deviceInfoHTML = isDeveloperMode ?
                    `<div class="device-info mt-1">
                        ${getDeviceIcon(comment.device)}
                        <span class="text-xs text-gray-500 dark:text-gray-400">
                            ${comment.deviceName || comment.device || 'Unknown Device'} - ${comment.browser || 'Unknown Browser'}
                        </span>
                        <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                            <span class="mr-1">الموقع:</span>
                            ${geolocationHTML}
                        </div>
                    </div>` : '';

                    commentElement.innerHTML = `
                        <div class="flex items-start justify-between mb-2 gap-4">
                            <div class="flex items-center gap-3">
                                <p class="font-semibold text-indigo-600 dark:text-indigo-300">${comment.name || 'Anonymous'}</p>
                                ${comment.rating > 0 ? createStarDisplay(comment.rating) : ''}
                            </div>
                            <div class="flex items-center flex-shrink-0">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mx-2">${commentDate}</p>
                                ${(userId === comment.userId || isDeveloperMode) ? `
                                    <button class="text-red-500 hover:text-red-700 p-1 rounded-full focus:outline-none ml-1" data-action="delete" aria-label="Delete">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm2 3a1 1 0 011-1h2a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                                    </button>` : ''}
                                ${isDeveloperMode ? `<button class="action-btn dev-action-btn" data-action="reset-dislikes" title="${translations[currentLang].resetDislikesConfirm}"><svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75V4.5h8V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 6a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 6ZM4.5 6.5A.75.75 0 0 1 5.25 6h9.5a.75.75 0 0 1 0 1.5h-9.5A.75.75 0 0 1 4.5 6.5Z" clip-rule="evenodd" /><path d="M6.05 8.05a.75.75 0 0 1 .75.75v6.25a.75.75 0 0 1-1.5 0V8.8a.75.75 0 0 1 .75-.75Zm4.5 0a.75.75 0 0 1 .75.75v6.25a.75.75 0 0 1-1.5 0V8.8a.75.75 0 0 1 .75-.75Zm3.75.75a.75.75 0 0 0-1.5 0v6.25a.75.75 0 0 0 1.5 0V8.8Z" /><path d="M4 5.5a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1V15a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5.5Zm1.5 0a.5.5 0 0 0-.5.5V15a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-9Z" /></svg></button>` : ''}
                            </div>
                        </div>
                        ${deviceInfoHTML}
                        <p class="text-gray-900 dark:text-gray-200 mt-1" data-comment-text-id="${commentId}" data-original-text="${originalText}">${comment.text}</p>
                        ${comment.imageUrl ? `<img src="${comment.imageUrl}" alt="Comment Image" class="mt-4 comment-image" onclick="window.showFullImage('${comment.imageUrl}')">` : ''}
                        <div class="comment-actions">
                            <button class="action-btn ${hasLiked ? 'liked' : ''}" data-action="like" aria-label="Like"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333V19h8.333a2 2 0 001.992-1.838l.93-5.585A2 2 0 0015.333 9H12V4.5a2.5 2.5 0 00-5 0V9H6Z"></path></svg><span>${comment.likes || 0}</span></button>
                            <button class="action-btn ${hasDisliked ? 'disliked' : ''}" data-action="dislike" aria-label="Dislike"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667V1H5.667a2 2 0 00-1.992 1.838l-.93-5.585A2 2 0 004.667 11H8v4.5a2.5 2.5 0 005 0V11h3.333Z"></path></svg><span>${comment.dislikes || 0}</span></button>
                            ${isDeveloperMode ? `<button class="action-btn dev-action-btn" data-action="reset-dislikes" title="${translations[currentLang].resetDislikesConfirm}"><svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75V4.5h8V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 6a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 6ZM4.5 6.5A.75.75 0 0 1 5.25 6h9.5a.75.75 0 0 1 0 1.5h-9.5A.75.75 0 0 1 4.5 6.5Z" clip-rule="evenodd" /><path d="M6.05 8.05a.75.75 0 0 1 .75.75v6.25a.75.75 0 0 1-1.5 0V8.8a.75.75 0 0 1 .75-.75Zm4.5 0a.75.75 0 0 1 .75.75v6.25a.75.75 0 0 1-1.5 0V8.8a.75.75 0 0 1 .75-.75Zm3.75.75a.75.75 0 0 0-1.5 0v6.25a.75.75 0 0 0 1.5 0V8.8Z" /><path d="M4 5.5a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1V15a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5.5Zm1.5 0a.5.5 0 0 0-.5.5V15a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-9Z" /></svg></button>` : ''}
                        </div>`;
                    commentsList.appendChild(commentElement);

                    commentElement.addEventListener('click', (e) => {
                        const button = e.target.closest('button[data-action]');
                        if (!button) return;
                        const action = button.dataset.action;

                        if (action === 'like' || action === 'dislike') {
                            handleReaction(commentId, action);
                        } else if (action === 'delete') {
                            deleteComment(commentId, comment.userId);
                        } else if (action === 'reset-dislikes' && isDeveloperMode) {
                            resetDislikes(commentId);
                        }
                    });
                });
                // After loading all comments, translate them to the current language
                translateAllComments();
            }, (error) => {
                console.error("Error listening to comments:", error);
                commentsLoading.textContent = translations[currentLang].alertCommentAddError;
                commentsLoading.classList.remove('hidden');
            });
        }
        
        let footerClickCount = 0, lastFooterClickTime = 0;
        footerCopyright.addEventListener('click', () => {
            const now = Date.now();
            if (now - lastFooterClickTime < 3000) footerClickCount++; else footerClickCount = 1;
            lastFooterClickTime = now;
            if (footerClickCount === 5) {
                footerClickCount = 0;
                showDeveloperModePrompt();
            }
        });

        function showDeveloperModePrompt() {
            showAlert("alertDeveloperModePrompt", 'prompt');
        }

        function updateDeveloperModeIndicatorText() {
            if (developerModeIndicator) {
                developerModeIndicator.textContent = translations[currentLang].developerModeIndicatorText;
            }
        }
        
        developerModeIndicator.addEventListener('click', () => {
            isDeveloperMode = false;
            developerModeIndicator.style.display = 'none';
            showAlert("alertDeveloperModeExit");
            loadComments();
        });
        
        window.showFullImage = (imageUrl) => {
            fullImage.src = imageUrl;
            fullImageModal.classList.add('active');
        };
        fullImageModal.addEventListener('click', () => fullImageModal.classList.remove('active'));

        // Order Form Logic
        async function showOrderModal() {
            orderModal.classList.add('active');
            // Request geolocation when the modal is shown
            await getGeolocation();
            if (userLocation.latitude && userLocation.longitude) {
                 orderGeolocationInput.value = `https://www.google.com/maps/search/?api=1&query=${userLocation.latitude},${userLocation.longitude}`;
            } else {
                orderGeolocationInput.value = translations[currentLang].locationUnavailable;
            }
        }
        
        function hideOrderModal() {
            orderModal.classList.remove('active');
            orderForm.reset();
            otherServiceField.classList.add('hidden');
            orderFiles = []; // Clear the files array
            updateOrderFilePreview(); // Update the preview
            orderFileInputText.textContent = translations[currentLang].fileInputChoose;
        }

        heroOrderNowBtn.addEventListener('click', showOrderModal);
        orderNowNavBtn.addEventListener('click', showOrderModal);
        closeOrderModal.addEventListener('click', hideOrderModal);
        orderModal.addEventListener('click', (e) => {
            if (e.target === orderModal) {
                hideOrderModal();
            }
        });

        orderServiceSelect.addEventListener('change', (e) => {
            if (e.target.value === 'أخرى') {
                otherServiceField.classList.remove('hidden');
                otherServiceText.setAttribute('required', 'required');
            } else {
                otherServiceField.classList.add('hidden');
                otherServiceText.removeAttribute('required');
            }
        });
        
        function updateOrderFilePreview() {
            orderImagesPreview.innerHTML = '';
            if (orderFiles.length > 0) {
                orderFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'relative flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm';
                    
                    const fileNameSpan = document.createElement('span');
                    fileNameSpan.className = 'text-xs truncate';
                    fileNameSpan.textContent = file.name;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-600';
                    removeBtn.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>`;
                    removeBtn.onclick = (e) => {
                        e.preventDefault();
                        orderFiles.splice(index, 1);
                        updateOrderFilePreview();
                    };

                    fileItem.appendChild(fileNameSpan);
                    fileItem.appendChild(removeBtn);
                    orderImagesPreview.appendChild(fileItem);
                });
                orderFileInputText.textContent = `${orderFiles.length} صور`;
            } else {
                orderFileInputText.textContent = translations[currentLang].fileInputChoose;
            }
        }
        
        orderFilesInput.addEventListener('change', (e) => {
            orderFiles = Array.from(e.target.files).filter(file => file.type.startsWith('image/'));
            updateOrderFilePreview();
            orderFilesInput.value = null; // Reset the input to allow selecting the same file(s) again
        });

        orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            submitOrderBtn.disabled = true;
            submitOrderBtn.textContent = '...إرسال';

            const formData = new FormData(orderForm);
            
            // Remove the original 'files' field
            formData.delete('files');

            let uploadedImageUrls = [];
            if (orderFiles.length > 0) {
                try {
                    const uploadPromises = orderFiles.map(file => {
                        const imgbbFormData = new FormData();
                        imgbbFormData.append("image", file);
                        return fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: imgbbFormData })
                            .then(res => res.json())
                            .then(result => {
                                if (result.success) return result.data.url;
                                throw new Error(result.error.message);
                            });
                    });
                
                    uploadedImageUrls = await Promise.all(uploadPromises);
                    formData.append('images', uploadedImageUrls.join(', '));
                } catch (err) {
                    console.error("Image upload failed:", err);
                    showAlert("imageUploadError");
                    submitOrderBtn.disabled = false;
                    submitOrderBtn.textContent = translations[currentLang].orderSubmitBtn;
                    return;
                }
            }
            
            const { device, browser, deviceName } = getDeviceInfo();

            // Add device and location info to form data
            formData.append('device_name', deviceName);
            formData.append('browser', browser);
            if (userLocation.latitude && userLocation.longitude) {
                // Ensure a link is passed if coordinates are available
                formData.append('location_link', `https://www.google.com/maps/search/?api=1&query=${userLocation.latitude},${userLocation.longitude}`);
            } else {
                // Pass the translated "Location unavailable" message if not available
                formData.append('location_link', translations[currentLang].locationUnavailable);
            }

            try {
                const response = await fetch(FORMSPREE_ENDPOINT, {
                    method: orderForm.method,
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    showAlert("orderSuccess");
                    hideOrderModal();
                } else {
                    const data = await response.json();
                    if (data.errors) {
                        console.error('Formspree errors:', data.errors);
                        showAlert("orderError");
                    } else {
                        console.error('Formspree error:', data);
                        showAlert("orderError");
                    }
                }
            } catch (err) {
                console.error("Error submitting form: ", err);
                showAlert("orderError");
            } finally {
                submitOrderBtn.disabled = false;
                submitOrderBtn.textContent = translations[currentLang].orderSubmitBtn;
            }
        });

        // Initial setup
        initFirebase();
        setupStarRating(starRatingInputContainer, commentRatingValue);
        applyDarkMode(localStorage.getItem('darkMode') === 'enabled');
        // Removed the initial call to getGeolocation() to avoid the console error on page load.
    </script>
</body>
</html>
