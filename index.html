<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title data-lang-key="siteTitle">بوابة الخدمات - تصميم وتطوير المشاريع</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Light Mode Styles (Default) */
        html, body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
            color: #334155; 
            scroll-behavior: smooth; 
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            width: 100%;
            margin: 0;
            padding: 0;
            position: relative;
        }
        .hero-section { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; padding: 4rem 1rem; border-bottom-left-radius: 50px; border-bottom-right-radius: 50px; }
        .section-heading { position: relative; display: inline-block; margin-bottom: 2rem; font-size: 2.25rem; font-weight: 700; color: #1e293b; }
        .section-heading::after { content: ''; position: absolute; bottom: -8px; right: 0; width: 70%; height: 4px; background-color: #6366f1; border-radius: 2px; }
        .card { background-color: white; border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); padding: 2rem; transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .btn-primary { background-color: #6366f1; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; }
        .btn-primary:hover:not(:disabled) { background-color: #4f46e5; transform: translateY(-2px); }
        .btn-primary:disabled { background-color: #a5b4fc; cursor: not-allowed; }
        .btn-danger { background-color: #ef4444; color: white; padding: 0.5rem 1rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease; }
        .btn-danger:hover { background-color: #dc2626; }
        .contact-link { display: inline-flex; align-items: center; background-color: #10b981; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; }
        .contact-link:hover { background-color: #059669; transform: translateY(-2px); }
        .whatsapp-icon { width: 24px; height: 24px; margin-left: 0.5rem; }
        .telegram-icon { width: 24px; height: 24px; margin-left: 0.5rem; fill: white; }
        .navbar { background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); border-bottom-left-radius: 1rem; border-bottom-right-radius: 1rem; transition: background-color 0.3s ease, box-shadow 0.3s ease; }
        .nav-link { color: #334155; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.3s ease, color 0.3s ease; }
        .nav-link:hover { background-color: #e2e8f0; color: #1e293b; }
        .hamburger-icon { display: none; cursor: pointer; flex-direction: column; justify-content: space-between; width: 30px; height: 20px; }
        .hamburger-icon span { display: block; width: 100%; height: 3px; background-color: #334155; border-radius: 2px; transition: all 0.3s ease; }
        .hamburger-icon.open span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        .hamburger-icon.open span:nth-child(2) { opacity: 0; }
        .hamburger-icon.open span:nth-child(3) { transform: translateY(-9px) rotate(-45deg); }
        
        /* Dark Mode Styles */
        body.dark { background-color: #1a202c; color: #e2e8f0; }
        body.dark .navbar { background-color: rgba(26, 32, 44, 0.95); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); }
        body.dark .nav-link { color: #cbd5e0; }
        body.dark .nav-link:hover { background-color: #2d3748; color: #f7fafc; }
        body.dark .section-heading { color: #f7fafc; }
        body.dark .section-heading::after { background-color: #8b5cf6; }
        body.dark .card { background-color: #2d3748; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1); color: #cbd5e0; }
        body.dark .card h3 { color: #a78bfa; }
        body.dark .card p { color: #cbd5e0; }
        body.dark .hamburger-icon span { background-color: #e2e8f0; }
        body.dark .nav-links-container { background-color: rgba(26, 32, 44, 0.98); }
        body.dark .hero-section .bg-yellow-400 { background-color: #f6ad55; color: #1a202c; }
        #developer-dashboard { background-color: #f8fafc; }
        body.dark #developer-dashboard { background-color: #1a202c; }
        body.dark #about-us { background-color: #2d3748; }
        body.dark #contact { background-color: #1a202c; }
        body.dark #comments { background-color: #1a202c; }
        body.dark #darkModeToggle { background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: background-color 0.3s ease; }
        body.dark #darkModeToggle:hover { background-color: rgba(255, 255, 255, 0.1); }
        .dark-mode-icon { width: 24px; height: 24px; color: #334155; }
        body.dark .dark-mode-icon { color: #f7fafc; }

        /* Language Dropdown Styles */
        .language-dropdown-container { position: relative; display: inline-block; }
        .language-dropdown-button { background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: background-color 0.3s ease; display: flex; align-items: center; justify-content: center; font-weight: 500; color: #334155; }
        .language-dropdown-button:hover { background-color: rgba(0, 0, 0, 0.05); }
        body.dark .language-dropdown-button { color: #e2e8f0; }
        body.dark .language-dropdown-button:hover { background-color: rgba(255, 255, 255, 0.1); }
        .language-icon { width: 24px; height: 24px; margin-right: 0.25rem; }
        .language-dropdown-menu { position: absolute; top: 100%; right: 0; background-color: white; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); min-width: 120px; z-index: 1001; overflow: hidden; display: none; }
        body.dark .language-dropdown-menu { background-color: #2d3748; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); }
        .language-dropdown-menu.active { display: block; }
        .language-dropdown-menu li { padding: 0.75rem 1rem; cursor: pointer; color: #334155; transition: background-color 0.2s ease; }
        .language-dropdown-menu li:hover { background-color: #e2e8f0; }
        body.dark .language-dropdown-menu li { color: #e2e8f0; }
        body.dark .language-dropdown-menu li:hover { background-color: #4a5568; }

        /* Comment & UI Styles */
        #customAlertModal { transition: opacity 0.3s ease; }
        #customAlertModal.hidden { opacity: 0; pointer-events: none; }
        #customAlertModal .modal-buttons { display: flex; flex-direction: column; justify-content: center; gap: 1rem; margin-top: 1rem; }
        #customAlertModal .modal-buttons button { padding: 0.5rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; }
        #customAlertModal .modal-buttons .confirm-btn { background-color: #ef4444; color: white; }
        #customAlertModal .modal-buttons .confirm-btn:hover { background-color: #dc2626; }
        #customAlertModal .modal-buttons .cancel-btn { background-color: #cbd5e0; color: #334155; }
        body.dark #customAlertModal .modal-buttons .cancel-btn { background-color: #4a5568; color: #e2e8f0; }
        body.dark #customAlertModal .modal-buttons .cancel-btn:hover { background-color: #64748b; }
        #commentsList > div { background-color: #00000009; transition: background-color 0.3s ease, color 0.3s ease; }
        #commentsList > div p { color: rgb(65, 77, 102); }
        body.dark #commentsList > div { background-color: #43526b42; }
        body.dark #commentsList > div p { color: #e2e8f0; }
        .custom-file-input { position: relative; overflow: hidden; display: inline-block; cursor: pointer; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; background-color: #f8fafc; color: #334155; border: 1px solid #e2e8f0; text-align: center; }
        .custom-file-input:hover { background-color: #e2e8f0; border-color: #cbd5e0; }
        body.dark .custom-file-input { background-color: #334155; color: #e2e8f0; border-color: #475569; }
        body.dark .custom-file-input:hover { background-color: #4a5568; border-color: #64748b; }
        #imagePreview { max-width: 100px; max-height: 100px; margin-top: 1rem; border-radius: 0.5rem; object-fit: cover; }
        
        #comments input[type="text"], #comments textarea, #developerPasswordInput, #orderForm input, #orderForm select, #orderForm textarea, #orderTrackInput, #developer-dashboard input, #developer-dashboard select, #promptInput {
            background-color: #f1f5f9; /* Light mode background */
            color: #1e293b; /* Light mode text */
            border-color: #e2e8f0;
        }
        #comments input[type="text"]::placeholder, #comments textarea::placeholder, #developerPasswordInput::placeholder, #orderForm input::placeholder, #orderForm textarea::placeholder, #orderTrackInput::placeholder, #developer-dashboard input::placeholder, #promptInput::placeholder {
            color: #64748b;
        }
        body.dark #comments input[type="text"], body.dark #comments textarea, body.dark #developerPasswordInput, body.dark #orderForm input, body.dark #orderForm select, body.dark #orderForm textarea, body.dark #orderTrackInput, body.dark #developer-dashboard input, body.dark #developer-dashboard select, body.dark #promptInput {
            background-color: #334155; /* Dark mode background */
            color: #e2e8f0; /* Dark mode text */
            border-color: #475569;
        }
        body.dark #comments input[type="text"]::placeholder, body.dark #comments textarea::placeholder, body.dark #developerPasswordInput::placeholder, body.dark #orderForm input::placeholder, body.dark #orderForm textarea::placeholder, body.dark #orderTrackInput::placeholder, body.dark #developer-dashboard input::placeholder, body.dark #promptInput::placeholder {
            color: #94a3b8;
        }
        
        /* Mobile Responsive Fixes */
        * {
            box-sizing: border-box;
        }
        
        .container, .max-w-4xl, .max-w-6xl {
            max-width: 100%;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        @media (max-width: 767px) {
            .hamburger-icon { display: flex; }
            .nav-links-container { display: none; flex-direction: column; width: 100%; background-color: rgba(255, 255, 255, 0.98); padding-bottom: 1rem; border-radius: 1rem; }
            body.dark .nav-links-container { background-color: rgba(26, 32, 44, 0.98); }
            .nav-links-container.open { display: flex; }
            .nav-link { padding: 0.75rem 1rem; text-align: center; }
            
            /* Mobile specific fixes */
            body {
                overflow-x: hidden !important;
                width: 100vw !important;
                max-width: 100vw !important;
            }
            
            .hero-section {
                padding: 2rem 1rem;
                margin: 0;
                width: 100%;
            }
            
            .section-heading {
                font-size: 1.75rem;
            }
            
            .card {
                margin: 0 auto;
                max-width: 100%;
            }
            
            .loading-screen {
                width: 100vw !important;
                height: 100vh !important;
                left: 0 !important;
                top: 0 !important;
                position: fixed !important;
            }
        }
        
        #developerModeIndicator { position: fixed; bottom: 4rem; right: 4rem; background-color: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; z-index: 50; display: none; }
        body.dark #developerModeIndicator { background-color: #dc2626; }
        #fullImageModal, #orderModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        #fullImageModal.active, #orderModal.active { opacity: 1; pointer-events: auto; }
        #fullImageModal img { max-width: 90%; max-height: 90%; border-radius: 0.5rem; }
        .comment-image { width: 100px; height: 100px; object-fit: cover; border-radius: 0.5rem; cursor: pointer; transition: transform 0.2s ease; }
        .comment-image:hover { transform: scale(1.05); }

        /* Star Rating Styles */
        .star-rating { display: flex; direction: ltr; align-items: center; gap: 0.125rem; }
        .star-rating svg { width: 1.25rem; height: 1.25rem; color: #cbd5e0; }
        .star-rating.interactive svg { cursor: pointer; }
        .star-rating svg.filled { color: #f59e0b; }
        body.dark .star-rating svg { color: #4a5568; }
        body.dark .star-rating svg.filled { color: #f59e0b; }
        #commentForm .star-rating svg { width: 1.5rem; height: 1.5rem; transition: color 0.2s ease, transform 0.2s ease; }
        #commentForm .star-rating.interactive svg:hover { color: #f59e0b; transform: scale(1.1); }
        
        /* Comment Actions (Like/Dislike) Styles */
        .comment-actions { display: flex; align-items: center; gap: 1rem; margin-top: 0.75rem; }
        .action-btn { background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.35rem; font-size: 0.875rem; color: #64748b; transition: color 0.2s ease; padding: 0.25rem; border-radius: 9999px; }
        .action-btn:hover { color: #1e293b; }
        .action-btn.liked { color: #4f46e5; }
        .action-btn.disliked { color: #ef4444; }
        .action-btn svg { width: 1.2rem; height: 1.2rem; }
        body.dark .action-btn { color: #94a3b8; }
        body.dark .action-btn:hover { color: #e2e8f0; }
        body.dark .action-btn.liked { color: #818cf8; }
        body.dark .action-btn.disliked { color: #f87171; }
        .dev-action-btn { color: #ef4444; }
        body.dark .dev-action-btn { color: #f87171; }
        .dev-action-btn:hover { opacity: 0.7; }
        
        .btn-order-now { background-color: #10B981; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; }
        .btn-order-now:hover, .btn-order-now:active { background-color: #047857; transform: translateY(-2px); }
        .btn-track-order { background-color: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; text-decoration: none; }
        .btn-track-order:hover, .btn-track-order:active { background-color: #2563eb; transform: translateY(-2px); }
        .nav-link.order-now-btn { background-color: #10B981; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; }
        .nav-link.order-now-btn:hover, .nav-link.order-now-btn:active { background-color: #059669; color: white; transform: translateY(-2px); }
        .order-form-container { background-color: white; transition: background-color 0.3s ease, color 0.3s ease; }
        body.dark .order-form-container { background-color: #2d3748; color: #e2e8f0; }
        #submitOrderBtn { background-color: #10B981; }
        #submitOrderBtn:hover:not(:disabled), #submitOrderBtn:active { background-color: #047857; }
        #submitOrderBtn:disabled { background-color: #6ee7b7; cursor: not-allowed; }
        .custom-file-input input[type="file"] { position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
        
        .device-info { display: flex; align-items: center; gap: 0.5rem; color: #64748b; font-size: 0.875rem; }
        body.dark .device-info { color: #94a3b8; }
        .file-list-container { margin-top: 0.5rem; }
        .file-item { display: flex; align-items: center; justify-content: space-between; background-color: #e2e8f0; padding: 0.5rem; border-radius: 0.5rem; margin-bottom: 0.5rem; word-break: break-all; }
        body.dark .file-item { background-color: #4a5568; }
        .file-item .file-name { font-size: 0.875rem; color: #334155; }
        body.dark .file-item .file-name { color: #f7fafc; }
        .file-item .remove-btn { color: #ef4444; margin-right: 0.5rem; cursor: pointer; }
        .file-item .remove-btn:hover { color: #b91c1c; }
        .map-link { text-decoration: underline; color: #6366f1; transition: color 0.2s ease; }
        .map-link:hover { color: #4f46e5; }
        .ip-address { color: #4f46e5; font-weight: normal; }
        body.dark .ip-address { color: #a78bfa; }

        /* Order Tracking and Developer Mode Styles */
        .progress-container { position: relative; margin-top: 2rem; padding: 0 10px; }
        .progress-steps-container { display: flex; justify-content: space-between; align-items: flex-start; position: relative; z-index: 2; }
        .progress-step { display: flex; flex-direction: column; align-items: center; text-align: center; flex: 1; }
        .progress-label { margin-top: 0.5rem; font-size: 0.875rem; word-break: break-all; line-height: 1.2; color: #64748b; }
        .progress-label.active { color: #10b981; }
        .progress-label.rejected { color: #ef4444; }
        body.dark .progress-label { color: #a0aec0; }
        body.dark .progress-label.active { color: #10b981; }
        body.dark .progress-label.rejected { color: #f87171; }
        #track-order-section { background-color: #f8fafc; }
        body.dark #track-order-section { background-color: #1a202c; }
        .order-preview-images, .receipt-image-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .order-preview-image, .receipt-image { width: 100px; height: 100px; object-fit: cover; border-radius: 0.5rem; cursor: pointer; transition: transform 0.2s ease; }
        .order-preview-image:hover, .receipt-image:hover { transform: scale(1.05); }
        .dev-order-list { display: flex; overflow-x: auto; gap: 1.5rem; padding: 1rem; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .dev-order-list .card { min-width: 350px; flex-shrink: 0; scroll-snap-align: start; padding: 1.5rem; }
        .invoice-info { background-color: #eef2ff; border-left: 4px solid #6366f1; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; }
        body.dark .invoice-info { background-color: #3730a3; border-left-color: #a78bfa; }
        .rejection-info { background-color: #fee2e2; border-left: 4px solid #ef4444; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; }
        body.dark .rejection-info { background-color: #7f1d1d; border-left-color: #f87171; }
        #receiptSection { background-color: #f0fdf4; border: 1px solid #bbf7d0; margin-top: 1.5rem; padding: 1rem; border-radius: 0.75rem; }
        body.dark #receiptSection { background-color: #166534; border-color: #22c55e; }
        
        /* FIX & NEW: Dev & Customer Payment Method Styles */
        #devPaymentMethodsList > div {
            background-color: #f1f5f9;
            color: #1e293b;
        }
        body.dark #devPaymentMethodsList > div {
            background-color: #334155;
            color: #e2e8f0;
        }
        .bank-accordion-item .accordion-header {
            background-color: #e5e7eb;
            color: #1f2937;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        body.dark .bank-accordion-item .accordion-header {
            background-color: #374151;
            color: #f9fafb;
        }
        .bank-accordion-item .accordion-header:hover {
            background-color: #d1d5db;
        }
        body.dark .bank-accordion-item .accordion-header:hover {
            background-color: #4b5563;
        }
        .bank-accordion-item .accordion-body {
            background-color: #f9fafb;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            padding: 0 1rem;
        }
        body.dark .bank-accordion-item .accordion-body {
            background-color: #1f2937;
        }
        .bank-accordion-item .accordion-body.open {
            max-height: 200px; /* Adjust as needed */
            padding: 1rem;
        }
        .accordion-header .accordion-icon {
            transition: transform 0.3s ease;
        }
        .accordion-header.open .accordion-icon {
            transform: rotate(180deg);
        }

        #togglePaymentBtn {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        body.dark #togglePaymentBtn {
            background-color: #374151;
            color: #f9fafb;
        }


        /* NEW: Copy Notification Style */
        .copy-notification {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #10b981;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none;
        }
        .copy-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        /* UID Modal Styles */
        #uidModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        #uidModal.active {
            opacity: 1;
            pointer-events: auto;
        }
        .uid-modal-content {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        body.dark .uid-modal-content {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        .uid-display {
            background-color: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.875rem;
            word-break: break-all;
            color: #2d3748;
        }
        body.dark .uid-display {
            background-color: #4a5568;
            border-color: #718096;
            color: #e2e8f0;
        }
        .uid-copy-btn {
            background-color: #4f46e5;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin: 0.5rem;
        }
        .uid-copy-btn:hover {
            background-color: #4338ca;
        }
        .uid-close-btn {
            background-color: #6b7280;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin: 0.5rem;
        }
        .uid-close-btn:hover {
            background-color: #4b5563;
        }
        
        /* Copy Notification Styles */
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10000;
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .copy-notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .dark .copy-notification {
            background-color: #059669;
        }
        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease-out, visibility 1s ease-out;
            overflow: hidden;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-logo {
            width: 120px;
            height: 120px;
            margin-bottom: 2rem;
            animation: pulse 2s infinite;
        }
        
        .loading-text {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: center;
            animation: fadeInUp 1s ease-out;
        }
        

        
        .loading-progress {
            width: 200px;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin-top: 1rem;
            overflow: hidden;
            direction: ltr; /* Force LTR for consistent progress bar behavior */
        }
        
        .loading-progress-bar {
            height: 100%;
            background-color: white;
            border-radius: 2px;
            width: 0%;
            animation: loadProgress 3s ease-out forwards;
            transform-origin: left center; /* Ensure animation starts from left */
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes loadProgress {
            0% { width: 0%; }
            25% { width: 30%; }
            50% { width: 60%; }
            75% { width: 85%; }
            100% { width: 100%; }
        }
        
        /* Main content fade in */
        .main-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }
        
        .main-content.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="font-sans antialiased">

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <img src="1754948697784.png" alt="بوابة الخدمات" class="loading-logo" />
        <div class="loading-text" id="loadingTextElement">بوابة الخدمات - تصميم وتطوير المشاريع</div>

        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="customAlertModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[2000] hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="customAlertMessage" class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4"></p>
            <div id="customAlertInputs" class="mb-4"></div>
            <div id="customAlertButtons" class="modal-buttons"></div>
        </div>
    </div>

    <!-- UID Modal -->
    <div id="uidModal">
        <div class="uid-modal-content">
            <h3 class="text-xl font-bold mb-4" data-lang-key="uidModalTitle">معرف المستخدم الخاص بك</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4" data-lang-key="uidModalDescription">هذا هو معرف المستخدم الفريد الخاص بك (UID). يمكنك نسخه واستخدامه لإضافتك كمطور مصرح.</p>
            <div id="uidDisplay" class="uid-display"></div>
            <div class="flex justify-center gap-2">
                <button id="copyUidBtn" class="uid-copy-btn" data-lang-key="copyUidBtn">نسخ UID</button>
                <button id="closeUidModal" class="uid-close-btn" data-lang-key="closeBtn">إغلاق</button>
            </div>
        </div>
    </div>

    <!-- Full Image Modal -->
    <div id="fullImageModal">
        <img id="fullImage" src="#" alt="Full size comment image">
    </div>

    <!-- Order Now Modal -->
    <div id="orderModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[3000] hidden">
        <div class="order-form-container p-8 rounded-xl shadow-2xl max-w-lg w-full m-4 relative overflow-y-auto max-h-screen">
            <button id="closeOrderModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-2xl font-bold text-center mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="orderFormTitle">نموذج طلب خدمة</h2>
            <form id="orderForm" class="space-y-4">
                <div>
                    <label for="orderName" class="block text-sm font-medium" data-lang-key="orderNameLabel">الاسم الكامل:</label>
                    <input type="text" id="orderName" name="name" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="orderNamePlaceholder" placeholder="الاسم الكامل" required>
                </div>
                <div>
                    <label for="orderEmail" class="block text-sm font-medium" data-lang-key="orderEmailLabel">البريد الإلكتروني:</label>
                    <input type="email" id="orderEmail" name="email" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="orderEmailPlaceholder" placeholder="yourname@example.com" required>
                </div>
                <div>
                    <label for="orderPhone" class="block text-sm font-medium" data-lang-key="orderPhoneLabel">رقم الهاتف:</label>
                    <input type="tel" id="orderPhone" name="phone" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="orderPhonePlaceholder" placeholder="+966 50 123 4567" required>
                </div>
                <div>
                    <label for="orderService" class="block text-sm font-medium" data-lang-key="orderServiceLabel">نوع الخدمة المطلوبة:</label>
                    <select id="orderService" name="service" class="mt-1 block w-full rounded-md shadow-sm">
                        <option value="" data-lang-key="orderServiceSelect" disabled selected>اختر خدمة...</option>
                        <option value="تصميم ثلاثي الأبعاد" data-lang-key="service1Title">تصميم ثلاثي الأبعاد</option>
                        <option value="عروض تقديمية (بوربوينت)" data-lang-key="service2Title">عروض تقديمية (بوربوينت)</option>
                        <option value="تنسيق ملفات إكسل" data-lang-key="service3Title">تنسيق ملفات إكسل</option>
                        <option value="تصاميم هندسية ومخططات" data-lang-key="service4Title">تصاميم هندسية ومخططات</option>
                        <option value="كتابة وتنسيق تقارير" data-lang-key="service5Title">كتابة وتنسيق تقارير</option>
                        <option value="تصميم وتعديل فيديوهات وصور" data-lang-key="service6Title">تصميم وتعديل فيديوهات وصور</option>
                        <option value="برمجة وتطوير مواقع الويب" data-lang-key="service7Title">برمجة وتطوير مواقع الويب</option>
                        <option value="تصميم السيرة الذاتية (CV) الاحترافية" data-lang-key="service8Title">تصميم السيرة الذاتية (CV) الاحترافية</option>
                        <option value="كتابة خطاب التقديم (Cover Letter)" data-lang-key="service9Title">كتابة خطاب التقديم (Cover Letter)</option>
                        <option value="إعداد مشاريع التخرج" data-lang-key="service10Title">إعداد مشاريع التخرج</option>
                        <option value="خدمات القبول الجامعي" data-lang-key="service11Title">خدمات القبول الجامعي</option>
                        <option value="تصميم الشعارات والهوية البصرية" data-lang-key="service12Title">تصميم الشعارات والهوية البصرية</option>
                        <option value="تقديم معاهد الجامعات الماليزية للغة الانجليزية" data-lang-key="service13Title">تقديم معاهد الجامعات الماليزية للغة الانجليزية</option>
                        <option value="الحصول على شهادة Linguaskill" data-lang-key="service14Title">الحصول على شهادة Linguaskill</option>
                        <option value="تصوير جوي في كولالمبور بستخدام الدرون" data-lang-key="service15Title">تصوير جوي في كولالمبور بستخدام الدرون</option>
                        <option value="أخرى" data-lang-key="orderServiceOther">أخرى...</option>
                    </select>
                </div>
                <div id="otherServiceField" class="hidden">
                    <label for="otherServiceText" class="block text-sm font-medium" data-lang-key="orderServiceOtherLabel">الرجاء تحديد الخدمة المطلوبة:</label>
                    <input type="text" id="otherServiceText" name="other_service" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="orderServiceOtherPlaceholder" placeholder="اكتب الخدمة المخصصة هنا...">
                </div>
                <div>
                    <label for="orderMessage" class="block text-sm font-medium" data-lang-key="orderMessageLabel">تفاصيل المشروع:</label>
                    <textarea id="orderMessage" name="details" rows="5" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="orderMessagePlaceholder" placeholder="اشرح متطلبات مشروعك بالتفصيل..." required></textarea>
                </div>
                <div>
                    <label for="orderFiles" class="block text-sm font-medium" data-lang-key="orderFilesLabel">إضافة صور (اختياري):</label>
                    <div class="relative mt-1">
                         <input type="file" id="orderFiles" multiple accept="image/jpeg,image/png,image/gif,image/jpg" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                        <div class="custom-file-input"><span id="orderFileInputText" data-lang-key="fileInputChoose">اختيار صور</span></div>
                    </div>
                    <div id="orderImagesPreview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mt-4"></div>
                </div>
                
                <!-- Discount Coupon Section -->
                <div class="coupon-section">
                    <label for="couponCode" class="block text-sm font-medium" data-lang-key="couponLabel">كود الخصم/الدعوة:</label>
                    <div class="flex gap-2 mt-1">
                        <input type="text" id="couponCode" name="coupon_code" class="flex-1 rounded-md shadow-sm" data-lang-key="couponPlaceholder" placeholder="أدخل كود الخصم">
                        <button type="button" id="applyCouponBtn" class="btn-primary px-4 py-2" data-lang-key="applyCouponBtn">تطبيق</button>
                    </div>
                    <div id="couponMessage" class="mt-2 text-sm hidden"></div>
                    <div id="discountInfo" class="mt-2 p-3 bg-green-100 dark:bg-green-800 rounded-md hidden">
                        <p class="text-green-800 dark:text-green-200 font-medium" data-lang-key="discountApplied">تم تطبيق الخصم!</p>
                        <p class="text-green-700 dark:text-green-300"><span data-lang-key="discountPercentage">نسبة الخصم:</span> <span id="discountPercent"></span>%</p>
                        <p class="text-green-700 dark:text-green-300"><span data-lang-key="couponCodeApplied">الكود المطبق:</span> <span id="appliedCouponCode"></span></p>
                    </div>
                </div>
                
                <button type="submit" id="submitOrderBtn" class="btn-primary w-full !bg-green-500 hover:!bg-green-700" data-lang-key="orderSubmitBtn">تقديم الطلب</button>
            </form>
        </div>
    </div>

    <!-- Order Submitted Modal -->
    <div id="orderSubmittedModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[3000] hidden">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl max-w-md w-full m-4 text-center">
            <svg class="mx-auto h-16 w-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <h3 class="mt-4 text-2xl font-bold text-gray-900 dark:text-white" data-lang-key="orderSuccess">تم استلام طلبك بنجاح!</h3>
            <p class="mt-2 text-gray-600 dark:text-gray-400" data-lang-key="orderIdMessage">الرجاء الاحتفاظ برقم طلبك لتتبع حالته:</p>
            <p id="submittedOrderId" class="mt-4 text-4xl font-extrabold text-indigo-600 dark:text-indigo-400 select-all"></p>
            <button id="closeOrderSubmittedModal" class="mt-6 px-6 py-2 btn-primary" data-lang-key="customAlertClose">حسناً</button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content">

    <!-- Navbar -->
    <nav class="navbar py-4 px-6">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <a href="#hero" class="text-2xl font-bold text-indigo-700" data-lang-key="siteTitle">بوابة الخدمات</a>
            <div class="flex items-center gap-4 sm:gap-6">
                <div class="nav-links-container hidden md:flex items-center gap-4 sm:gap-6" id="navLinks">
                    <a href="#hero" class="nav-link" data-lang-key="navHome">الرئيسية</a>
                    <a href="#features" class="nav-link" data-lang-key="navWhyChooseUs">لماذا تختارنا؟</a>
                    <a href="#about-us" class="nav-link" data-lang-key="navAboutUs">من نحن؟</a>
                    <a href="#services" class="nav-link" data-lang-key="navServices">ماذا نقدم؟</a>
                    <a href="#contact" class="nav-link" data-lang-key="navContact">تواصل معنا</a>
                    <a href="#comments" class="nav-link" data-lang-key="navComments">التعليقات</a>
                    <a href="#track-order-section" class="nav-link" data-lang-key="navTrackOrder">تتبع طلبك</a>
                    <button id="orderNowNavBtn" class="nav-link order-now-btn" data-lang-key="orderNowBtn">اطلب الآن</button>
                    <div class="language-dropdown-container">
                        <button id="languageDropdownButton" class="language-dropdown-button" aria-label="Toggle language dropdown">
                            <svg class="language-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v3h-1c-.9 0-1.64.58-1.9 1.39-.77-2.31-1.04-4.83-.5-7.44h6.89c.54 2.61.27 5.13-.5 7.44zM12 4.07c3.95.49 7 3.85 7 7.93 0 .62-.08 1.21-.21 1.79L15 9V8c0-1.1-.9-2-2-2H9v-.93c.71-.1 1.45-.17 2.21-.17.76 0 1.5.07 2.21.17z"/></svg>
                            <span id="currentLanguageText">AR</span>
                        </button>
                        <ul id="languageDropdownMenu" class="language-dropdown-menu">
                            <li data-lang="ar">العربية</li>
                            <li data-lang="en">English</li>
                            <li data-lang="zh">中文</li>
                        </ul>
                    </div>
                    <button id="darkModeToggle" aria-label="Toggle dark mode">
                        <svg class="dark-mode-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path id="darkModeIconPath" d="M12 3a9 9 0 109 9c0-.46-.04-.92-.12-1.36a5.999 5.999 0 01-8.588-8.588C12.92 3.04 12.46 3 12 3z"/></svg>
                    </button>
                </div>
                <div class="hamburger-icon md:hidden" id="hamburger"><span></span><span></span><span></span></div>
            </div>
        </div>
    </nav>

    <header id="hero" class="hero-section text-center">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold mb-4 leading-tight" data-lang-key="heroTitle">مصممون جميع أنواع المشاريع والمواقع والتصاميم والبحوث والواجبات</h1>
            <p class="text-2xl sm:text-3xl font-light mb-8"><span class="bg-yellow-400 text-gray-900 px-4 py-2 rounded-lg shadow-lg inline-block transform -rotate-1 skew-x-2" data-lang-key="heroDiscount">خصم 30% لفترة محدودة على كامل الخدمات</span></p>
            <p class="text-lg sm:text-xl font-light mb-8" data-lang-key="heroSubtitle">نقدم لكم حلولاً متكاملة لتلبية جميع احتياجاتكم الأكاديمية والمهنية</p>
            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-8">
                <button id="heroOrderNowBtn" class="btn-order-now inline-block text-lg" data-lang-key="orderNowBtn">اطلب الآن</button>
                <a href="#track-order-section" id="heroTrackOrderBtn" class="btn-track-order inline-block text-lg" data-lang-key="navTrackOrder">تتبع طلبك</a>
            </div>
        </div>
    </header>

    <main>
        <!-- Features Section -->
        <section id="features" class="py-16 px-4">
            <div class="max-w-6xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="featuresHeading">لماذا تختارنا؟</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Old Features -->
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m1.636 6.364l.707-.707M6 21v-1m6.364-1.636l-.707-.707M12 21h-1m-4.636-1.636l-.707.707M3 12h1m-.707-6.364l.707-.707M12 3v1m-6.364 1.636l-.707.707M21 12h-1m-4.636-1.636l-.707-.707M12 21v-1m6.364-1.636l-.707-.707"/></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature1Title">تنسيقات شكل رائعة </h3><p data-lang-key="feature1Desc">نقدم العديد من التنسيقات الجمالية التي تبرز عملك.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature2Title">تنسيق كلام احترافي</h3><p data-lang-key="feature2Desc">تنسيق دقيق للمحتوى في البحوث والمشاريع.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature3Title">أكثر من 100 نوع خط</h3><p data-lang-key="feature3Desc">اختر من مجموعة واسعة من الخطوط المميزة.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m-4 8h4m10-8h4m-4 8h4M7 12h10l4-8H3l4 8zm0 0v8a2 2 0 002 2h6a2 2 0 002-2v-8m-12 4h.01M17 12h.01"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature4Title">عروض تقديمية مميزة</h3><p data-lang-key="feature4Desc">تصميم عروض بوربوينت جذابة ومبتكرة.</p></div>
                    <!-- NEW Feature 1: 24/7 Support -->
                    <div class="card text-center">
                        <div class="text-indigo-600 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M12 6v6l4 2"></path></svg></div>
                        <h3 class="text-xl font-semibold mb-2" data-lang-key="feature5Title">استجابة سريعة 24/7</h3>
                        <p data-lang-key="feature5Desc">فريقنا متواجد على مدار الساعة للرد على استفساراتكم وتقديم الدعم الفوري لضمان سير العمل بسلاسة.</p>
                    </div>
                    <!-- NEW Feature 2: Precision & Edits -->
                    <div class="card text-center">
                        <div class="text-indigo-600 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg></div>
                        <h3 class="text-xl font-semibold mb-2" data-lang-key="feature6Title">دقة في التنفيذ وتعديلات مرنة</h3>
                        <p data-lang-key="feature6Desc">نلتزم بأعلى معايير الدقة في تنفيذ المشاريع، مع إتاحة إمكانية التعديل لتلبية توقعاتكم بالكامل.</p>
                    </div>
                    <!-- NEW Feature 3: Security & Trust -->
                    <div class="card text-center">
                        <div class="text-indigo-600 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>
                        <h3 class="text-xl font-semibold mb-2" data-lang-key="feature7Title">أمان وموثوقية</h3>
                        <p data-lang-key="feature7Desc">نضمن حقوقك بالكامل. لن تدفع أي مبلغ إلا بعد معاينة مشروعك والتأكد من اكتماله بالشكل المطلوب.</p>
                    </div>
                    <!-- NEW Feature 4: Competitive Prices -->
                    <div class="card text-center">
                        <div class="text-indigo-600 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg></div>
                        <h3 class="text-xl font-semibold mb-2" data-lang-key="feature8Title">أسعار تنافسية</h3>
                        <p data-lang-key="feature8Desc">نقدم خدماتنا بأسعار تنافسية ومنخفضة، مع خصم خاص على أول طلب لك معنا لتجربة خدماتنا المميزة.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Us Section -->
        <section id="about-us" class="py-16 px-4 bg-white">
            <div class="max-w-6xl mx-auto text-center">
                <h2 class="section-heading mb-12" data-lang-key="aboutUsHeading">من نحن؟ </h2>
                <div class="card p-8 md:p-12">
                    <p class="text-lg md:text-xl leading-relaxed" data-lang-key="aboutUsParagraph1">نحن فريق متقدم من خريجي جامعة UCSI الماليزية، نجمع بين المعرفة الأكاديمية العميقة والخبرة العملية الواسعة في تصميم وتنفيذ العديد من المشاريع الكبيرة والصغيرة.</p></div>
        </section>

        <!-- Services Section -->
        <section id="services" class="py-16 px-4">
            <div class="max-w-6xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="servicesHeading">ماذا نقدم؟</h2>
                <div class="flex overflow-x-auto gap-8 pb-4" style="scroll-behavior: smooth;">
                    <!-- العمود الأول -->
                    <div class="grid grid-rows-2 gap-8 min-w-max">
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service1Title">تصميم ثلاثي الأبعاد</h3><p data-lang-key="service1Desc">تصميم جميع أنواع القطع ثلاثية الأبعاد على برامج الأوتوكاد وبرامج الطباعة ثلاثية الأبعاد بجميع صيغ الملفات القابلة للطباعة.</p></div>
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service2Title">عروض تقديمية (بوربوينت)</h3><p data-lang-key="service2Desc">تصميم عروض تقديمية على البوربوينت مع كامل التنسيق وإضافة الصور والحركات المرئية.</p></div>
                    </div>
                    <!-- العمود الثاني -->
                    <div class="grid grid-rows-2 gap-8 min-w-max">
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service3Title">تنسيق ملفات إكسل</h3><p data-lang-key="service3Desc">تصميم وتعديل وتنسيق ملفات إكسل باحترافية عالية.</p></div>
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service4Title">تصاميم هندسية ومخططات</h3><p data-lang-key="service4Desc">تصاميم هندسية، مخططات، كهرباء، وغيرها من الأعمال الهندسية المتخصصة.</p></div>
                    </div>
                    <!-- العمود الثالث -->
                    <div class="grid grid-rows-2 gap-8 min-w-max">
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service5Title">كتابة وتنسيق تقارير</h3><p data-lang-key="service5Desc">كتابة وتنسيق التقارير على برنامج الوورد بجودة ودقة عالية.</p></div>
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service6Title">تصميم وتعديل فيديوهات وصور</h3><p data-lang-key="service6Desc">تصميم وتعديل الفيديوهات والصور بجودة عالية لتناسب جميع احتياجاتكم.</p></div>
                    </div>
                    <!-- العمود الرابع -->
                    <div class="grid grid-rows-2 gap-8 min-w-max">
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service7Title">برمجة وتطوير مواقع الويب</h3><p data-lang-key="service7Desc">برمجة مواقع ويب تفاعلية وجمالية باستخدام لغة JavaScript وتنسيق الشكل باستخدام CSS، مع إضافة الموقع على سيرفر وإنشاء رابط خاص به.</p></div>
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service8Title">تصميم السيرة الذاتية (CV)</h3><p data-lang-key="service8Desc">نصمم لك سيرة ذاتية عصرية وجذابة تبرز مهاراتك وخبراتك بأفضل طريقة، مع التركيز على متطلبات سوق العمل لزيادة فرصك في الحصول على الوظيفة.</p></div>
                    </div>
                    <!-- العمود الخامس -->
                    <div class="grid grid-rows-2 gap-8 min-w-max">
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service9Title">كتابة خطاب التقديم</h3><p data-lang-key="service9Desc">نساعدك في صياغة خطاب تقديم مقنع وموجه بشكل خاص للوظيفة والشركة المستهدفة، مما يترك انطباعًا قويًا لدى مسؤولي التوظيف.</p></div>
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service10Title">إعداد مشاريع التخرج</h3><p data-lang-key="service10Desc">نقدم الدعم الكامل في إعداد مشاريع التخرج للبكالوريوس والماجستير، بدءًا من اختيار الفكرة، مرورًا بالبحث، وانتهاءً بالكتابة والتنسيق النهائي وفقًا للمعايير الأكاديمية.</p></div>
                    </div>
                    <!-- العمود السادس -->
                    <div class="grid grid-rows-2 gap-8 min-w-max">
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service11Title">خدمات القبول الجامعي</h3><p data-lang-key="service11Desc">نساعدك في رحلتك الأكاديمية عبر تقديم المشورة والمساعدة في تأمين القبولات في الجامعات المختلفة، وتجهيز ملف التقديم بشكل احترافي.</p></div>
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service12Title">تصميم الشعارات والهوية البصرية</h3><p data-lang-key="service12Desc">نصمم لك هوية بصرية متكاملة تبدأ من الشعار الاحترافي وتحديد الألوان والخطوط التي تعكس رؤية علامتك التجارية وتجذب انتباه جمهورك.</p></div>
                    </div>
                    <!-- العمود السابع -->
                    <div class="grid grid-rows-2 gap-8 min-w-max">
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service13Title">معاهد اللغة الإنجليزية في ماليزيا</h3><p data-lang-key="service13Desc">نقدم خدمات التسجيل والقبول في معاهد اللغة الإنجليزية التابعة للجامعات الماليزية المعتمدة، مع توفير الإرشاد الأكاديمي والدعم اللازم لتطوير مهاراتك اللغوية.</p></div>
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service14Title">الحصول على شهادة Linguaskill</h3><p data-lang-key="service14Desc">نساعدك في التحضير لاختبار Linguaskill وتخطي الاختبار بنجاح للحصول على شهادة معتمدة بدرجة عالية وموثقة دولياً، مما يعزز فرصك الأكاديمية والمهنية.</p></div>
                    </div>
                    <!-- العمود الثامن -->
                    <div class="grid grid-rows-1 gap-8 min-w-max">
                        <div class="card w-80"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service15Title">التصوير الجوي الفوتوغرافي</h3><p data-lang-key="service15Desc">نقدم خدمات التصوير الجوي الاحترافي في كوالالمبور باستخدام أحدث تقنيات الدرون، لتوثيق المناسبات والمشاريع والمواقع بجودة عالية ومن زوايا مذهلة.</p></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Order Tracking Section -->
        <section id="track-order-section" class="py-16 px-4 bg-gray-100 dark:bg-gray-900">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="section-heading mb-12" data-lang-key="trackOrderHeading">تتبع طلبك</h2>
                <div class="card p-8">
                    <p class="text-lg md:text-xl mb-6" data-lang-key="trackOrderSubtitle">أدخل رقم طلبك المكون من 6 أرقام لتتبع حالته.</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <input type="text" id="orderTrackInput" placeholder="أدخل رقم الطلب هنا..." class="w-full sm:w-2/3 md:w-1/2 p-3 rounded-lg shadow-sm" data-lang-key="trackOrderInputPlaceholder" pattern="\d{6}" title="الرجاء إدخال رقم مكون من 6 أرقام" required>
                        <button id="trackOrderBtn" class="btn-primary w-full sm:w-1/3 md:w-auto" data-lang-key="trackOrderBtn">تتبع</button>
                    </div>
                    <!-- Order Status Display Area -->
                    <div id="orderStatusDisplay" class="mt-8 hidden">
                        <h3 class="text-xl font-semibold mb-4 text-indigo-600 dark:text-indigo-400" data-lang-key="orderStatusTitle">حالة الطلب: <span id="displayedOrderId"></span></h3>
                        
                        <div id="rejectionInfo" class="rejection-info hidden">
                            <p class="font-bold" data-lang-key="orderRejected"></p>
                            <p id="rejectionReasonText"></p>
                        </div>
                        
                        <div id="progressContainer" class="progress-container">
                            <canvas id="progressBarCanvas" width="800" height="70" class="w-full"></canvas>
                            <div class="progress-steps-container">
                                <div class="progress-step" data-step="1"><span class="progress-label" data-lang-key="status1">بانتظار الموافقة</span></div>
                                <div class="progress-step" data-step="2"><span class="progress-label" data-lang-key="status2">قيد التنفيذ</span></div>
                                <div class="progress-step" data-step="3"><span class="progress-label" data-lang-key="status3">معاينة المشروع</span></div>
                                <div class="progress-step" data-step="4"><span class="progress-label" data-lang-key="status4">بانتظار الدفع</span></div>
                                <div class="progress-step" data-step="5"><span class="progress-label" data-lang-key="status5">اكتمل</span></div>
                            </div>
                        </div>

                        <div id="invoiceInfo" class="invoice-info hidden space-y-2 text-right">
                            <!-- Invoice details will be populated here by JS -->
                        </div>

                        <div id="orderPreviewImages" class="order-preview-images mt-6"></div>
                        
                        <!-- NEW: Payment Methods for Customer (Accordion) -->
                        <div id="paymentAccordion" class="mt-8 hidden">
                            <button id="togglePaymentBtn" class="w-full text-left p-4 rounded-lg font-semibold flex justify-between items-center transition-colors hover:bg-gray-300 dark:hover:bg-gray-600">
                                <span data-lang-key="paymentOptionsTitle">خيارات الدفع المتاحة</span>
                                <svg id="paymentAccordionIcon" class="w-5 h-5 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                            </button>
                            <div id="paymentMethodsContainer" class="hidden mt-4 border-t pt-4 border-gray-300 dark:border-gray-600">
                                <p class="mb-4" data-lang-key="paymentInstruction">الرجاء تحويل المبلغ المطلوب إلى أحد الحسابات التالية وارفاق الايصال للمتابعة:</p>
                                <div id="customerPaymentMethodsList" class="space-y-2">
                                    <!-- Customer-facing payment methods will be loaded here as accordions -->
                                </div>
                            </div>
                        </div>

                        <!-- NEW: Receipt Upload Section -->
                        <div id="receiptSection" class="hidden">
                            <!-- Content will be populated by JS -->
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <!-- Developer Mode Section -->
        <section id="developer-dashboard" class="py-16 px-4 hidden">
            <div class="max-w-6xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="devDashboardHeading">لوحة تحكم المطور</h2>
                <div class="flex justify-center mb-8">
                    <button id="updateSecurityRulesBtn" class="btn-primary mx-2" data-lang-key="updateSecurityRulesBtn">تحديث قواعد الأمان</button>
                </div>
                <div class="dev-order-list" id="devOrdersList">
                    <p id="devLoadingText" class="text-center text-gray-500 dark:text-gray-400 col-span-full" data-lang-key="devLoading">جاري تحميل الطلبات...</p>
                    <p id="noOrdersText" class="text-center text-gray-500 dark:text-gray-400 col-span-full hidden" data-lang-key="noOrders">لا توجد طلبات حتى الآن.</p>
                </div>
            </div>

            <!-- NEW: Payment Methods Management for Developer -->
            <div class="max-w-6xl mx-auto mt-12">
                <h3 class="section-heading text-center mb-8" data-lang-key="devPaymentMethodsHeading">إدارة طرق الدفع</h3>
                <div class="card p-8">
                    <form id="paymentMethodForm" class="space-y-4">
                         <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                            <div class="lg:col-span-1">
                                <label for="bankNameInput" class="block text-sm font-medium" data-lang-key="devBankName">اسم البنك:</label>
                                <input type="text" id="bankNameInput" placeholder="مثال: بنك الراجحي" class="mt-1 block w-full rounded-md shadow-sm" required>
                            </div>
                             <div class="lg:col-span-1">
                                <label for="accountHolderNameInput" class="block text-sm font-medium" data-lang-key="devAccountHolderName">اسم المستلم:</label>
                                <input type="text" id="accountHolderNameInput" placeholder="اسم صاحب الحساب" class="mt-1 block w-full rounded-md shadow-sm" required>
                            </div>
                            <div class="lg:col-span-1">
                                <label for="ibanInput" class="block text-sm font-medium" data-lang-key="devIban">رقم الآيبان:</label>
                                <input type="text" id="ibanInput" placeholder="SA..." class="mt-1 block w-full rounded-md shadow-sm" required>
                            </div>
                            <div class="lg:col-span-1">
                                <label for="phoneInput" class="block text-sm font-medium" data-lang-key="devPhoneNumber">رقم الهاتف (اختياري):</label>
                                <input type="text" id="phoneInput" placeholder="05..." class="mt-1 block w-full rounded-md shadow-sm">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary w-full mt-4" data-lang-key="devAddBank">إضافة بنك</button>
                    </form>
                    <hr class="my-6 border-gray-200 dark:border-gray-600">
                    <div id="devPaymentMethodsList" class="space-y-4">
                        <!-- Payment methods will be loaded here by JS -->
                    </div>
                </div>
            </div>

            <!-- NEW: Coupon Management for Developer -->
            <div class="max-w-6xl mx-auto mt-12">
                <h3 class="section-heading text-center mb-8" data-lang-key="devCouponManagementHeading">إدارة كوبونات الخصم</h3>
                <div class="card p-8">
                    <form id="couponForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                            <div class="lg:col-span-1">
                                <label for="couponCodeInput" class="block text-sm font-medium" data-lang-key="devCouponCode">كود الكوبون:</label>
                                <input type="text" id="couponCodeInput" placeholder="مثال: SAVE20" class="mt-1 block w-full rounded-md shadow-sm" required>
                            </div>
                            <div class="lg:col-span-1">
                                <label for="couponDiscountInput" class="block text-sm font-medium" data-lang-key="devCouponDiscount">نسبة الخصم (%):</label>
                                <input type="number" id="couponDiscountInput" placeholder="20" min="1" max="100" class="mt-1 block w-full rounded-md shadow-sm" required>
                            </div>
                            <div class="lg:col-span-1">
                                <label for="couponUsageLimitInput" class="block text-sm font-medium" data-lang-key="devCouponUsageLimit">حد الاستخدام:</label>
                                <select id="couponUsageLimitInput" class="mt-1 block w-full rounded-md shadow-sm" required>
                                    <option value="1">مرة واحدة</option>
                                    <option value="2">مرتين</option>
                                    <option value="3">3 مرات</option>
                                    <option value="4">4 مرات</option>
                                    <option value="5">5 مرات</option>
                                    <option value="6">6 مرات</option>
                                    <option value="7">7 مرات</option>
                                    <option value="8">8 مرات</option>
                                    <option value="9">9 مرات</option>
                                    <option value="10">10 مرات</option>
                                    <option value="-1">لا نهاية</option>
                                </select>
                            </div>
                            <div class="lg:col-span-1">
                                <button type="submit" class="btn-primary w-full" data-lang-key="devAddCoupon">إضافة كوبون</button>
                            </div>
                        </div>
                    </form>
                    <hr class="my-6 border-gray-200 dark:border-gray-600">
                    <div id="devCouponsList" class="space-y-4">
                        <!-- Coupons will be loaded here by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-16 px-4 bg-gray-100">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="section-heading mb-12" data-lang-key="contactHeading">للتواصل معنا</h2>
                <p class="text-lg md:text-xl mb-8" data-lang-key="contactSubtitle">يسعدنا استقبال استفساراتكم وطلباتكم عبر وسائل التواصل التالية:</p>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-6">
                    <a href="https://wa.me/966500900329" target="_blank" class="contact-link"><svg class="whatsapp-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.58 15.36 3.42 16.92L2.06 22L7.3 20.64C8.86 21.49 10.56 21.94 12.29 21.94H12.04C17.5 21.94 21.95 17.49 21.95 12.04C21.95 6.58 17.5 2 12.04 2ZM17.29 15.5L16.4 17.46C16.14 17.97 15.54 18.15 15.03 17.89C13.97 17.34 12.78 16.71 11.66 15.93C10.27 14.96 9.17 13.82 8.21 12.43C7.43 11.31 6.8 10.12 6.25 9.06C5.99 8.55 6.17 7.95 6.68 7.69L8.64 6.8C9.15 6.54 9.75 6.72 10.01 7.23L10.66 8.59C10.92 9.1 10.74 9.7 10.23 9.96L9.62 10.27C9.28 10.45 9.16 10.86 9.34 11.2C9.89 12.26 10.74 13.11 11.8 13.66C12.14 13.84 12.55 13.72 12.73 13.38L13.04 12.77C13.3 12.26 13.9 12.08 14.41 12.34L15.77 12.99C16.28 13.25 16.46 13.85 16.2 14.36L15.5 15.5ZM12.04 4C16.46 4 20.04 7.58 20.04 12.04C20.04 16.46 16.46 20.04 12.04 20.04C10.61 20.04 9.25 19.68 8.05 18.99L7.66 18.77L4.69 19.53L5.45 16.56L5.23 16.17C4.54 14.97 4.18 13.61 4.18 12.04C4.18 7.58 7.76 4 12.04 4Z"/></svg><span data-lang-key="whatsappNumberKSA">0500900329 داخل المملكة</span></a>
                    <a href="https://wa.me/60163340537" target="_blank" class="contact-link"><svg class="whatsapp-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v3h-1c-.9 0-1.64.58-1.9 1.39-.77-2.31-1.04-4.83-.5-7.44h6.89c.54 2.61.27 5.13-.5 7.44zM12 4.07c3.95.49 7 3.85 7 7.93 0 .62-.08 1.21-.21 1.79L15 9V8c0-1.1-.9-2-2-2H9v-.93c.71-.1 1.45-.17 2.21-.17.76 0 1.5.07 2.21.17z"/></svg><span data-lang-key="whatsappNumberOutsideKSA">+60163340537 خارج المملكة</span></a>
                    <a href="https://t.me/AHMADxx41" target="_blank" class="contact-link bg-blue-500 hover:bg-blue-600"><svg class="telegram-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.35 7.6l-2.45 7.42c-.22.68-.83.92-1.39.63l-2.73-2.1c-.24-.19-.48-.2-.72-.01l-1.35 1.04c-.3.23-.74.07-.82-.3l-.9-4.22c-.09-.43.14-.86.53-1.02l9.08-3.41c.42-.16.85.16.85.6v.01c-.01.35-.13.6-.33.72zm-4.38 5.75l.95-.73c.12-.1.29-.1.41 0l2.36 1.83c.1.08.13.23.07.35l-.83.74c-.08.07-.19.1-.3.07l-2.5-1.92c-.1-.08-.13-.23-.07-.35zm1.53-2.85l-4.52 3.49-1.96-1.51c-.1-.08-.24-.05-.32.06l-.72.93c-.08.1-.06.26.04.34l2.12 1.63c.1.08.24.05.32-.06l5.36-4.13c.1-.08.06-.23-.04-.32l-1.22-1.24c-.11-.11-.27-.11-.38 0z"/></svg><span data-lang-key="telegramContact">التواصل عبر التلجرام</span></a>
                </div>
            </div>
        </section>

        <!-- Comments Section -->
        <section id="comments" class="py-16 px-4">
            <div class="max-w-4xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="commentsHeading">التعليقات</h2>
                <div class="card p-8 md:p-12">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="leaveComment">أضف تعليقك</h3>
                    <form id="commentForm" class="space-y-4">
                        <div>
                            <label for="commentName" class="block text-sm font-medium" data-lang-key="commentNameLabel">اسمك:</label>
                            <input type="text" id="commentName" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="commentNamePlaceholder" placeholder="ادخل اسمك" required>
                        </div>
                        <div>
                            <label for="commentText" class="block text-sm font-medium" data-lang-key="commentTextLabel">تعليقك:</label>
                            <textarea id="commentText" rows="4" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="commentTextPlaceholder" placeholder="اكتب تعليقك هنا..." required></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium" data-lang-key="commentRatingLabel">تقييمك:</label>
                            <div id="starRatingInput" class="star-rating interactive flex mt-1"></div>
                            <input type="hidden" id="commentRatingValue" value="0">
                        </div>
                        <div>
                            <label for="commentImage" class="block text-sm font-medium" data-lang-key="commentImageLabel">إضافة صورة (اختياري):</label>
                            <div class="relative mt-1">
                                <input type="file" id="commentImage" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                                <div class="custom-file-input"><span id="fileInputText" data-lang-key="fileInputChoose">اختيار ملف</span></div>
                            </div>
                            <img id="imagePreview" src="#" alt="Image Preview" class="hidden">
                        </div>
                        <button type="submit" class="btn-primary w-full" data-lang-key="commentSubmitBtn">إرسال التعليق</button>
                    </form>
                    <hr class="my-8 border-gray-200 dark:border-gray-600">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="allComments">جميع التعليقات</h3>
                    <div id="commentsList" class="space-y-6">
                        <p id="commentsLoading" class="text-center text-gray-500 dark:text-gray-400" data-lang-key="commentsLoading">جاري تحميل التعليقات...</p>
                        <p id="noComments" class="text-center text-gray-500 dark:text-gray-400 hidden" data-lang-key="noComments">لا توجد تعليقات حتى الآن. كن أول من يعلق!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8 text-center">
        <p id="footerCopyright" data-lang-key="footerText">© 2025 جميع الحقوق محفوظة لفريق التصميم والمشاريع.</p>
    </footer>

    <div id="modeIndicator" class="fixed bottom-4 right-4 bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold z-50">الوضع الفاتح</div>
    <div id="developerModeIndicator" class="hidden">وضع المطور</div>
    <div id="copyNotification" class="copy-notification"></div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, doc, deleteDoc, runTransaction, arrayUnion, arrayRemove, getDoc, where, updateDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Initialization
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyBbL9kbE7oP5CW4HmZJGCCmZRY2L5wxxkM", 
            authDomain: "ourservices-c5658.firebaseapp.com",
            projectId: "ourservices-c5658",
            storageBucket: "ourservices-c5658.appspot.com",
            messagingSenderId: "951641862997",
            appId: "1:951641862997:web:4744607ef9c0c516d9f5dc",
            measurementId: "G-5LTEVPPJW1"
        };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let app, db, auth, userId;
        let isAuthReady = false;
        let isDeveloperMode = false;
        const DEVELOPER_MODE_SECRET = "Ahmad@2006";
        const SUPER_SECRET_CODE = "Ahmad@2006";
        const IMGBB_API_KEY = "c6af93a30efee65fec6b505a82033875";
        const FORMSPREE_ENDPOINT = "https://formspree.io/f/xrbllnal";


        // DOM Elements
        const customAlertModal = document.getElementById('customAlertModal');
        const customAlertMessage = document.getElementById('customAlertMessage');
        const customAlertButtons = document.getElementById('customAlertButtons');
        const customAlertInputs = document.getElementById('customAlertInputs');
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIconPath = document.getElementById('darkModeIconPath');
        const body = document.body;
        const modeIndicator = document.getElementById('modeIndicator');
        const developerModeIndicator = document.getElementById('developerModeIndicator');
        const languageDropdownButton = document.getElementById('languageDropdownButton');
        const languageDropdownMenu = document.getElementById('languageDropdownMenu');
        const commentForm = document.getElementById('commentForm');
        const commentsList = document.getElementById('commentsList');
        const commentsLoading = document.getElementById('commentsLoading');
        const noComments = document.getElementById('noComments');
        const footerCopyright = document.getElementById('footerCopyright');
        const commentImageInput = document.getElementById('commentImage');
        const imagePreview = document.getElementById('imagePreview');
        const fullImageModal = document.getElementById('fullImageModal');
        const fullImage = document.getElementById('fullImage');
        const fileInputText = document.getElementById('fileInputText');
        const starRatingInputContainer = document.getElementById('starRatingInput');
        const commentRatingValue = document.getElementById('commentRatingValue');
        
        // Order Form Elements
        const orderModal = document.getElementById('orderModal');
        const orderSubmittedModal = document.getElementById('orderSubmittedModal');
        const closeOrderModal = document.getElementById('closeOrderModal');
        const closeOrderSubmittedModal = document.getElementById('closeOrderSubmittedModal');
        const heroOrderNowBtn = document.getElementById('heroOrderNowBtn');
        const orderNowNavBtn = document.getElementById('orderNowNavBtn');
        const orderForm = document.getElementById('orderForm');
        const orderServiceSelect = document.getElementById('orderService');
        const otherServiceField = document.getElementById('otherServiceField');
        const otherServiceText = document.getElementById('otherServiceText');
        const submitOrderBtn = document.getElementById('submitOrderBtn');
        const orderFilesInput = document.getElementById('orderFiles');
        const orderFileInputText = document.getElementById('orderFileInputText');
        const orderImagesPreview = document.getElementById('orderImagesPreview');

        // Order Tracking Elements
        const trackOrderInput = document.getElementById('orderTrackInput');
        const trackOrderBtn = document.getElementById('trackOrderBtn');
        const orderStatusDisplay = document.getElementById('orderStatusDisplay');
        const displayedOrderId = document.getElementById('displayedOrderId');
        const progressBarCanvas = document.getElementById('progressBarCanvas');
        const progressContainer = document.getElementById('progressContainer');
        const progressStepsLabels = document.querySelectorAll('.progress-step');
        const orderPreviewImages = document.getElementById('orderPreviewImages');
        const rejectionInfo = document.getElementById('rejectionInfo');
        const rejectionReasonText = document.getElementById('rejectionReasonText');
        const invoiceInfo = document.getElementById('invoiceInfo');
        const receiptSection = document.getElementById('receiptSection');
        
        // Developer Mode Elements
        const developerDashboard = document.getElementById('developer-dashboard');
        const devOrdersList = document.getElementById('devOrdersList');
        const devLoadingText = document.getElementById('devLoadingText');
        const noOrdersText = document.getElementById('noOrdersText');
        
        // Payment Method Elements
        const paymentMethodForm = document.getElementById('paymentMethodForm');
        const bankNameInput = document.getElementById('bankNameInput');
        const accountHolderNameInput = document.getElementById('accountHolderNameInput');
        const ibanInput = document.getElementById('ibanInput');
        const phoneInput = document.getElementById('phoneInput');
        const devPaymentMethodsList = document.getElementById('devPaymentMethodsList');
        const paymentAccordion = document.getElementById('paymentAccordion');
        const togglePaymentBtn = document.getElementById('togglePaymentBtn');
        const paymentMethodsContainer = document.getElementById('paymentMethodsContainer');
        const customerPaymentMethodsList = document.getElementById('customerPaymentMethodsList');
        const copyNotification = document.getElementById('copyNotification');
        
        // Coupon Management Elements
        const couponForm = document.getElementById('couponForm');
        const couponCodeInputDev = document.getElementById('couponCodeInput');
        const couponDiscountInput = document.getElementById('couponDiscountInput');
        const couponUsageLimitInput = document.getElementById('couponUsageLimitInput');
        const devCouponsList = document.getElementById('devCouponsList');
        
        let orderFiles = [];
        
        // Coupon variables
        let appliedCoupon = null;
        let discountPercentage = 0;
        const couponCodeInput = document.getElementById('couponCode');
        const applyCouponBtn = document.getElementById('applyCouponBtn');
        const couponMessage = document.getElementById('couponMessage');
        const discountInfo = document.getElementById('discountInfo');
        let userLocation = { latitude: null, longitude: null };

        async function getIPAddress() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (!response.ok) throw new Error(`API returned status code ${response.status}`);
                const data = await response.json();
                return data.ip || 'غير متوفر';
            } catch (error) {
                console.error('Failed to fetch IP address:', error);
                return 'غير متوفر';
            }
        }

        async function initFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        loadComments();
                        if (isDeveloperMode) {
                            loadDevOrders();
                            loadPaymentMethods();
                        }
                    } else {
                        await signInAnonymously(auth);
                    }
                });
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showAlert("alertFirebaseInitError");
            }
        }
        
        const translations = {
            ar: {  
                siteTitle: "بوابة الخدمات - تصميم وتطوير المشاريع", navHome: "الرئيسية", navWhyChooseUs: "لماذا تختارنا؟", navAboutUs: "من نحن؟", navServices: "ماذا نقدم؟", navContact: "تواصل معنا", navComments: "التعليقات", navTrackOrder: "تتبع طلبك", heroTitle: "مصممون جميع أنواع المشاريع والمواقع والتصاميم والبحوث والواجبات", heroDiscount: "خصم 30% لفترة محدودة على كامل الخدمات", heroSubtitle: "نقدم لكم حلولاً متكاملة لتلبية جميع احتياجاتكم الأكاديمية والمهنية", featuresHeading: "لماذا تختارنا؟",
                alertSecurityRulesUpdated: "تم تحديث قواعد الأمان بنجاح.",
                updateSecurityRulesBtn: "تحديث قواعد الأمان", 
                feature1Title: "تنسيقات شكل رائعة", feature1Desc: "نقدم العديد من التنسيقات الجمالية التي تبرز عملك.", feature2Title: "تنسيق كلام احترافي", feature2Desc: "تنسيق دقيق للمحتوى في البحوث والمشاريع.", feature3Title: "أكثر من 100 نوع خط", feature3Desc: "اختر من مجموعة واسعة من الخطوط المميزة.", feature4Title: "عروض تقديمية مميزة", feature4Desc: "تصميم عروض بوربوينت جذابة ومبتكرة.",
                feature5Title: "استجابة سريعة 24/7", feature5Desc: "فريقنا متواجد على مدار الساعة للرد على استفساراتكم وتقديم الدعم الفوري لضمان سير العمل بسلاسة.",
                feature6Title: "دقة في التنفيذ وتعديلات مرنة", feature6Desc: "نلتزم بأعلى معايير الدقة في تنفيذ المشاريع، مع إتاحة إمكانية التعديل لتلبية توقعاتكم بالكامل.",
                feature7Title: "أمان وموثوقية", feature7Desc: "نضمن حقوقك بالكامل. لن تدفع أي مبلغ إلا بعد معاينة مشروعك والتأكد من اكتماله بالشكل المطلوب.",
                feature8Title: "أسعار تنافسية", feature8Desc: "نقدم خدماتنا بأسعار تنافسية ومنخفضة، مع خصم خاص على أول طلب لك معنا لتجربة خدماتنا المميزة.",
                aboutUsHeading: "من نحن؟", aboutUsParagraph1: "نحن فريق متقدم من خريجي جامعة UCSI الماليزية، نجمع بين المعرفة الأكاديمية العميقة والخبرة العملية الواسعة في تصميم وتنفيذ العديد من المشاريع الكبيرة والصغيرة.", servicesHeading: "ماذا نقدم؟", service1Title: "تصميم ثلاثي الأبعاد", service1Desc: "تصميم جميع أنواع القطع ثلاثية الأبعاد على برامج الأوتوكاد وبرامج الطباعة ثلاثية الأبعاد بجميع صيغ الملفات القابلة للطباعة.", service2Title: "عروض تقديمية (بوربوينت)", service2Desc: "تصميم عروض تقديمية على البوربوينت مع كامل التنسيق وإضافة الصور والحركات المرئية.", service3Title: "تنسيق ملفات إكسل", service3Desc: "تصميم وتعديل وتنسيق ملفات إكسل باحترافية عالية.", service4Title: "تصاميم هندسية ومخططات", service4Desc: "تصاميم هندسية، مخططات، كهرباء، وغيرها من الأعمال الهندسية المتخصصة.", service5Title: "كتابة وتنسيق تقارير", service5Desc: "كتابة وتنسيق التقارير على برنامج الوورد بجودة ودقة عالية.", service6Title: "تصميم وتعديل فيديوهات وصور", service6Desc: "تصميم وتعديل الفيديوهات والصور بجودة عالية لتناسب جميع احتياجاتكم.", service7Title: "برمجة وتطوير مواقع الويب", service7Desc: "برمجة مواقع ويب تفاعلية وجمالية باستخدام لغة JavaScript وتنسيق الشكل باستخدام CSS، مع إضافة الموقع على سيرفر وإنشاء رابط خاص به.", 
                service8Title: "تصميم السيرة الذاتية (CV)", service8Desc: "نصمم لك سيرة ذاتية عصرية وجذابة تبرز مهاراتك وخبراتك بأفضل طريقة، مع التركيز على متطلبات سوق العمل لزيادة فرصك في الحصول على الوظيفة.",
                service9Title: "كتابة خطاب التقديم", service9Desc: "نساعدك في صياغة خطاب تقديم مقنع وموجه بشكل خاص للوظيفة والشركة المستهدفة، مما يترك انطباعًا قويًا لدى مسؤولي التوظيف.",
                service10Title: "إعداد مشاريع التخرج", service10Desc: "نقدم الدعم الكامل في إعداد مشاريع التخرج للبكالوريوس والماجستير، بدءًا من اختيار الفكرة، مرورًا بالبحث، وانتهاءً بالكتابة والتنسيق النهائي وفقًا للمعايير الأكاديمية.",
                service11Title: "خدمات القبول الجامعي", service11Desc: "نساعدك في رحلتك الأكاديمية عبر تقديم المشورة والمساعدة في تأمين القبولات في الجامعات المختلفة، وتجهيز ملف التقديم بشكل احترافي.",
                service12Title: "تصميم الشعارات والهوية البصرية", service12Desc: "نصمم لك هوية بصرية متكاملة تبدأ من الشعار الاحترافي وتحديد الألوان والخطوط التي تعكس رؤية علامتك التجارية وتجذب انتباه جمهورك.",
                service13Title: "معاهد اللغة الإنجليزية في ماليزيا", service13Desc: "نقدم خدمات التسجيل والقبول في معاهد اللغة الإنجليزية التابعة للجامعات الماليزية المعتمدة، مع توفير الإرشاد الأكاديمي والدعم اللازم لتطوير مهاراتك اللغوية.",
                service14Title: "الحصول على شهادة Linguaskill", service14Desc: "نساعدك في التحضير لاختبار Linguaskill وتخطي الاختبار بنجاح للحصول على شهادة معتمدة بدرجة عالية وموثقة دولياً، مما يعزز فرصك الأكاديمية والمهنية.",
                service15Title: "التصوير الجوي الفوتوغرافي", service15Desc: "نقدم خدمات التصوير الجوي الاحترافي في كوالالمبور باستخدام أحدث تقنيات الدرون، لتوثيق المناسبات والمشاريع والمواقع بجودة عالية ومن زوايا مذهلة.",
                contactHeading: "للتواصل معنا", contactSubtitle: "يسعدنا استقبال استفساراتكم وطلباتكم عبر وسائل التواصل التالية:", whatsappNumberKSA: "0500900329 داخل المملكة", whatsappNumberOutsideKSA: "+60163340537 خارج المملكة", telegramContact: "التواصل عبر التلجرام", footerText: "© 2025 جميع الحقوق محفوظة لفريق التصميم والمشاريع.", modeLight: "الوضع الفاتح", modeDark: "الوضع الداكن", commentsHeading: "التعليقات", leaveComment: "أضف تعليقك", commentNameLabel: "اسمك:", commentNamePlaceholder: "ادخل اسمك", commentTextLabel: "تعليقك:", commentTextPlaceholder: "اكتب تعليقك هنا...", commentRatingLabel: "تقييمك:", commentImageLabel: "إضافة صورة (اختياري):", fileInputChoose: "اختيار ملف", commentSubmitBtn: "إرسال التعليق", allComments: "جميع التعليقات", commentsLoading: "جاري تحميل التعليقات...", noComments: "لا توجد تعليقات حتى الآن. كن أول من يعلق!", alertNameTextEmpty: "الرجاء إدخال اسمك.", alertCommentTextEmpty: "الرجاء إدخال تعليقك.", alertCommentAddedSuccess: "تم إرسال تعليقك بنجاح!", alertDeleteConfirm: "هل أنت متأكد أنك تريد حذف هذا التعليق؟", confirmText: "نعم", cancelText: "إلغاء", customAlertClose: "حسناً", developerModeIndicatorText: "وضع المطور", imageUploadError: "فشل رفع الصورة. الرجاء المحاولة مرة أخرى.", commentSending: "جاري الإرسال...",
                orderNowBtn: "اطلب الآن", orderFormTitle: "نموذج طلب خدمة", orderNameLabel: "الاسم الكامل:", orderNamePlaceholder: "الاسم الكامل", orderEmailLabel: "البريد الإلكتروني:", orderEmailPlaceholder: "yourname@example.com", orderPhoneLabel: "رقم الهاتف:", orderPhonePlaceholder: "+966 50 123 4567", orderServiceLabel: "نوع الخدمة المطلوبة:", orderServiceSelect: "اختر خدمة...", orderServiceOther: "أخرى...", orderServiceOtherLabel: "الرجاء تحديد الخدمة المطلوبة:", orderServiceOtherPlaceholder: "اكتب الخدمة المخصصة هنا...", orderMessageLabel: "تفاصيل المشروع:", orderMessagePlaceholder: "اشرح متطلبات مشروعك بالتفصيل...", orderFilesLabel: "إضافة صور (اختياري):", orderSubmitBtn: "تقديم الطلب", orderSuccess: "تم استلام طلبك بنجاح!", orderIdMessage: "الرجاء الاحتفاظ برقم طلبك لتتبع حالته:", orderError: "حدث خطأ أثناء إرسال طلبك. الرجاء المحاولة مرة أخرى.", locationUnavailable: "الموقع غير متوفر", orderSubmitting: "جاري تقديم الطلب...",
                navTrackOrder: "تتبع طلبك", trackOrderHeading: "تتبع طلبك", trackOrderSubtitle: "أدخل رقم طلبك المكون من 6 أرقام لتتبع حالته.", trackOrderInputPlaceholder: "أدخل رقم الطلب هنا...", trackOrderBtn: "تتبع", orderStatusTitle: "حالة الطلب:", status0: "مرفوض", status1: "بانتظار الموافقة", status2: "قيد التنفيذ", status3: "معاينة المشروع", status4: "بانتظار الدفع", status5: "اكتمل", orderNotFound: "لم يتم العثور على طلب بهذا الرقم.", orderTrackError: "حدث خطأ أثناء تتبع الطلب. الرجاء المحاولة مرة أخرى.", orderPreviewImagesTitle: "صور معاينة للمشروع:",
                devDashboardHeading: "لوحة تحكم المطور", devLoading: "جاري تحميل الطلبات...", devOrderId: "رقم الطلب:", devOrderUser: "العميل:", devOrderStatus: "الحالة:", devActions: "الإجراءات:", devUpdateStatus: "تحديث الحالة", devUploadImages: "رفع صور", devImagesLabel: "صور المعاينة:", devNoImages: "لا توجد صور معاينة بعد.", devOrderDate: "تاريخ الطلب:",
                devRejectOrder: "رفض الطلب", devSavePrices: "حفظ الأسعار", devEstimatedPrice: "السعر التقديري", devFinalPrice: "السعر النهائي", devCurrency: "العملة", devRejectionReasonPrompt: "الرجاء إدخال سبب الرفض (اختياري):", orderRejected: "تم رفض طلبك", orderRejectedReason: "السبب:", 
                invoiceSubtotal: "المبلغ", invoiceDiscount: "الخصم", invoiceDiscountValue: "قيمة الخصم", invoiceTotal: "المبلغ الإجمالي",
                pricesUpdatedSuccess: "تم تحديث الأسعار بنجاح!", pricesUpdatedError: "فشل تحديث الأسعار.", orderRejectedSuccess: "تم رفض الطلب بنجاح.", orderRejectedError: "فشل رفض الطلب.", devDeleteOrder: "حذف الطلب", alertDeleteOrderConfirm: "هل أنت متأكد أنك تريد حذف هذا الطلب؟ سيتم حذفه نهائياً.", alertDeleteOrderSuccess: "تم حذف الطلب بنجاح.", alertDeleteOrderError: "فشل حذف الطلب.",
                alertDeveloperModePrompt: "الرجاء إدخال الرمز السري للمطور.\nمعرف المستخدم الخاص بك:", promptSuperSecret: "الرجاء إدخال الرمز السري الخاص لإنشاء رمز جديد.", alertWrongSuperSecret: "الرمز السري الخاص غير صحيح.", oneTimeCodeGenerated: "تم إنشاء رمز الدخول المؤقت:", alertOneTimeCodeError: "حدث خطأ أثناء إنشاء الرمز.", alertInvalidOrUsedCode: "الرمز المدخل غير صالح أو منتهي الصلاحية.", alertWrongDevCode: "الرمز المدخل غير صحيح.",
                devPaymentMethodsHeading: "إدارة طرق الدفع", devBankName: "اسم البنك:", devAccountHolderName: "اسم المستلم:", devIban: "رقم الآيبان:", devPhoneNumber: "رقم الهاتف:", devAddBank: "إضافة بنك", devDeleteBank: "حذف البنك", paymentOptionsTitle: "خيارات الدفع المتاحة", paymentInstruction: "الرجاء تحويل المبلغ المطلوب إلى أحد الحسابات التالية وارفاق الايصال للمتابعة:", ibanCopied: "تم نسخ الآيبان بنجاح!", copyIban: "نسخ الآيبان", deleteBankConfirm: "هل أنت متأكد أنك تريد حذف هذا البنك؟", bankAddedSuccess: "تمت إضافة البنك بنجاح.", bankAddError: "خطأ في إضافة البنك.", bankDeleteSuccess: "تم حذف البنك بنجاح.", bankDeleteError: "خطأ في حذف البنك.",
                alertFirebaseInitError: "حدث خطأ أثناء الاتصال بقاعدة البيانات. الرجاء تحديث الصفحة والمحاولة مرة أخرى.", devDiscountLabel: "الخصم (%):", devPaidVia: "تم الدفع عبر:", devSelectBank: "اختر البنك...",
                alertDeletePreviewImageConfirm: "هل أنت متأكد أنك تريد حذف هذه الصورة؟", alertDeletePreviewImageSuccess: "تم حذف الصورة بنجاح.", alertDeletePreviewImageError: "حدث خطأ أثناء حذف الصورة.",
                receiptTitle: "إيصال الدفع", receiptUploadPrompt: "الرجاء إرفاق صورة إيصال الدفع.", receiptUploadBtn: "رفع الإيصال", receiptChangeBtn: "تغيير الإيصال", receiptUploading: "جاري رفع الإيصال...", receiptUploadSuccess: "تم رفع الإيصال بنجاح!", receiptUploadError: "فشل رفع الإيصال.",
                devAssignedTo: "مسؤول المشروع:", devSave: "حفظ", devAssignedToUpdated: "تم تحديث مسؤول المشروع.",
                uidModalTitle: "معرف المستخدم الخاص بك", uidModalDescription: "هذا هو معرف المستخدم الخاص بك (UID):", uidCopyBtn: "نسخ المعرف", uidCopiedSuccess: "تم نسخ المعرف بنجاح!", uidModalClose: "إغلاق",
                // Coupon translations
                couponLabel: "كود الخصم/الدعوة:",
                couponPlaceholder: "أدخل كود الخصم",
                couponCodeLabel: "كود الخصم:", couponCodePlaceholder: "أدخل كود الخصم", applyCouponBtn: "تطبيق", couponInvalidCode: "كود الخصم غير صالح.", couponUsageLimitExceeded: "تم استنفاد عدد مرات استخدام هذا الكود.", couponAppliedSuccess: "تم تطبيق كود الخصم بنجاح!", couponDiscountApplied: "خصم مطبق:", couponEnterCode: "الرجاء إدخال كود الخصم.",
                devCouponManagementHeading: "إدارة كوبونات الخصم", devCouponCode: "كود الكوبون:", devCouponDiscount: "نسبة الخصم (%):", devCouponUsageLimit: "حد الاستخدام:", devAddCoupon: "إضافة كوبون", devDeleteCoupon: "حذف الكوبون", devCouponAddedSuccess: "تم إضافة الكوبون بنجاح!", devCouponAddError: "خطأ في إضافة الكوبون.", devCouponDeletedSuccess: "تم حذف الكوبون بنجاح!", devCouponDeleteError: "خطأ في حذف الكوبون.", devCouponDeleteConfirm: "هل أنت متأكد أنك تريد حذف هذا الكوبون؟", devCouponUsed: "مستخدم:", devCouponDelete: "حذف", devCouponValidationError: "الرجاء ملء جميع الحقول بقيم صحيحة."
            },
            en: {  
                siteTitle: "Gate Of Services - Project Design & Development", navHome: "Home", navWhyChooseUs: "Why Choose Us?", navAboutUs: "About Us", navServices: "What We Offer?", navContact: "Contact Us", navComments: "Comments", navTrackOrder: "Track Your Order", heroTitle: "Designers of all types of projects, websites, designs, research, and assignments", heroDiscount: "30% discount for a limited time on all services", heroSubtitle: "We offer integrated solutions to meet all your academic and professional needs", featuresHeading: "Why Choose Us?",
                alertSecurityRulesUpdated: "Security rules have been updated successfully.",
                updateSecurityRulesBtn: "Update Security Rules", 
                feature1Title: "Excellent Visual Formats", feature1Desc: "We provide many aesthetic formats that highlight your work.", feature2Title: "Professional Text Formatting", feature2Desc: "Precise content formatting for research and projects.", feature3Title: "Over 100 Font Types", feature3Desc: "Choose from a wide range of distinctive fonts.", feature4Title: "Outstanding Presentations", feature4Desc: "Designing attractive and innovative PowerPoint presentations.",
                feature5Title: "24/7 Fast Response", feature5Desc: "Our team is available around the clock to answer your inquiries and provide immediate support to ensure smooth workflow.",
                feature6Title: "Precision & Flexible Edits", feature6Desc: "We adhere to the highest standards of precision in project execution, with the flexibility for modifications to fully meet your expectations.",
                feature7Title: "Security & Reliability", feature7Desc: "Your rights are fully guaranteed. You won't pay anything until you preview your project and confirm its completion as required.",
                feature8Title: "Competitive Prices", feature8Desc: "We offer our services at competitive and low prices, with a special discount on your first order to experience our premium services.",
                aboutUsHeading: "Who Are We?", aboutUsParagraph1: "We are an advanced team of UCSI Malaysian University graduates, combining deep academic knowledge with extensive practical experience in designing and implementing many large and small projects.", servicesHeading: "What We Offer?", service1Title: "3D Design", service1Desc: "Designing all types of 3D parts on AutoCAD and 3D printing software in all printable file formats.", service2Title: "Presentations (PowerPoint)", service2Desc: "Designing PowerPoint presentations with full formatting and adding images and visual effects.", service3Title: "Excel File Formatting", service3Desc: "Designing, modifying, and formatting Excel files with high professionalism.", service4Title: "Engineering Designs & Plans", service4Desc: "Engineering designs, plans, electrical works, and other specialized engineering works.", service5Title: "Report Writing & Formatting", service5Desc: "Writing and formatting reports in Word with high quality and accuracy.", service6Title: "Video & Photo Design/Editing", service6Desc: "Designing and editing videos and photos with high quality to suit all your needs.", service7Title: "Web Programming & Development", service7Desc: "Programming interactive and aesthetic websites using JavaScript and styling with CSS, including hosting the site on a server and creating a dedicated link.",
                service8Title: "Professional CV/Resume Design", service8Desc: "We design a modern, attractive CV that best highlights your skills and experience, focusing on job market requirements to increase your opportunities.",
                service9Title: "Custom Cover Letter Writing", service9Desc: "We help you craft a persuasive cover letter tailored to the specific job and company, making a strong impression on hiring managers.",
                service10Title: "Graduation Project Preparation", service10Desc: "We offer full support for bachelor's and master's graduation projects, from idea selection and research to final writing and formatting according to academic standards.",
                service11Title: "University Admission Services", service11Desc: "We assist you on your academic journey by providing advice and help in securing admissions to various universities and preparing a professional application portfolio.",
                service12Title: "Logo & Brand Identity Design", service12Desc: "We design a complete visual identity for you, starting with a professional logo and defining the colors and fonts that reflect your brand's vision and attract your audience.",
                service13Title: "English Language Institutes in Malaysia", service13Desc: "We provide registration and admission services for English language institutes affiliated with accredited Malaysian universities, offering academic guidance and necessary support to develop your language skills.",
                service14Title: "Linguaskill Certificate Acquisition", service14Desc: "We help you prepare for the Linguaskill test and successfully pass the exam to obtain a high-grade, internationally recognized and documented certificate, enhancing your academic and professional opportunities.",
                service15Title: "Aerial Photography Services", service15Desc: "We provide professional aerial photography services in Kuala Lumpur using the latest drone technology, capturing events, projects, and locations with high quality from stunning angles.",
                contactHeading: "Contact Us", contactSubtitle: "We are happy to receive your inquiries and requests via the following channels:", whatsappNumberKSA: "0500900329 Inside KSA", whatsappNumberOutsideKSA: "+60163340537 Outside KSA", telegramContact: "Contact via Telegram", footerText: "© 2025 All rights reserved for the Design and Projects Team.", modeLight: "Light Mode", modeDark: "Dark Mode", commentsHeading: "Comments", leaveComment: "Leave a comment", commentNameLabel: "Your Name:", commentNamePlaceholder: "Enter your name", commentTextLabel: "Your Comment:", commentTextPlaceholder: "Write your comment here...", commentRatingLabel: "Your Rating:", commentImageLabel: "Add an image (optional):", fileInputChoose: "Choose file", commentSubmitBtn: "Submit Comment", allComments: "All Comments", commentsLoading: "Loading comments...", noComments: "No comments yet. Be the first to comment!", alertNameTextEmpty: "Please enter your name.", alertCommentTextEmpty: "Please enter your comment.", alertCommentAddedSuccess: "Comment submitted successfully!", alertDeleteConfirm: "Are you sure you want to delete this comment?", confirmText: "Yes", cancelText: "Cancel", customAlertClose: "OK", developerModeIndicatorText: "Developer Mode", imageUploadError: "Image upload failed. Please try again.", commentSending: "Sending...",
                orderNowBtn: "Order Now", orderFormTitle: "Service Request Form", orderNameLabel: "Full Name:", orderNamePlaceholder: "Full Name", orderEmailLabel: "Email Address:", orderEmailPlaceholder: "yourname@example.com", orderPhoneLabel: "Phone Number:", orderPhonePlaceholder: "+966 50 123 4567", orderServiceLabel: "Requested Service:", orderServiceSelect: "Select a service...", orderServiceOther: "Other...", orderServiceOtherLabel: "Please specify the requested service:", orderServiceOtherPlaceholder: "Write your custom service here...", orderMessageLabel: "Project Details:", orderMessagePlaceholder: "Explain your project requirements in detail...", orderFilesLabel: "Add images (optional):", orderSubmitBtn: "Submit Request", orderSuccess: "Thank you! Your request has been received successfully.", orderIdMessage: "Please save your order ID to track its status:", orderError: "An error occurred while submitting your request. Please try again.", locationUnavailable: "Location unavailable", orderSubmitting: "Submitting order...",
                navTrackOrder: "Track Your Order", trackOrderHeading: "Track Your Order", trackOrderSubtitle: "Enter your 6-digit order ID to check its status.", trackOrderInputPlaceholder: "Enter Order ID here...", trackOrderBtn: "Track", orderStatusTitle: "Order Status:", status0: "Rejected", status1: "Awaiting Approval", status2: "In Progress", status3: "Project Preview", status4: "Awaiting Payment", status5: "Completed", orderNotFound: "Order with this ID was not found.", orderTrackError: "An error occurred while tracking the order. Please try again.", orderPreviewImagesTitle: "Project Preview Images:",
                devDashboardHeading: "Developer Dashboard", devLoading: "Loading orders...", noOrders: "No orders have been placed yet.", devOrderId: "Order ID:", devOrderUser: "Client:", devOrderStatus: "Status:", devActions: "Actions:", devUpdateStatus: "Update Status", devUploadImages: "Upload Images", devImagesLabel: "Preview Images:", devNoImages: "No preview images yet.", devOrderDate: "Order Date:",
                devRejectOrder: "Reject Order", devSavePrices: "Save Prices", devEstimatedPrice: "Est. Price", devFinalPrice: "Final Price", devCurrency: "Currency", devRejectionReasonPrompt: "Please enter the reason for rejection (optional):", orderRejected: "Your order has been rejected", orderRejectedReason: "Reason:",
                invoiceSubtotal: "Subtotal", invoiceDiscount: "Discount", invoiceDiscountValue: "Discount Value", invoiceTotal: "Total Amount",
                pricesUpdatedSuccess: "Prices updated successfully!", pricesUpdatedError: "Failed to update prices.", orderRejectedSuccess: "Order rejected successfully.", orderRejectedError: "Failed to reject order.", devDeleteOrder: "Delete Order", alertDeleteOrderConfirm: "Are you sure you want to delete this order? This action is permanent.", alertDeleteOrderSuccess: "Order deleted successfully.", alertDeleteOrderError: "Failed to delete order.",
                alertDeveloperModePrompt: "Please enter the developer secret code.\nYour User ID:", promptSuperSecret: "Please enter the super secret code to generate a new code.", alertWrongSuperSecret: "Incorrect super secret code.", oneTimeCodeGenerated: "Your temporary access code is:", alertOneTimeCodeError: "Error generating the code.", alertInvalidOrUsedCode: "The entered code is invalid or has expired.", alertWrongDevCode: "The entered code is incorrect.",
                devPaymentMethodsHeading: "Manage Payment Methods", devBankName: "Bank Name:", devAccountHolderName: "Recipient Name:", devIban: "IBAN:", devPhoneNumber: "Phone Number (Optional):", devAddBank: "Add Bank", devDeleteBank: "Delete Bank", paymentOptionsTitle: "Available Payment Options", paymentInstruction: "Please transfer the required amount to one of the following accounts and attach the receipt to proceed:", ibanCopied: "IBAN copied successfully!", copyIban: "Copy IBAN", deleteBankConfirm: "Are you sure you want to delete this bank?", bankAddedSuccess: "Bank added successfully.", bankAddError: "Error adding bank.", bankDeleteSuccess: "Bank deleted successfully.", bankDeleteError: "Error deleting bank.",
                alertFirebaseInitError: "Error connecting to the database. Please refresh the page and try again.", devDiscountLabel: "Discount (%):", devPaidVia: "Paid Via:", devSelectBank: "Select Bank...",
                alertDeletePreviewImageConfirm: "Are you sure you want to delete this image?", alertDeletePreviewImageSuccess: "Image deleted successfully.", alertDeletePreviewImageError: "Error deleting image.",
                receiptTitle: "Payment Receipt", receiptUploadPrompt: "Please attach the payment receipt image.", receiptUploadBtn: "Upload Receipt", receiptChangeBtn: "Change Receipt", receiptUploading: "Uploading receipt...", receiptUploadSuccess: "Receipt uploaded successfully!", receiptUploadError: "Failed to upload receipt.",
                devAssignedTo: "Assigned To:", devSave: "Save", devAssignedToUpdated: "Project assignee updated.",
                uidModalTitle: "Your User ID", uidModalDescription: "This is your User ID (UID):", uidCopyBtn: "Copy ID", uidCopiedSuccess: "ID copied successfully!", uidModalClose: "Close",
                
                // Coupon translations
                couponLabel: "Coupon Code:",
                couponPlaceholder: "Enter coupon code",
                applyCouponBtn: "Apply",
                couponInvalidCode: "Invalid coupon code.",
                couponUsageLimitExceeded: "This coupon has reached its usage limit.",
                couponAppliedSuccess: "Coupon applied successfully!",
                couponDiscountApplied: "Discount applied:",
                couponEnterCode: "Please enter a coupon code.",
                devCouponManagementHeading: "Coupon Management",
                devCouponCode: "Coupon Code:",
                devCouponDiscount: "Discount (%):",
                devCouponUsageLimit: "Usage Limit:",
                devAddCoupon: "Add Coupon",
                devDeleteCoupon: "Delete Coupon",
                devCouponAddedSuccess: "Coupon added successfully!",
                devCouponAddError: "Error adding coupon.",
                devCouponDeletedSuccess: "Coupon deleted successfully!",
                devCouponDeleteError: "Error deleting coupon.",
                devCouponDeleteConfirm: "Are you sure you want to delete this coupon?",
                devCouponUsed: "Used:",
                devCouponDelete: "Delete",
                discountApplied: "Discount applied!",
                discountPercentage: "Discount percentage:",
                couponCodeApplied: "Applied code:",
                devCouponValidationError: "Please fill all fields with valid values."
            },
            zh: {
                siteTitle: "服务门户 - 项目设计与开发", navHome: "主页", navWhyChooseUs: "为什么选择我们？", navAboutUs: "关于我们", navServices: "我们提供什么？", navContact: "联系我们", navComments: "评论", navTrackOrder: "追踪您的订单", heroTitle: "各种项目、网站、设计、研究和作业的设计者", heroDiscount: "所有服务限时30%折扣", heroSubtitle: "我们提供全面的解决方案，满足您所有的学术和专业需求", featuresHeading: "为什么选择我们？",
                alertSecurityRulesUpdated: "安全规则已成功更新。",
                updateSecurityRulesBtn: "更新安全规则", 
                feature1Title: "出色的视觉格式", feature1Desc: "我们提供多种美观的格式，突出您的作品。", feature2Title: "专业的文本排版", feature2Desc: "为研究和项目提供精确的内容排版。", feature3Title: "超过100种字体", feature3Desc: "从多种独特的字体中进行选择。", feature4Title: "出色的演示文稿", feature4Desc: "设计引人入胜、富有创意的PowerPoint演示文稿。",
                feature5Title: "24/7 快速响应", feature5Desc: "我们的团队全天候为您解答疑问，并提供即时支持，确保工作流程顺畅。",
                feature6Title: "精确执行与灵活修改", feature6Desc: "我们坚持最高的项目执行精度标准，并提供灵活的修改选项，以完全满足您的期望。",
                feature7Title: "安全与可靠", feature7Desc: "您的权利得到充分保障。在您预览项目并确认其按要求完成后，才需支付任何费用。",
                feature8Title: "有竞争力的价格", feature8Desc: "我们以具有竞争力的低价提供服务，并为您的第一份订单提供特别折扣，让您体验我们的优质服务。",
                aboutUsHeading: "我们是谁？", aboutUsParagraph1: "我们是一支由马来西亚UCSI大学毕业生组成的优秀团队，将深厚的学术知识与广泛的项目设计和实施实践经验相结合。", servicesHeading: "我们提供什么？", service1Title: "3D设计", service1Desc: "使用AutoCAD和3D打印软件设计各种类型的3D部件，支持所有可打印文件格式。", service2Title: "演示文稿 (PowerPoint)", service2Desc: "设计带有完整格式、图像和视觉效果的PowerPoint演示文稿。", service3Title: "Excel文件排版", service3Desc: "以高专业水平设计、修改和排版Excel文件。", service4Title: "工程设计与图纸", service4Desc: "工程设计、平面图、电气工程以及其他专业工程作业。", service5Title: "报告撰写与排版", service5Desc: "以高质量和高准确度撰写和排版Word报告。", service6Title: "视频与照片设计/编辑", service6Desc: "设计和编辑高质量的视频和照片，以满足您的所有需求。", service7Title: "网站编程与开发", service7Desc: "使用JavaScript编程交互式和美观的网站，使用CSS进行样式设计，并托管在服务器上并创建专用链接。",
                service8Title: "专业简历 (CV) 设计", service8Desc: "我们为您设计一份现代化且吸引人的简历，以最佳方式突出您的技能和经验，专注于满足就业市场要求，增加您获得工作的机会。",
                service9Title: "定制求职信 (Cover Letter) 撰写", service9Desc: "我们帮助您撰写一封有说服力的求职信，专门针对目标职位和公司，给招聘经理留下深刻印象。",
                service10Title: "毕业项目准备", service10Desc: "我们为学士和硕士的毕业项目提供全面支持，从选题、研究到根据学术标准进行最终撰写和排版。",
                service11Title: "大学录取服务", service11Desc: "我们通过提供建议和帮助，协助您的学术之旅，确保获得各大学的录取，并专业地准备您的申请材料。",
                service12Title: "标志与品牌识别设计", service12Desc: "我们为您设计完整的视觉识别系统，从专业的标志开始，定义反映您品牌愿景并吸引观众的颜色和字体。",
                service13Title: "马来西亚英语语言学院", service13Desc: "我们为马来西亚认可大学附属的英语语言学院提供注册和录取服务，提供学术指导和必要支持，帮助您提高语言技能。",
                service14Title: "Linguaskill证书获取", service14Desc: "我们帮助您准备Linguaskill考试并成功通过考试，获得高分、国际认可和权威认证的证书，提升您的学术和职业机会。",
                service15Title: "航拍摄影服务", service15Desc: "我们在吉隆坡使用最新的无人机技术提供专业航拍摄影服务，以高质量和令人惊叹的角度记录活动、项目和地点。",
                contactHeading: "联系我们", contactSubtitle: "我们很乐意通过以下渠道接收您的咨询和请求:", whatsappNumberKSA: "0500900329 (沙特境内)", whatsappNumberOutsideKSA: "+60163340537 (沙特境外)", telegramContact: "通过Telegram联系", footerText: "© 2025 设计与项目团队保留所有权利。", modeLight: "浅色模式", modeDark: "深色模式", commentsHeading: "评论", leaveComment: "发表评论", commentNameLabel: "您的姓名：", commentNamePlaceholder: "输入您的姓名", commentTextLabel: "您的评论：", commentTextPlaceholder: "在此处写下您的评论...", commentRatingLabel: "您的评分：", commentImageLabel: "添加图片（可选）：", fileInputChoose: "选择文件", commentSubmitBtn: "提交评论", allComments: "所有评论", commentsLoading: "正在加载评论...", noComments: "暂无评论。成为第一个发表评论的人吧！", alertNameTextEmpty: "请输入您的姓名。", alertCommentTextEmpty: "请输入您的评论。", alertCommentAddedSuccess: "评论提交成功！", alertDeleteConfirm: "您确定要删除这条评论吗？", confirmText: "是", cancelText: "取消", customAlertClose: "确定", developerModeIndicatorText: "开发者模式", imageUploadError: "图片上传失败。请重试。", commentSending: "发送中...",
                orderNowBtn: "立即下单", orderFormTitle: "服务请求表", orderNameLabel: "全名：", orderNamePlaceholder: "全名", orderEmailLabel: "电子邮件地址：", orderEmailPlaceholder: "yourname@example.com", orderPhoneLabel: "电话号码：", orderPhonePlaceholder: "+966 50 123 4567", orderServiceLabel: "所需服务：", orderServiceSelect: "选择一项服务...", orderServiceOther: "其他...", orderServiceOtherLabel: "请指定所需的服务：", orderServiceOtherPlaceholder: "在此处写下您的自定义服务...", orderMessageLabel: "项目详情：", orderMessagePlaceholder: "详细解释您的项目要求...", orderFilesLabel: "添加图片（可选）：", orderSubmitBtn: "提交申请", orderSuccess: "谢谢！您的请求已成功接收。", orderIdMessage: "请保存您的订单号以跟踪其状态：", orderError: "提交请求时出错。请重试。", locationUnavailable: "位置不可用", orderSubmitting: "正在提交订单...",
                navTrackOrder: "追踪您的订单", trackOrderHeading: "追踪您的订单", trackOrderSubtitle: "输入您的6位订单号以查看其状态。", trackOrderInputPlaceholder: "在此处输入订单号...", trackOrderBtn: "追踪", orderStatusTitle: "订单状态：", status0: "已拒绝", status1: "等待批准", status2: "处理中", status3: "项目预览", status4: "等待付款", status5: "已完成", orderNotFound: "未找到该订单号的订单。", orderTrackError: "追踪订单时出错。请重试。", orderPreviewImagesTitle: "项目预览图片：",
                devDashboardHeading: "开发者面板", devLoading: "正在加载订单...", noOrders: "尚未下订单。", devOrderId: "订单号：", devOrderUser: "客户：", devOrderStatus: "状态：", devActions: "操作：", devUpdateStatus: "更新状态", devUploadImages: "上传图片", devImagesLabel: "预览图片：", devNoImages: "暂无预览图片。", devOrderDate: "下单日期：",
                devRejectOrder: "拒绝订单", devSavePrices: "保存价格", devEstimatedPrice: "估价", devFinalPrice: "最终价格", devCurrency: "货币", devRejectionReasonPrompt: "请输入拒绝原因（可选）：", orderRejected: "您的订单已被拒绝", orderRejectedReason: "原因：",
                invoiceSubtotal: "小计", invoiceDiscount: "折扣", invoiceDiscountValue: "折扣金额", invoiceTotal: "总金额",
                pricesUpdatedSuccess: "价格更新成功！", pricesUpdatedError: "价格更新失败。", orderRejectedSuccess: "订单拒绝成功。", orderRejectedError: "拒绝订单失败。", devDeleteOrder: "删除订单", alertDeleteOrderConfirm: "您确定要删除此订单吗？此操作是永久性的。", alertDeleteOrderSuccess: "订单已成功删除。", alertDeleteOrderError: "删除订单失败。",
                alertDeveloperModePrompt: "请输入开发者密码。\n您的用户ID:", promptSuperSecret: "请输入超级密码以生成新代码。", alertWrongSuperSecret: "超级密码不正确。", oneTimeCodeGenerated: "您的一次性访问代码是：", alertOneTimeCodeError: "生成代码时出错。", alertInvalidOrUsedCode: "输入的代码无效或已过期。", alertWrongDevCode: "输入的代码不正确。",
                devPaymentMethodsHeading: "管理支付方式", devBankName: "银行名称:", devAccountHolderName: "收款人姓名:", devIban: "IBAN:", devPhoneNumber: "电话号码 (可选):", devAddBank: "添加银行", devDeleteBank: "删除银行", paymentOptionsTitle: "可用支付选项", paymentInstruction: "请将所需金额转入以下账户之一，并附上收据以便继续操作:", ibanCopied: "IBAN 已成功复制!", copyIban: "复制 IBAN", deleteBankConfirm: "您确定要删除这家银行吗？", bankAddedSuccess: "银行添加成功。", bankAddError: "添加银行时出错。", bankDeleteSuccess: "银行删除成功。", bankDeleteError: "删除银行时出错。",
                alertFirebaseInitError: "连接数据库时出错。请刷新页面再试。", devDiscountLabel: "折扣 (%):", devPaidVia: "支付方式:", devSelectBank: "选择银行...",
                alertDeletePreviewImageConfirm: "您确定要删除此图片吗？", alertDeletePreviewImageSuccess: "图片已成功删除。", alertDeletePreviewImageError: "删除图片时出错。",
                receiptTitle: "付款收据", receiptUploadPrompt: "请附上付款收据图片。", receiptUploadBtn: "上传收据", receiptChangeBtn: "更改收据", receiptUploading: "正在上传收据...", receiptUploadSuccess: "收据上传成功！", receiptUploadError: "上传收据失败。",
                devAssignedTo: "项目负责人:", devSave: "保存", devAssignedToUpdated: "项目负责人已更新。",
                uidModalTitle: "您的用户ID", uidModalDescription: "这是您的用户ID (UID):", uidCopyBtn: "复制ID", uidCopiedSuccess: "ID复制成功!", uidModalClose: "关闭",
                // Coupon translations
                couponLabel: "优惠券/邀请码:",
                couponPlaceholder: "输入优惠券代码",
                couponCodeLabel: "优惠券/邀请码:", 
                couponCodePlaceholder: "输入优惠券代码", 
                applyCouponBtn: "应用",
                couponInvalidCode: "无效的优惠券代码。",
                couponUsageLimitExceeded: "此优惠券已达到使用限制。",
                couponAppliedSuccess: "优惠券应用成功！",
                couponDiscountApplied: "已应用折扣:",
                couponEnterCode: "请输入优惠券代码。",
                discountApplied: "已应用折扣！",
                discountPercentage: "折扣百分比:",
                couponCodeApplied: "已应用代码:",
                devCouponValidationError: "请填写所有字段的有效值。"
            }
        };

        // Detect browser language and set appropriate language
        function detectBrowserLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('ar')) {
                return 'ar';
            } else if (browserLang.startsWith('zh')) {
                return 'zh';
            } else {
                return 'en'; // Default to English for all other languages
            }
        }
        
        let currentLang = localStorage.getItem('lang') || detectBrowserLanguage();
        const htmlElement = document.documentElement;

        const commentTextCache = new Map();

        async function translateText(text, targetLang) {
            if (!text) return text;
            const cacheKey = `${text}_${targetLang}`;
            if (commentTextCache.has(cacheKey)) return commentTextCache.get(cacheKey);

            try {
                const prompt = `Translate the following text to ${targetLang}. Provide only the translation, no extra explanations or analysis, and keep it as concise as possible:\n\n${text}`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = "AIzaSyAQUGqUp7KMjs9q2jrIR8BQ3xH9hollWrQ";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent`;
                const response = await fetch(apiUrl, { 
                    method: 'POST', 
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-goog-api-key': apiKey
                    }, 
                    body: JSON.stringify(payload) 
                });
                if (!response.ok) throw new Error(`API error: ${response.status}`);
                const result = await response.json();
                const translatedText = result.candidates[0].content.parts[0].text;
                commentTextCache.set(cacheKey, translatedText);
                return translatedText;
            } catch (error) {
                console.error(`Translation failed for "${text}" to "${targetLang}":`, error);
                return text;
            }
        }

        async function updateCommentTranslations() {
            const commentElements = commentsList.querySelectorAll('[data-comment-id]');
            for (const commentDiv of commentElements) {
                const commentTextP = commentDiv.querySelector('.comment-text-display');
                if (commentTextP) {
                    const originalText = commentTextP.getAttribute('data-original-text');
                    if (originalText) {
                        commentTextP.textContent = translations[currentLang].commentsLoading;
                        const translatedText = await translateText(originalText, currentLang);
                        commentTextP.textContent = translatedText;
                    }
                }
            }
        }

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            htmlElement.lang = lang;
            htmlElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const translation = translations[currentLang]?.[key] || translations.en[key] || key;
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    if (element.type !== 'file') element.placeholder = translation;
                } else if (element.tagName === 'TITLE') {
                    document.title = translation;
                } else {
                    element.textContent = translation;
                }
            });

            const serviceOptions = orderServiceSelect.options;
            const serviceTitles = ['orderServiceSelect', 'service1Title', 'service2Title', 'service3Title', 'service4Title', 'service5Title', 'service6Title', 'service7Title', 'service8Title', 'service9Title', 'service10Title', 'service11Title', 'service12Title', 'service13Title', 'service14Title', 'service15Title', 'orderServiceOther'];
            serviceTitles.forEach((key, index) => {
                if (serviceOptions[index]) {
                    serviceOptions[index].textContent = translations[currentLang][key];
                }
            });
            
            document.getElementById('currentLanguageText').textContent = lang.toUpperCase();
            updateModeIndicatorText();
            updateDeveloperModeIndicatorText();
            setTimeout(() => updateCommentTranslations(), 100);
            
            if (!orderStatusDisplay.classList.contains('hidden')) {
                const orderNumber = trackOrderInput.value.trim();
                if (orderNumber) trackOrderBtn.click();
            }
        }

        function showAlert(messageKey, type = 'alert', options = {}) {
            const { onConfirm, promptInput = null } = options;
            
            let messageText = translations[currentLang][messageKey] || messageKey;
            if (options.extraText) {
                messageText += ` ${options.extraText}`;
            }

            customAlertMessage.textContent = messageText;
            customAlertButtons.innerHTML = '';
            customAlertInputs.innerHTML = '';

            if (promptInput) {
                const input = document.createElement('input');
                input.type = promptInput.type || 'text';
                input.id = 'promptInput';
                input.className = 'mt-4 block w-full rounded-md shadow-sm p-2';
                input.placeholder = promptInput.placeholder || '';
                customAlertInputs.appendChild(input);
            }

            if (type === 'alert') {
                const closeBtn = document.createElement('button');
                closeBtn.className = 'btn-primary';
                closeBtn.textContent = translations[currentLang].customAlertClose;
                closeBtn.onclick = () => customAlertModal.classList.add('hidden');
                customAlertButtons.appendChild(closeBtn);
            } else if (type === 'confirm') {
                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'confirm-btn';
                confirmBtn.textContent = translations[currentLang].confirmText;
                confirmBtn.onclick = () => {
                    customAlertModal.classList.add('hidden');
                    const inputValue = promptInput ? document.getElementById('promptInput').value : null;
                    if (onConfirm) onConfirm(true, inputValue);
                };

                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'cancel-btn';
                cancelBtn.textContent = translations[currentLang].cancelText;
                cancelBtn.onclick = () => {
                    customAlertModal.classList.add('hidden');
                    if (onConfirm) onConfirm(false);
                };
                
                customAlertButtons.appendChild(confirmBtn);
                customAlertButtons.appendChild(cancelBtn);
            }
            customAlertModal.classList.remove('hidden');
        }

        hamburger.addEventListener('click', () => {
            navLinks.classList.toggle('hidden');
            navLinks.classList.toggle('open');
            hamburger.classList.toggle('open');
        });

        navLinks.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 767) {
                    navLinks.classList.add('hidden');
                    navLinks.classList.remove('open');
                    hamburger.classList.remove('open');
                }
            });
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetElement = document.querySelector(this.getAttribute('href'));
                if (targetElement) targetElement.scrollIntoView({ behavior: 'smooth' });
            });
        });

        function updateModeIndicatorText() {
            if (modeIndicator) {
                modeIndicator.textContent = body.classList.contains('dark') ? translations[currentLang].modeDark : translations[currentLang].modeLight;
                modeIndicator.className = `fixed bottom-4 right-4 px-3 py-1 rounded-full text-xs font-semibold z-50 ${body.classList.contains('dark') ? 'bg-gray-700 text-gray-100' : 'bg-gray-200 text-gray-800'}`;
            }
        }
        
        function applyDarkMode(isDark) {
            if (isDark) {
                body.classList.add('dark');
                darkModeIconPath.setAttribute('d', 'M12 2.5a.5.5 0 01.5.5v2a.5.5 0 01-1 0v-2a.5.5 0 01.5-.5zM18.364 5.636a.5.5 0 01.354.854l-1.414 1.414a.5.5 0 01-.707-.707l1.414-1.414a.5.5 0 01.353-.147zM21.5 12a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM18.364 18.364a.5.5 0 01-.354.854l-1.414-1.414a.5.5 0 01.707.707l1.414 1.414a.5.5 0 01-.353.147zM12 21.5a.5.5 0 01-.5-.5v-2a.5.5 0 011 0v2a.5.5 0 01-.5.5zM5.636 18.364a.5.5 0 01-.354-.854l1.414-1.414a.5.5 0 01.707.707l-1.414 1.414a.5.5 0 01-.353.147zM2.5 12a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM5.636 5.636a.5.5 0 01.354-.854l1.414 1.414a.5.5 0 01-.707.707L5.283 5.99a.5.5 0 01.353-.147zM12 7a5 5 0 100 10 5 5 0 000-10z');
            } else {
                body.classList.remove('dark');
                darkModeIconPath.setAttribute('d', 'M12 3a9 9 0 109 9c0-.46-.04-.92-.12-1.36a5.999 5.999 0 01-8.588-8.588C12.92 3.04 12.46 3 12 3z');
            }
            updateModeIndicatorText();
        }

        // UID Modal functionality
        let darkModeClickCount = 0;
        let lastDarkModeClickTime = 0;
        
        function showUidModal() {
            console.log('محاولة عرض نافذة UID...');
            
            // التحقق من حالة Firebase والمصادقة
            if (!auth || !auth.currentUser) {
                console.log('Firebase auth not ready, trying to sign in anonymously...');
                // محاولة تسجيل دخول مجهول إذا لم يكن هناك مستخدم
                if (auth) {
                    signInAnonymously(auth).then(() => {
                        console.log('تم تسجيل دخول مجهول بنجاح');
                        setTimeout(() => showUidModal(), 500);
                    }).catch((error) => {
                        console.error('خطأ في تسجيل الدخول المجهول:', error);
                        showAlert('حدث خطأ في تحميل البيانات. الرجاء إعادة تحميل الصفحة.');
                    });
                } else {
                    showAlert('جاري تحميل النظام... الرجاء المحاولة مرة أخرى خلال ثوانٍ قليلة.');
                }
                return;
            }
            
            // التأكد من وجود userId
            if (!userId && auth.currentUser) {
                userId = auth.currentUser.uid;
            }
            
            if (!userId) {
                showAlert('لم يتم العثور على معرف المستخدم. الرجاء إعادة تحميل الصفحة والمحاولة مرة أخرى.');
                return;
            }
            
            console.log('UID:', userId); // للتأكد من وجود UID
            console.log('User type:', auth.currentUser.isAnonymous ? 'Anonymous' : 'Authenticated');
            
            const modal = document.getElementById('uidModal');
            const uidDisplay = modal.querySelector('.uid-display');
            const titleElement = modal.querySelector('.uid-modal-title');
            const descElement = modal.querySelector('.uid-modal-description');
            const copyBtn = modal.querySelector('.uid-copy-btn');
            const closeBtn = modal.querySelector('.uid-close-btn');
            
            // Update text content based on current language
            titleElement.textContent = translations[currentLang].uidModalTitle;
            descElement.textContent = translations[currentLang].uidModalDescription;
            copyBtn.textContent = translations[currentLang].uidCopyBtn;
            closeBtn.textContent = translations[currentLang].uidModalClose;
            
            uidDisplay.textContent = userId;
            modal.classList.add('active');
            
            // Copy functionality
            copyBtn.onclick = () => {
                navigator.clipboard.writeText(userId).then(() => {
                    showCopyNotification(translations[currentLang].uidCopiedSuccess);
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = userId;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showCopyNotification(translations[currentLang].uidCopiedSuccess);
                });
            };
            
            // Close functionality
            closeBtn.onclick = () => modal.classList.remove('active');
            modal.onclick = (e) => {
                if (e.target === modal) modal.classList.remove('active');
            };
        }
        
        function showCopyNotification(message) {
            const notification = document.getElementById('copyNotification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        darkModeToggle.addEventListener('click', () => {
            const now = Date.now();
            
            // Check for multiple clicks within 4 seconds
            if (now - lastDarkModeClickTime < 4000) {
                darkModeClickCount++;
            } else {
                darkModeClickCount = 1;
            }
            lastDarkModeClickTime = now;
            
            console.log(`نقرة رقم ${darkModeClickCount} من 8 نقرات مطلوبة خلال 4 ثوانٍ`);
            console.log('حالة Firebase:', {
                authReady: !!auth,
                currentUser: !!auth?.currentUser,
                userId: userId,
                isAnonymous: auth?.currentUser?.isAnonymous
            });
            
            // Show UID modal if 8 clicks within 4 seconds
            if (darkModeClickCount === 8) {
                darkModeClickCount = 0;
                console.log('تم الوصول إلى 8 نقرات! سيتم عرض UID...');
                showUidModal();
                return; // Don't toggle dark mode
            }
            
            // Normal dark mode toggle
            const isDark = !body.classList.contains('dark');
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
            applyDarkMode(isDark);
        });

        languageDropdownButton.addEventListener('click', (e) => {
            languageDropdownMenu.classList.toggle('active');
            e.stopPropagation();
        });

        document.addEventListener('click', (e) => {
            if (!languageDropdownMenu.contains(e.target) && !languageDropdownButton.contains(e.target)) {
                languageDropdownMenu.classList.remove('active');
            }
        });

        languageDropdownMenu.querySelectorAll('li').forEach(item => {
            item.addEventListener('click', (e) => {
                setLanguage(e.target.getAttribute('data-lang'));
                languageDropdownMenu.classList.remove('active');
            });
        });
        
        commentImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    imagePreview.src = event.target.result;
                    imagePreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
                fileInputText.textContent = file.name.length > 20 ? file.name.substring(0, 17) + '...' : file.name;
            } else {
                imagePreview.src = '#';
                imagePreview.classList.add('hidden');
                fileInputText.textContent = translations[currentLang].fileInputChoose;
            }
        });

        function setupStarRating(container, input) {
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('span');
                star.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"></path></svg>`;
                star.dataset.value = i;
                container.appendChild(star);
            }
            
            const stars = container.querySelectorAll('span');
            const updateStars = (rating) => stars.forEach(star => star.querySelector('svg').classList.toggle('filled', star.dataset.value <= rating));

            container.addEventListener('click', e => {
                const star = e.target.closest('span');
                if (star) { input.value = star.dataset.value; updateStars(input.value); }
            });
            container.addEventListener('mouseover', e => {
                const star = e.target.closest('span');
                if (star) updateStars(star.dataset.value);
            });
            container.addEventListener('mouseout', () => updateStars(input.value));
            updateStars(input.value);
        }

        commentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }

            const submitBtn = commentForm.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = translations[currentLang].commentSending;

            try {
                const commentName = document.getElementById('commentName').value.trim();
                const commentText = document.getElementById('commentText').value.trim();
                const rating = parseInt(commentRatingValue.value, 10);
                const commentImageFile = commentImageInput.files[0];

                if (!commentName) { showAlert('alertNameTextEmpty'); return; }
                if (!commentText) { showAlert('alertCommentTextEmpty'); return; }

                let imageUrl = null;
                if (commentImageFile) {
                    const formData = new FormData();
                    formData.append("image", commentImageFile);
                    try {
                        const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
                        const result = await res.json();
                        if (result.success) {
                            imageUrl = result.data.url;
                        } else {
                            throw new Error(result.error.message);
                        }
                    } catch (err) {
                        console.error("Image upload failed:", err);
                        showAlert("imageUploadError");
                        return;
                    }
                }

                const { device, browser, deviceName } = getDeviceInfo();
                const ipAddress = await getIPAddress();
                
                await addDoc(collection(db, `artifacts/${appId}/public/data/comments`), {
                    name: commentName, text: commentText, rating, imageUrl, timestamp: serverTimestamp(), userId,
                    likes: 0, dislikes: 0, likedBy: [], dislikedBy: [],
                    device, browser, deviceName, latitude: userLocation.latitude, longitude: userLocation.longitude, ipAddress
                });
                
                commentForm.reset();
                imagePreview.classList.add('hidden');
                fileInputText.textContent = translations[currentLang].fileInputChoose;
                commentRatingValue.value = "0";
                setupStarRating(starRatingInputContainer, commentRatingValue);
                showAlert("alertCommentAddedSuccess");

            } catch (err) {
                console.error("Error adding comment: ", err);
                showAlert("alertCommentAddError");
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalBtnText;
            }
        });
        
        function createStarDisplay(rating) {
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                starsHTML += `<svg class="${i <= rating ? 'filled' : ''}" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"></path></svg>`;
            }
            return `<div class="star-rating">${starsHTML}</div>`;
        }
        
        function getDeviceIcon(device) {
            if (device === 'Desktop') return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor"><rect width="20" height="14" x="2" y="3" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>`;
            if (device === 'Tablet') return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tablet"><rect width="18" height="14" x="3" y="5" rx="2"/><path d="M7 19h10"/></svg>`;
            if (device === 'Mobile') return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-smartphone"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>`;
            return '';
        }

        function getDeviceInfo() {
            const ua = navigator.userAgent;
            let device = "Desktop", browser = "Unknown", os = "Unknown OS", deviceModel = "";
            if (/(tablet|ipad|playbook)|(android(?!.*mobile))/i.test(ua)) device = "Tablet";
            else if (/(Mobi|Android|iPhone)/i.test(ua)) device = "Mobile";
            if (/Chrome/.test(ua) && !/Edg/.test(ua)) browser = "Chrome";
            else if (/Firefox/.test(ua)) browser = "Firefox";
            else if (/Safari/.test(ua) && !/Chrome/.test(ua)) browser = "Safari";
            else if (/Edg/.test(ua)) browser = "Edge";
            if (/Win/.test(ua)) os = "Windows";
            if (/Mac/.test(ua)) os = "macOS";
            if (/Linux/.test(ua)) os = "Linux";
            if (/Android/.test(ua)) os = "Android";
            if (/iPhone/.test(ua)) os = "iOS";
            return { device, browser, deviceName: `${os} - ${browser}` };
        }

        async function getGeolocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => resolve({ latitude: position.coords.latitude, longitude: position.coords.longitude }),
                        () => resolve({ latitude: null, longitude: null })
                    );
                } else {
                    resolve({ latitude: null, longitude: null });
                }
            });
        }

        async function handleReaction(commentId, reactionType) {
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }
            const commentRef = doc(db, `artifacts/${appId}/public/data/comments`, commentId);
            try {
                await runTransaction(db, async (transaction) => {
                    const commentDoc = await transaction.get(commentRef);
                    if (!commentDoc.exists()) throw "Document does not exist!";
                    let { likes = 0, dislikes = 0, likedBy = [], dislikedBy = [] } = commentDoc.data();
                    const hasLiked = likedBy.includes(userId);
                    const hasDisliked = dislikedBy.includes(userId);
                    if (reactionType === 'like') {
                        transaction.update(commentRef, {
                            likes: hasLiked ? likes - 1 : likes + 1,
                            likedBy: hasLiked ? arrayRemove(userId) : arrayUnion(userId),
                            dislikes: hasDisliked ? dislikes - 1 : dislikes,
                            dislikedBy: hasDisliked ? arrayRemove(userId) : dislikedBy
                        });
                    } else if (reactionType === 'dislike') {
                        transaction.update(commentRef, {
                            dislikes: hasDisliked ? dislikes - 1 : dislikes + 1,
                            dislikedBy: hasDisliked ? arrayRemove(userId) : arrayUnion(userId),
                            likes: hasLiked ? likes - 1 : likes,
                            likedBy: hasLiked ? arrayRemove(userId) : likedBy
                        });
                    }
                });
            } catch (e) { console.error("Reaction transaction failed: ", e); }
        }
        
        async function resetDislikes(commentId) {
            showAlert("resetDislikesConfirm", 'confirm', { onConfirm: async (confirmed) => {
                if (confirmed) {
                    try {
                        await updateDoc(doc(db, `artifacts/${appId}/public/data/comments`, commentId), { dislikes: 0, dislikedBy: [] });
                        showAlert("resetDislikesSuccess");
                    } catch (e) { console.error("Error resetting dislikes:", e); showAlert("resetDislikesError"); }
                }
            }});
        }

        async function deleteComment(commentId, commentUserId) {
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }
            if (userId !== commentUserId && !isDeveloperMode) { showAlert("alertNoPermission"); return; }
            showAlert("alertDeleteConfirm", 'confirm', { onConfirm: async (confirmed) => {
                if (confirmed) {
                    try {
                        await deleteDoc(doc(db, `artifacts/${appId}/public/data/comments`, commentId));
                        showAlert("alertDeleteSuccess");
                    } catch (e) { console.error("Error deleting document: ", e); showAlert("alertDeleteError"); }
                }
            }});
        }
        
        function loadComments() {
            if (!db) return;
            const q = query(collection(db, `artifacts/${appId}/public/data/comments`));
            onSnapshot(q, async (snapshot) => {
                let comments = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                comments.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));
                commentsList.innerHTML = '';
                commentsLoading.classList.add('hidden');
                noComments.classList.toggle('hidden', comments.length > 0);
                for (const comment of comments) {
                    const commentElement = document.createElement('div');
                    commentElement.className = 'p-4 rounded-lg shadow-sm relative';
                    commentElement.dataset.commentId = comment.id;
                    const commentDate = comment.timestamp ? new Date(comment.timestamp.toDate()).toLocaleString(currentLang) : '';
                    const geolocationHTML = (comment.latitude && comment.longitude) ? `<a href="https://www.google.com/maps/search/?api=1&query=${comment.latitude},${comment.longitude}" target="_blank" class="map-link">Show Location</a>` : translations[currentLang].locationUnavailable;
                    const ipAddressHTML = (isDeveloperMode && comment.ipAddress) ? `<span class="text-sm font-light text-gray-500 dark:text-gray-400 ml-2">(IP: <span class="ip-address">${comment.ipAddress}</span>)</span>` : '';
                    const userIdHTML = (isDeveloperMode && comment.userId) ? `<span class="text-sm font-light text-gray-500 dark:text-gray-400 ml-2">(UID: <span class="ip-address">${comment.userId}</span>)</span>` : '';
                    const deviceInfoHTML = isDeveloperMode ? `<div class="device-info mt-1">${getDeviceIcon(comment.device)}<span class="text-xs">${comment.deviceName || 'Unknown'}</span><div class="flex items-center text-xs">${geolocationHTML}</div></div>` : '';
                    
                    commentElement.innerHTML = `
                        <div class="flex items-start justify-between mb-2 gap-4">
                            <div class="flex items-center gap-3">
                                <p class="font-semibold text-indigo-600 dark:text-indigo-300">${comment.name || 'Anonymous'}</p>
                                ${ipAddressHTML}
                                ${userIdHTML}
                                ${comment.rating > 0 ? createStarDisplay(comment.rating) : ''}
                            </div>
                            <div class="flex items-center flex-shrink-0">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mx-2">${commentDate}</p>
                                ${(userId === comment.userId || isDeveloperMode) ? `<button class="text-red-500 hover:text-red-700 p-1" data-action="delete"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm2 3a1 1 0 011-1h2a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button>` : ''}
                            </div>
                        </div>
                        ${deviceInfoHTML}
                        <p class="comment-text-display mt-1" data-original-text="${comment.text}">${comment.text}</p>
                        ${comment.imageUrl ? `<img src="${comment.imageUrl}" alt="Comment Image" class="mt-4 comment-image" onclick="window.showFullImage('${comment.imageUrl}')">` : ''}
                        <div class="comment-actions">
                            <button class="action-btn ${comment.likedBy?.includes(userId) ? 'liked' : ''}" data-action="like"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333V19h8.333a2 2 0 001.992-1.838l.93-5.585A2 2 0 0015.333 9H12V4.5a2.5 2.5 0 00-5 0V9H6Z"></path></svg><span>${comment.likes || 0}</span></button>
                            <button class="action-btn ${comment.dislikedBy?.includes(userId) ? 'disliked' : ''}" data-action="dislike"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667V1H5.667a2 2 0 00-1.992 1.838l-.93-5.585A2 2 0 004.667 11H8v4.5a2.5 2.5 0 005 0V11h3.333Z"></path></svg><span>${comment.dislikes || 0}</span></button>
                        </div>`;
                    commentsList.appendChild(commentElement);
                    commentElement.addEventListener('click', (e) => {
                        const button = e.target.closest('button[data-action]');
                        if (!button) return;
                        const action = button.dataset.action;
                        if (action === 'like' || action === 'dislike') handleReaction(comment.id, action);
                        else if (action === 'delete') deleteComment(comment.id, comment.userId);
                    });
                }
                setTimeout(() => updateCommentTranslations(), 100);
            }, (error) => console.error("Error listening to comments:", error));
        }
        
        let footerClickCount = 0, lastFooterClickTime = 0;
        let devModeExtraClickCount = 0, lastDevModeExtraClickTime = 0;

        async function checkAuthorizedDeveloper() {
            if (!isAuthReady || !userId) {
                showAlert("alertFirebaseNotReady");
                return false;
            }
            
            try {
                // قائمة UIDs المصرح لهم كمطورين
                // قم بتغيير هذه القائمة لتتضمن UIDs الخاصة بالمطورين المصرح لهم فقط
                // للحصول على UID الخاص بك، قم بتسجيل الدخول ثم افتح وحدة تحكم المتصفح (F12) واكتب:
                // console.log(userId)
                // ثم قم بنسخ الـ UID الظاهر وإضافته هنا
                const authorizedUIDs = [
                    userId // إضافة UID المستخدم الحالي تلقائياً
                ];
                
                // التحقق مما إذا كان المستخدم الحالي في قائمة المطورين المصرح لهم
                return authorizedUIDs.includes(userId);
            } catch (error) {
                console.error("Error checking developer authorization:", error);
                return false;
            }
        }
        
        async function updateSecurityRules() {
            // هذه الوظيفة ستكون مسؤولة عن تحديث قواعد الأمان
            // في بيئة حقيقية، ستحتاج إلى استدعاء API لتحديث قواعد الأمان
            // هنا نقوم فقط بمحاكاة نجاح العملية وعرض رسالة تنبيه
            
            try {
                // محاكاة تأخير لعملية التحديث
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // عرض رسالة نجاح التحديث
                showAlert("alertSecurityRulesUpdated");
                return true;
            } catch (error) {
                console.error("Error updating security rules:", error);
                return false;
            }
        }

        async function enableDeveloperMode() {
            // التحقق مما إذا كان المستخدم مطورًا مصرحًا له
            const isAuthorized = await checkAuthorizedDeveloper();
            
            if (isAuthorized) {
                isDeveloperMode = true;
                developerDashboard.classList.remove('hidden');
                developerModeIndicator.style.display = 'block';
                updateDeveloperModeIndicatorText();
                loadComments();
                loadDevOrders();
                loadPaymentMethods(); // Load payment methods for dev
                loadCoupons(); // Load coupons for dev
            } else {
                // إذا لم يكن المستخدم مصرحًا له، أظهر رسالة خطأ
                showAlert("alertNotAuthorized", 'alert', {
                    extraText: "أنت غير مصرح لك بالوصول إلى وضع المطور."
                });
            }
        }

        function promptForDeveloperMode() {
            // التحقق من تسجيل الدخول أولاً
            if (!isAuthReady || !userId) {
                showAlert("alertLoginRequired", 'alert', {
                    extraText: "يجب تسجيل الدخول أولاً للوصول إلى وضع المطور."
                });
                return;
            }
            
            showAlert("alertDeveloperModePrompt", 'confirm', {
                promptInput: { type: 'password', placeholder: 'Secret Code...' },
                extraText: userId,
                onConfirm: async (confirmed, value) => {
                    if (!confirmed || !value) return;
                    
                    // التحقق مما إذا كان المستخدم مصرحًا له بالفعل
                    const isAuthorized = await checkAuthorizedDeveloper();
                    if (isAuthorized) {
                        enableDeveloperMode();
                    } else {
                        // إذا لم يكن المستخدم مصرحًا له، أظهر رسالة خطأ
                        showAlert("alertNotAuthorized", 'alert', {
                            extraText: "أنت غير مصرح لك بالوصول إلى وضع المطور."
                        });
                    }
                }
            });
        }

        async function generateAndShowOneTimeCode() {
            // هذه الدالة لم تعد ضرورية لأن المستخدمين المصرح لهم محددين مسبقاً في قائمة UIDs
            // ولكن نحتفظ بها للتوافق مع الكود الحالي
            showAlert("alertNotAuthorized", 'alert', {
                extraText: "تم تغيير نظام الصلاحيات. لم تعد هناك حاجة لإنشاء رموز مؤقتة."
            });
        }
        
        function promptForSuperSecretCode() {
            // التحقق من تسجيل الدخول أولاً
            if (!isAuthReady || !userId) {
                showAlert("alertLoginRequired", 'alert', {
                    extraText: "يجب تسجيل الدخول أولاً للوصول إلى وضع المطور."
                });
                return;
            }
            
            // التحقق مما إذا كان المستخدم مصرحًا له
            checkAuthorizedDeveloper().then(isAuthorized => {
                if (!isAuthorized) {
                    showAlert("alertNotAuthorized", 'alert', {
                        extraText: "أنت غير مصرح لك بالوصول إلى وضع المطور."
                    });
                    return;
                }
                
                // إذا كان المستخدم مصرحًا له، أخبره أن نظام الصلاحيات قد تغير
                showAlert("alertNotAuthorized", 'alert', {
                    extraText: "تم تغيير نظام الصلاحيات. لم تعد هناك حاجة لإنشاء رموز مؤقتة."
                });
            }).catch(error => {
                console.error("Error checking developer authorization:", error);
                showAlert("alertDeveloperAuthError");
            });
        }

        footerCopyright.addEventListener('click', () => {
            const now = Date.now();
            if (isDeveloperMode) {
                if (now - lastDevModeExtraClickTime < 5000) {
                    devModeExtraClickCount++;
                } else {
                    devModeExtraClickCount = 1;
                }
                lastDevModeExtraClickTime = now;

                if (devModeExtraClickCount === 4) {
                    devModeExtraClickCount = 0;
                    promptForSuperSecretCode();
                }
            } else {
                if (now - lastFooterClickTime < 3000) {
                    footerClickCount++;
                } else {
                    footerClickCount = 1;
                }
                lastFooterClickTime = now;
                if (footerClickCount === 8) { // Changed from 5 to 8
                    footerClickCount = 0;
                    promptForDeveloperMode();
                }
            }
        });


        function updateDeveloperModeIndicatorText() {
            if (developerModeIndicator) developerModeIndicator.textContent = translations[currentLang].developerModeIndicatorText;
        }
        
        developerModeIndicator.addEventListener('click', () => {
            isDeveloperMode = false;
            developerDashboard.classList.add('hidden');
            developerModeIndicator.style.display = 'none';
            loadComments();
        });
        
        window.showFullImage = (imageUrl) => {
            fullImage.src = imageUrl;
            fullImageModal.classList.add('active');
        };
        fullImageModal.addEventListener('click', () => fullImageModal.classList.remove('active'));

        function showOrderModal() {
            orderModal.classList.add('active');
            getGeolocation().then(loc => userLocation = loc);
        }
        function hideOrderModal() {
            orderModal.classList.remove('active');
            orderForm.reset();
            otherServiceField.classList.add('hidden');
            orderFiles = [];
            updateOrderFilePreview();
            // Reset coupon data
            appliedCoupon = null;
            discountPercentage = 0;
            couponMessage.classList.add('hidden');
            discountInfo.classList.add('hidden');
        }

        function showOrderSubmittedModal(orderId) {
            document.getElementById('submittedOrderId').textContent = orderId;
            orderSubmittedModal.classList.remove('hidden');
        }
        
        heroOrderNowBtn.addEventListener('click', showOrderModal);
        orderNowNavBtn.addEventListener('click', showOrderModal);
        closeOrderModal.addEventListener('click', hideOrderModal);
        orderModal.addEventListener('click', (e) => { if (e.target === orderModal) hideOrderModal(); });
        closeOrderSubmittedModal.addEventListener('click', () => orderSubmittedModal.classList.add('hidden'));

        orderServiceSelect.addEventListener('change', (e) => {
            const selectedOption = e.target.options[e.target.selectedIndex];
            const langKey = selectedOption.getAttribute('data-lang-key');
            if (langKey === 'orderServiceOther') {
                otherServiceField.classList.remove('hidden');
                otherServiceText.required = true;
            } else {
                otherServiceField.classList.add('hidden');
                otherServiceText.required = false;
            }
        });
        
        function updateOrderFilePreview() {
            orderImagesPreview.innerHTML = '';
            if (orderFiles.length > 0) {
                orderFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'relative flex items-center p-2 bg-gray-100 dark:bg-gray-700 rounded-md';
                    fileItem.innerHTML = `<span class="text-xs truncate">${file.name}</span><button type="button" class="text-red-500 ml-auto">&times;</button>`;
                    fileItem.querySelector('button').onclick = (e) => {
                        e.preventDefault();
                        orderFiles.splice(index, 1);
                        updateOrderFilePreview();
                    };
                    orderImagesPreview.appendChild(fileItem);
                });
                orderFileInputText.textContent = `${orderFiles.length} images selected`;
            } else {
                orderFileInputText.textContent = translations[currentLang].fileInputChoose;
            }
        }
        
        orderFilesInput.addEventListener('change', (e) => {
            orderFiles = Array.from(e.target.files).filter(file => file.type.startsWith('image/'));
            updateOrderFilePreview();
            e.target.value = null;
        });
        
        // Coupon functionality
        async function applyCoupon() {
            const couponCode = couponCodeInput.value.trim();
            if (!couponCode) {
                showCouponMessage(translations[currentLang].couponEnterCode, 'error');
                return;
            }
            
            try {
                const couponsRef = collection(db, `artifacts/${appId}/public/data/coupons`);
                const q = query(couponsRef, where('code', '==', couponCode));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    showCouponMessage(translations[currentLang].couponInvalidCode, 'error');
                    return;
                }
                
                const couponDoc = querySnapshot.docs[0];
                const coupon = couponDoc.data();
                
                if (coupon.maxUses !== -1 && coupon.uses >= coupon.maxUses) {
                    showCouponMessage(translations[currentLang].couponUsageLimitExceeded, 'error');
                    return;
                }
                
                appliedCoupon = { ...coupon, id: couponDoc.id };
                discountPercentage = coupon.discount;
                showCouponMessage(`${translations[currentLang].couponAppliedSuccess} ${translations[currentLang].discountApplied} ${discountPercentage}%`, 'success');
                showDiscountInfo(coupon.code, discountPercentage);
                
            } catch (error) {
                console.error('Error applying coupon:', error);
                showCouponMessage(translations[currentLang].couponInvalidCode, 'error');
            }
        }
        
        function showCouponMessage(message, type) {
            couponMessage.textContent = message;
            couponMessage.className = `mt-2 text-sm ${type === 'success' ? 'text-green-600' : 'text-red-600'}`;
            couponMessage.classList.remove('hidden');
        }
        
        function showDiscountInfo(code, discount) {
            discountInfo.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${translations[currentLang].couponCodeApplied} <strong>${code}</strong></span>
                    <span>${translations[currentLang].discountPercentage} <strong>${discount}%</strong></span>
                </div>
            `;
            discountInfo.classList.remove('hidden');
        }
        
        applyCouponBtn.addEventListener('click', applyCoupon);

        orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }
            
            const originalBtnText = submitOrderBtn.textContent;
            submitOrderBtn.disabled = true;
            submitOrderBtn.textContent = translations[currentLang].orderSubmitting;
            
            const ipAddress = await getIPAddress();
            const { device, browser, deviceName } = getDeviceInfo();
            
            let uploadedImageUrls = [];
            if (orderFiles.length > 0) {
                try {
                    const uploadPromises = orderFiles.map(file => {
                        const imgbbFormData = new FormData();
                        imgbbFormData.append("image", file);
                        return fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: imgbbFormData })
                            .then(res => res.json()).then(result => result.success ? result.data.url : Promise.reject(result.error.message));
                    });
                    uploadedImageUrls = await Promise.all(uploadPromises);
                } catch (err) {
                    console.error("Image upload failed:", err);
                    showAlert("imageUploadError");
                    submitOrderBtn.disabled = false;
                    submitOrderBtn.textContent = originalBtnText;
                    return;
                }
            }

            const orderId = String(Math.floor(100000 + Math.random() * 900000));
            
            try {
                const serviceValue = orderForm.elements['service'].value;
                const finalService = serviceValue === 'أخرى' ? orderForm.elements['other_service'].value : serviceValue;
                
                const orderData = {
                    orderId, userId,
                    name: orderForm.elements['name'].value, email: orderForm.elements['email'].value, phone: orderForm.elements['phone'].value,
                    service: finalService,
                    details: orderForm.elements['details'].value, images: uploadedImageUrls,
                    status: 1, // 1: Awaiting Approval
                    timestamp: serverTimestamp(), ipAddress, device, browser, deviceName,
                    latitude: userLocation.latitude, longitude: userLocation.longitude,
                    previewImages: [], estimatedPrice: null, finalPrice: null, currency: null, rejectionReason: null, 
                    discount: appliedCoupon ? discountPercentage : null,
                    couponCode: appliedCoupon ? appliedCoupon.code : null,
                    paidViaBank: null, receiptUrl: null, assignedDeveloper: null // Initialize new fields
                };
                await addDoc(collection(db, `artifacts/${appId}/public/data/orders`), orderData);
                
                // Update coupon usage count if coupon was applied
                if (appliedCoupon) {
                    try {
                        const couponRef = doc(db, `artifacts/${appId}/public/data/coupons`, appliedCoupon.id);
                        await runTransaction(db, async (transaction) => {
                            const couponDoc = await transaction.get(couponRef);
                            if (couponDoc.exists()) {
                                const currentUses = couponDoc.data().uses || 0;
                                transaction.update(couponRef, { uses: currentUses + 1 });
                            }
                        });
                    } catch (error) {
                        console.error('Error updating coupon usage:', error);
                    }
                }

                const formspreeData = new FormData();
                formspreeData.append('Order ID', orderId);
                formspreeData.append('Name', orderData.name);
                formspreeData.append('Email', orderData.email);
                formspreeData.append('Phone', orderData.phone);
                formspreeData.append('Service', orderData.service);
                formspreeData.append('Details', orderData.details);
                formspreeData.append('Image URLs', uploadedImageUrls.join('\n'));
                if (appliedCoupon) {
                    formspreeData.append('Coupon Code', appliedCoupon.code);
                    formspreeData.append('Discount', `${discountPercentage}%`);
                }
                formspreeData.append('IP Address', ipAddress);
                formspreeData.append('Device Info', `${device} - ${browser} (${deviceName})`);
                if(userLocation.latitude && userLocation.longitude) {
                    formspreeData.append('Location Link', `https://www.google.com/maps/search/?api=1&query=${userLocation.latitude},${userLocation.longitude}`);
                }

                await fetch(FORMSPREE_ENDPOINT, {
                    method: 'POST', body: formspreeData, headers: { 'Accept': 'application/json' }
                });

                hideOrderModal();
                showOrderSubmittedModal(orderId);

            } catch (err) {
                console.error("Error submitting form: ", err);
                showAlert("orderError");
            } finally {
                submitOrderBtn.disabled = false;
                submitOrderBtn.textContent = originalBtnText;
            }
        });

        trackOrderBtn.addEventListener('click', async () => {
            const orderNumber = trackOrderInput.value.trim();
            if (!/^\d{6}$/.test(orderNumber)) { showAlert("orderNotFound"); return; }
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }

            orderStatusDisplay.classList.add('hidden');
            const q = query(collection(db, `artifacts/${appId}/public/data/orders`), where('orderId', '==', orderNumber));
            
            const unsubscribe = onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    showAlert("orderNotFound");
                    return;
                }
                const orderDoc = snapshot.docs[0];
                displayOrderStatus(orderDoc.data(), orderDoc.id); // Pass doc ID
            }, (error) => {
                console.error("Error tracking order:", error);
                showAlert("orderTrackError");
            });
        });

        function drawProgressBar(currentStatus) {
            const canvas = progressBarCanvas;
            const ctx = canvas.getContext('2d');
            const containerWidth = canvas.parentElement.clientWidth;
            canvas.width = Math.max(containerWidth - 40, 300);
            const width = canvas.width;
            const height = canvas.height;
            const numSteps = 5;
            const circleRadius = 15;
            const horizontalPadding = 50;
            const stepSpacing = (width - horizontalPadding * 2) / (numSteps - 1);
            const lineY = height / 2.5;

            ctx.clearRect(0, 0, width, height);
            
            const isDarkMode = body.classList.contains('dark');
            const inactiveColor = isDarkMode ? '#4a5568' : '#e2e8f0';
            const activeColor = '#10b981';
            const isRTL = htmlElement.dir === 'rtl';

            ctx.beginPath();
            ctx.lineWidth = 4;
            ctx.strokeStyle = inactiveColor;
            ctx.moveTo(isRTL ? width - horizontalPadding : horizontalPadding, lineY);
            ctx.lineTo(isRTL ? horizontalPadding : width - horizontalPadding, lineY);
            ctx.stroke();

            if (currentStatus > 0) {
                ctx.beginPath();
                ctx.strokeStyle = activeColor;
                ctx.lineWidth = 4;
                if (isRTL) {
                    ctx.moveTo(width - horizontalPadding, lineY);
                    ctx.lineTo(width - horizontalPadding - (currentStatus - 1) * stepSpacing, lineY);
                } else {
                    ctx.moveTo(horizontalPadding, lineY);
                    ctx.lineTo(horizontalPadding + (currentStatus - 1) * stepSpacing, lineY);
                }
                ctx.stroke();
            }

            for (let i = 0; i < numSteps; i++) {
                const stepNumber = i + 1;
                const x = isRTL ? (width - horizontalPadding - i * stepSpacing) : (horizontalPadding + i * stepSpacing);
                const isActive = stepNumber <= currentStatus;
                const isCurrent = stepNumber === currentStatus;
                
                if (isCurrent) {
                    ctx.beginPath();
                    ctx.arc(x, lineY, circleRadius + 2, 0, 2 * Math.PI);
                    ctx.fillStyle = 'rgba(16, 185, 129, 0.5)';
                    ctx.fill();
                }

                ctx.beginPath();
                ctx.arc(x, lineY, circleRadius, 0, 2 * Math.PI);
                ctx.fillStyle = isActive ? activeColor : inactiveColor;
                ctx.fill();

                ctx.fillStyle = isActive ? 'white' : (isDarkMode ? '#cbd5e0' : '#64748b');
                ctx.font = 'bold 16px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(stepNumber, x, lineY);
            }
        }
        
        function displayOrderStatus(order, orderDocId) {
            orderStatusDisplay.classList.remove('hidden');
            displayedOrderId.textContent = order.orderId;
            const { status, rejectionReason, estimatedPrice, finalPrice, currency, discount, paidViaBank, receiptUrl } = order;

            if (status === 0) { // Rejected
                rejectionInfo.classList.remove('hidden');
                progressContainer.classList.add('hidden');
                rejectionInfo.querySelector('p[data-lang-key="orderRejected"]').textContent = translations[currentLang].orderRejected;
                if (rejectionReason) {
                    rejectionReasonText.textContent = `${translations[currentLang].orderRejectedReason} ${rejectionReason}`;
                    rejectionReasonText.classList.remove('hidden');
                } else {
                    rejectionReasonText.classList.add('hidden');
                }
            } else {
                rejectionInfo.classList.add('hidden');
                progressContainer.classList.remove('hidden');
                drawProgressBar(status);
                progressStepsLabels.forEach(step => {
                    const stepNumber = parseInt(step.dataset.step, 10);
                    const label = step.querySelector('.progress-label');
                    label.classList.toggle('active', stepNumber === status);
                });
            }

            invoiceInfo.innerHTML = '';
            if (finalPrice) {
                invoiceInfo.classList.remove('hidden');
                let invoiceHTML = '';
                const currentCurrency = currency || '';

                if (discount && discount > 0) {
                    const discountAmount = (finalPrice * (discount / 100)).toFixed(2);
                    const totalAfterDiscount = (finalPrice - discountAmount).toFixed(2);
                    invoiceHTML = `
                        <div class="flex justify-between"><p>${translations[currentLang].invoiceSubtotal}:</p><p>${finalPrice} ${currentCurrency}</p></div>
                        <div class="flex justify-between text-red-500"><p>${translations[currentLang].invoiceDiscount}:</p><p>${discount}%</p></div>
                        <div class="flex justify-between text-red-500"><p>${translations[currentLang].invoiceDiscountValue}:</p><p>-${discountAmount} ${currentCurrency}</p></div>
                        <hr class="border-gray-400 dark:border-gray-500 my-1">
                        <div class="flex justify-between font-bold text-lg"><p>${translations[currentLang].invoiceTotal}:</p><p>${totalAfterDiscount} ${currentCurrency}</p></div>
                    `;
                } else {
                     invoiceHTML = `<div class="flex justify-between font-bold text-lg"><p>${translations[currentLang].invoiceTotal}:</p><p>${finalPrice} ${currentCurrency}</p></div>`;
                }
                
                if (status === 5 && paidViaBank) {
                    invoiceHTML += `<div class="flex justify-between text-sm mt-2"><p>${translations[currentLang].devPaidVia}:</p><p class="font-semibold">${paidViaBank}</p></div>`;
                }

                invoiceInfo.innerHTML = invoiceHTML;

            } else if (estimatedPrice) {
                invoiceInfo.classList.remove('hidden');
                invoiceInfo.innerHTML = `<p class="text-lg">${translations[currentLang].devEstimatedPrice} ${estimatedPrice} ${currency || ''}</p>`;
            } else {
                invoiceInfo.classList.add('hidden');
            }
            
            orderPreviewImages.innerHTML = '';
            if (status >= 3 && order.previewImages?.length > 0) {
                orderPreviewImages.classList.remove('hidden');
                order.previewImages.forEach(imageUrl => {
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.className = 'order-preview-image';
                    img.onclick = () => window.showFullImage(imageUrl);
                    orderPreviewImages.appendChild(img);
                });
            } else {
                orderPreviewImages.classList.add('hidden');
            }

            // Show payment options accordion
            if (order.status === 4) {
                const q = query(collection(db, `artifacts/${appId}/public/data/paymentMethods`));
                getDocs(q).then(snapshot => {
                    const methods = snapshot.docs.map(doc => doc.data());
                    if (methods.length > 0) {
                        paymentAccordion.classList.remove('hidden');
                        customerPaymentMethodsList.innerHTML = '';
                        methods.forEach(method => {
                            const methodEl = document.createElement('div');
                            methodEl.className = 'bank-accordion-item overflow-hidden rounded-lg';
                            
                            methodEl.innerHTML = `
                                <div class="accordion-header p-4 flex justify-between items-center w-full text-right">
                                    <span class="font-semibold">${method.bankName}</span>
                                    <svg class="accordion-icon w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                </div>
                                <div class="accordion-body space-y-3">
                                    <div class="space-y-1">
                                        <p><strong data-lang-key="devAccountHolderName">${translations[currentLang].devAccountHolderName}</strong> ${method.accountHolderName}</p>
                                        <p><strong data-lang-key="devIban">${translations[currentLang].devIban}</strong> <span class="select-all">${method.iban}</span></p>
                                        ${method.phone ? `<p><strong data-lang-key="devPhoneNumber">${translations[currentLang].devPhoneNumber}</strong> ${method.phone}</p>` : ''}
                                    </div>
                                    <button class="btn-primary w-full sm:w-auto text-sm" data-iban="${method.iban}" data-lang-key="copyIban">${translations[currentLang].copyIban}</button>
                                </div>
                            `;
                            
                            const header = methodEl.querySelector('.accordion-header');
                            const body = methodEl.querySelector('.accordion-body');
                            
                            header.addEventListener('click', () => {
                                body.classList.toggle('open');
                                header.classList.toggle('open');
                            });

                            methodEl.querySelector('button').onclick = (e) => {
                                copyToClipboard(e.target.dataset.iban);
                            };
                            customerPaymentMethodsList.appendChild(methodEl);
                        });
                    } else {
                        paymentAccordion.classList.add('hidden');
                    }
                });
            } else {
                paymentAccordion.classList.add('hidden');
            }

            // Show receipt upload/display section
            if (status === 4 || status === 5) {
                receiptSection.classList.remove('hidden');
                receiptSection.innerHTML = ''; // Clear previous content

                const title = document.createElement('h4');
                title.className = 'font-bold text-lg mb-2';
                title.setAttribute('data-lang-key', 'receiptTitle');
                title.textContent = translations[currentLang].receiptTitle;
                receiptSection.appendChild(title);

                if (receiptUrl) {
                    const receiptImageContainer = document.createElement('div');
                    receiptImageContainer.className = 'receipt-image-container';
                    receiptImageContainer.innerHTML = `<img src="${receiptUrl}" alt="Receipt Image" class="receipt-image" onclick="window.showFullImage('${receiptUrl}')">`;
                    receiptSection.appendChild(receiptImageContainer);
                    
                    if (status === 4) { // Only allow changing receipt if status is 'Awaiting Payment'
                        const changeBtn = document.createElement('button');
                        changeBtn.id = `change-receipt-btn-${orderDocId}`;
                        changeBtn.className = 'btn-primary text-sm mt-2';
                        changeBtn.setAttribute('data-lang-key', 'receiptChangeBtn');
                        changeBtn.textContent = translations[currentLang].receiptChangeBtn;
                        receiptSection.appendChild(changeBtn);
                        changeBtn.onclick = () => {
                            document.getElementById(`receipt-upload-form-${orderDocId}`).classList.remove('hidden');
                            changeBtn.classList.add('hidden');
                        };
                    }
                }

                if (status === 4) { // Show upload form only if 'Awaiting Payment'
                    const uploadForm = document.createElement('div');
                    uploadForm.id = `receipt-upload-form-${orderDocId}`;
                    if(receiptUrl) uploadForm.classList.add('hidden'); // Hide if receipt already exists

                    uploadForm.innerHTML = `
                        <p class="text-sm mt-2" data-lang-key="receiptUploadPrompt">${translations[currentLang].receiptUploadPrompt}</p>
                        <div class="relative mt-2">
                            <input type="file" id="receipt-file-${orderDocId}" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                            <div class="custom-file-input"><span id="receipt-file-text-${orderDocId}" data-lang-key="fileInputChoose">${translations[currentLang].fileInputChoose}</span></div>
                        </div>
                        <button id="upload-receipt-btn-${orderDocId}" class="btn-primary w-full mt-2" data-lang-key="receiptUploadBtn" disabled>${translations[currentLang].receiptUploadBtn}</button>
                    `;
                    receiptSection.appendChild(uploadForm);

                    const fileInput = document.getElementById(`receipt-file-${orderDocId}`);
                    const fileText = document.getElementById(`receipt-file-text-${orderDocId}`);
                    const uploadBtn = document.getElementById(`upload-receipt-btn-${orderDocId}`);

                    fileInput.onchange = () => {
                        if (fileInput.files.length > 0) {
                            fileText.textContent = fileInput.files[0].name;
                            uploadBtn.disabled = false;
                        } else {
                            fileText.textContent = translations[currentLang].fileInputChoose;
                            uploadBtn.disabled = true;
                        }
                    };
                    
                    uploadBtn.onclick = () => uploadReceipt(orderDocId, fileInput.files[0]);
                }

            } else {
                receiptSection.classList.add('hidden');
            }
        }

        async function uploadReceipt(orderDocId, file) {
            if (!file) return;
            const uploadBtn = document.getElementById(`upload-receipt-btn-${orderDocId}`);
            const originalBtnText = uploadBtn.textContent;
            uploadBtn.disabled = true;
            uploadBtn.textContent = translations[currentLang].receiptUploading;

            const formData = new FormData();
            formData.append("image", file);
            try {
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
                const result = await res.json();
                if (result.success) {
                    const orderRef = doc(db, `artifacts/${appId}/public/data/orders`, orderDocId);
                    await updateDoc(orderRef, { receiptUrl: result.data.url });
                    showAlert("receiptUploadSuccess");
                } else {
                    throw new Error(result.error.message);
                }
            } catch (err) {
                console.error("Receipt upload failed:", err);
                showAlert("receiptUploadError");
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = originalBtnText;
            }
        }
        
        togglePaymentBtn.addEventListener('click', () => {
            const icon = document.getElementById('paymentAccordionIcon');
            paymentMethodsContainer.classList.toggle('hidden');
            if (paymentMethodsContainer.classList.contains('hidden')) {
                icon.style.transform = 'rotate(0deg)';
            } else {
                icon.style.transform = 'rotate(180deg)';
            }
        });

        async function deletePreviewImage(orderId, imageUrl) {
            showAlert("alertDeletePreviewImageConfirm", 'confirm', {
                onConfirm: async (confirmed) => {
                    if (confirmed) {
                        const orderRef = doc(db, `artifacts/${appId}/public/data/orders`, orderId);
                        try {
                            await updateDoc(orderRef, {
                                previewImages: arrayRemove(imageUrl)
                            });
                            showAlert("alertDeletePreviewImageSuccess");
                        } catch (err) {
                            console.error("Error deleting preview image:", err);
                            showAlert("alertDeletePreviewImageError");
                        }
                    }
                }
            });
        }

        async function loadDevOrders() {
            if (!isAuthReady || !isDeveloperMode) {
                developerDashboard.classList.add('hidden');
                return;
            }
            developerDashboard.classList.remove('hidden');
            
            const paymentMethodsSnapshot = await getDocs(query(collection(db, `artifacts/${appId}/public/data/paymentMethods`)));
            const paymentMethods = paymentMethodsSnapshot.docs.map(doc => doc.data());

            const q = query(collection(db, `artifacts/${appId}/public/data/orders`));
            onSnapshot(q, (snapshot) => {
                let orders = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                orders.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));
                
                devOrdersList.innerHTML = '';
                devLoadingText.classList.add('hidden');
                noOrdersText.classList.toggle('hidden', orders.length > 0);

                orders.forEach(order => {
                    const orderDate = order.timestamp ? new Date(order.timestamp.toDate()).toLocaleString() : 'N/A';
                    const orderElement = document.createElement('div');
                    orderElement.className = 'card space-y-4';
                    
                    let paymentInfoHTML = '';
                    if (order.status === 5) {
                        let optionsHTML = `<option value="">${translations[currentLang].devSelectBank}</option>`;
                        paymentMethods.forEach(method => {
                            optionsHTML += `<option value="${method.bankName}" ${order.paidViaBank === method.bankName ? 'selected' : ''}>${method.bankName}</option>`;
                        });
                        paymentInfoHTML = `
                        <div class="mt-2">
                            <label for="paid-via-${order.id}" class="block text-sm font-medium">${translations[currentLang].devPaidVia}</label>
                            <select id="paid-via-${order.id}" class="w-full rounded-md shadow-sm p-2 mt-1">
                                ${optionsHTML}
                            </select>
                        </div>`;
                    }
                    
                    const previewImagesHTML = order.previewImages?.length > 0 
                        ? order.previewImages.map(img => `
                            <div class="relative">
                                <img src="${img}" class="w-16 h-16 object-cover rounded-md cursor-pointer" onclick="window.showFullImage('${img}')">
                                <button class="delete-preview-btn absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-75 hover:opacity-100" data-order-id="${order.id}" data-image-url="${img}">&times;</button>
                            </div>`).join('') 
                        : `<p class="text-sm italic">${translations[currentLang].devNoImages}</p>`;

                    orderElement.innerHTML = `
                        <div><h4 class="font-bold text-lg text-indigo-500">${translations[currentLang].devOrderId} <span class="text-xl font-bold">${order.orderId}</span></h4></div>
                        <p><strong>${translations[currentLang].devOrderUser}</strong> ${order.name}</p>
                        <p><strong>${translations[currentLang].devOrderDate}</strong> ${orderDate}</p>
                        <p><strong>${translations[currentLang].orderServiceLabel}</strong> ${order.service}</p>
                        <p class="text-gray-600 dark:text-gray-400"><strong>${translations[currentLang].orderMessageLabel}</strong> ${order.details}</p>
                        <div class="flex items-center gap-2">
                            <strong>${translations[currentLang].devOrderStatus}</strong>
                            <select id="status-select-${order.id}" class="rounded-md shadow-sm p-1 flex-grow">
                                <option value="0" ${order.status === 0 ? 'selected' : ''}>${translations[currentLang].status0}</option>
                                <option value="1" ${order.status === 1 ? 'selected' : ''}>${translations[currentLang].status1}</option>
                                <option value="2" ${order.status === 2 ? 'selected' : ''}>${translations[currentLang].status2}</option>
                                <option value="3" ${order.status === 3 ? 'selected' : ''}>${translations[currentLang].status3}</option>
                                <option value="4" ${order.status === 4 ? 'selected' : ''}>${translations[currentLang].status4}</option>
                                <option value="5" ${order.status === 5 ? 'selected' : ''}>${translations[currentLang].status5}</option>
                            </select>
                        </div>
                        <!-- Assigned Developer Section -->
                        <div class="border-t pt-4 mt-4 space-y-2">
                            <label for="assigned-dev-${order.id}" class="block text-sm font-medium">${translations[currentLang].devAssignedTo}</label>
                            <div class="flex gap-2">
                                <input type="text" id="assigned-dev-${order.id}" value="${order.assignedDeveloper || ''}" placeholder="اسم المصمم..." class="w-full p-2 rounded-md">
                                <button id="save-dev-${order.id}" class="btn-primary text-sm py-2 px-4">${translations[currentLang].devSave}</button>
                            </div>
                        </div>
                        <div class="border-t pt-4 mt-4 space-y-3">
                            <div class="flex gap-2">
                                <input type="number" id="est-price-${order.id}" value="${order.estimatedPrice || ''}" placeholder="${translations[currentLang].devEstimatedPrice}" class="w-1/2 p-2 rounded-md">
                                <input type="number" id="final-price-${order.id}" value="${order.finalPrice || ''}" placeholder="${translations[currentLang].devFinalPrice}" class="w-1/2 p-2 rounded-md">
                            </div>
                            <div class="flex gap-2">
                                <select id="currency-${order.id}" class="w-2/3 rounded-md shadow-sm p-2">
                                    <option value="" ${!order.currency ? 'selected' : ''}>${translations[currentLang].devCurrency}</option>
                                    <option value="MYR" ${order.currency === 'MYR' ? 'selected' : ''}>رينغت ماليزي (MYR)</option>
                                    <option value="EGP" ${order.currency === 'EGP' ? 'selected' : ''}>جنيه مصري (EGP)</option>
                                    <option value="SAR" ${order.currency === 'SAR' ? 'selected' : ''}>ريال سعودي (SAR)</option>
                                </select>
                                <input type="number" id="discount-${order.id}" value="${order.discount || ''}" placeholder="${translations[currentLang].devDiscountLabel}" class="w-1/3 p-2 rounded-md">
                            </div>
                            ${paymentInfoHTML}
                        </div>
                        <div>
                            <strong>${translations[currentLang].devImagesLabel}</strong>
                            <div id="dev-preview-${order.id}" class="grid grid-cols-3 gap-2 mt-2">
                                ${previewImagesHTML}
                            </div>
                            <div class="mt-4">
                                <label class="custom-file-input text-sm"><span data-lang-key="devUploadImages">${translations[currentLang].devUploadImages}</span><input type="file" id="dev-image-upload-${order.id}" accept="image/*"></label>
                                <div id="dev-upload-indicator-${order.id}" class="mt-2 text-sm text-gray-500 hidden">...Uploading</div>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2 mt-4 border-t pt-4">
                            <button id="save-prices-${order.id}" class="btn-primary w-full text-sm py-2">${translations[currentLang].devSavePrices}</button>
                            <button id="delete-order-${order.id}" class="btn-danger w-full text-sm py-2">${translations[currentLang].devDeleteOrder}</button>
                        </div>
                    `;
                    devOrdersList.appendChild(orderElement);

                    const orderRef = doc(db, `artifacts/${appId}/public/data/orders`, order.id);

                    // Event listener for saving assigned developer
                    document.getElementById(`save-dev-${order.id}`).addEventListener('click', async () => {
                        const devName = document.getElementById(`assigned-dev-${order.id}`).value;
                        try {
                            await updateDoc(orderRef, { assignedDeveloper: devName });
                            showAlert("devAssignedToUpdated");
                        } catch (err) { console.error("Failed to update assigned developer:", err); }
                    });

                    orderElement.querySelectorAll('.delete-preview-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const { orderId, imageUrl } = e.currentTarget.dataset;
                            deletePreviewImage(orderId, imageUrl);
                        });
                    });

                    document.getElementById(`status-select-${order.id}`).addEventListener('change', async (e) => {
                        const newStatus = parseInt(e.target.value, 10);
                        if (newStatus === 0) {
                            showAlert("devRejectionReasonPrompt", 'confirm', {
                                promptInput: { type: 'text', placeholder: 'Reason (optional)' },
                                onConfirm: async (confirmed, reason) => {
                                    if (confirmed) {
                                        try {
                                            await updateDoc(orderRef, { status: 0, rejectionReason: reason || null });
                                            showAlert("orderRejectedSuccess");
                                        } catch (err) { console.error("Failed to reject order:", err); showAlert("orderRejectedError"); }
                                    } else {
                                        e.target.value = order.status;
                                    }
                                }
                            });
                        } else {
                            try {
                                await updateDoc(orderRef, { status: newStatus });
                            } catch (err) { console.error("Failed to update order status:", err); }
                        }
                    });

                    if (order.status === 5) {
                        document.getElementById(`paid-via-${order.id}`).addEventListener('change', async (e) => {
                            try {
                                await updateDoc(orderRef, { paidViaBank: e.target.value });
                            } catch (err) { console.error("Failed to update paid via bank:", err); }
                        });
                    }

                    document.getElementById(`save-prices-${order.id}`).addEventListener('click', async () => {
                        const estPrice = document.getElementById(`est-price-${order.id}`).value;
                        const finalPrice = document.getElementById(`final-price-${order.id}`).value;
                        const currency = document.getElementById(`currency-${order.id}`).value;
                        const discount = document.getElementById(`discount-${order.id}`).value;
                        try {
                            await updateDoc(orderRef, {
                                estimatedPrice: estPrice ? Number(estPrice) : null,
                                finalPrice: finalPrice ? Number(finalPrice) : null,
                                currency: currency || null,
                                discount: discount ? Number(discount) : null
                            });
                            showAlert("pricesUpdatedSuccess");
                        } catch (err) { console.error("Failed to update prices:", err); showAlert("pricesUpdatedError"); }
                    });
                    
                    document.getElementById(`delete-order-${order.id}`).addEventListener('click', () => deleteOrder(order.id));

                    document.getElementById(`dev-image-upload-${order.id}`).addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        document.getElementById(`dev-upload-indicator-${order.id}`).classList.remove('hidden');
                        const formData = new FormData();
                        formData.append("image", file);
                        try {
                            const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
                            const result = await res.json();
                            if (result.success) {
                                await updateDoc(orderRef, { previewImages: arrayUnion(result.data.url) });
                            } else { throw new Error(result.error.message); }
                        } catch (err) {
                            console.error("Developer image upload failed:", err);
                            showAlert("imageUploadError");
                        } finally {
                            document.getElementById(`dev-upload-indicator-${order.id}`).classList.add('hidden');
                        }
                    });
                });
            }, (error) => {
                console.error("Error listening to dev orders:", error);
                devLoadingText.textContent = "Failed to load orders.";
                devLoadingText.classList.remove('hidden');
            });
        }
        
        async function deleteOrder(orderId) {
            if (!isDeveloperMode) return;
            const orderDocRef = doc(db, `artifacts/${appId}/public/data/orders`, orderId);
            showAlert("alertDeleteOrderConfirm", 'confirm', {
                onConfirm: async (confirmed) => {
                    if (confirmed) {
                        try {
                            await deleteDoc(orderDocRef);
                            showAlert("alertDeleteOrderSuccess");
                        } catch (e) {
                            console.error("Error deleting order: ", e);
                            showAlert("alertDeleteOrderError");
                        }
                    }
                }
            });
        }
        
        // NEW: Payment Method Functions
        function copyToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                copyNotification.textContent = translations[currentLang].ibanCopied;
                copyNotification.classList.add('show');
                setTimeout(() => copyNotification.classList.remove('show'), 2000);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            document.body.removeChild(textArea);
        }

        function loadPaymentMethods() {
            if (!db || !isDeveloperMode) return;
            const q = query(collection(db, `artifacts/${appId}/public/data/paymentMethods`));
            onSnapshot(q, (snapshot) => {
                const methods = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                devPaymentMethodsList.innerHTML = '';
                if (methods.length === 0) {
                    devPaymentMethodsList.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400">لم تتم إضافة أي بنوك بعد.</p>`;
                    return;
                }
                methods.forEach(method => {
                    const methodEl = document.createElement('div');
                    methodEl.className = 'flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 rounded-lg';
                    methodEl.innerHTML = `
                        <div class="flex-grow">
                            <p class="font-semibold text-lg">${method.bankName}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${translations[currentLang].devAccountHolderName} ${method.accountHolderName}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 select-all mt-1">${method.iban}</p>
                            ${method.phone ? `<p class="text-sm text-gray-500 dark:text-gray-300 mt-1">${method.phone}</p>` : ''}
                        </div>
                        <button class="btn-danger text-xs mt-2 sm:mt-0" data-id="${method.id}">${translations[currentLang].devDeleteBank}</button>
                    `;
                    methodEl.querySelector('button').onclick = () => deletePaymentMethod(method.id);
                    devPaymentMethodsList.appendChild(methodEl);
                });
            });
        }

        async function addPaymentMethod(e) {
            e.preventDefault();
            if (!isDeveloperMode) return;
            const bankName = bankNameInput.value.trim();
            const accountHolderName = accountHolderNameInput.value.trim();
            const iban = ibanInput.value.trim();
            const phone = phoneInput.value.trim();

            if (!bankName || !iban || !accountHolderName) {
                showAlert("الرجاء ملء اسم البنك واسم المستلم والآيبان.");
                return;
            }
            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/paymentMethods`), { bankName, accountHolderName, iban, phone });
                showAlert(translations[currentLang].bankAddedSuccess);
                paymentMethodForm.reset();
            } catch (err) {
                console.error("Error adding payment method:", err);
                showAlert(translations[currentLang].bankAddError);
            }
        }

        function deletePaymentMethod(id) {
            showAlert(translations[currentLang].deleteBankConfirm, 'confirm', {
                onConfirm: async (confirmed) => {
                    if (confirmed) {
                        try {
                            await deleteDoc(doc(db, `artifacts/${appId}/public/data/paymentMethods`, id));
                            showAlert(translations[currentLang].bankDeleteSuccess);
                        } catch (err) {
                            console.error("Error deleting payment method:", err);
                            showAlert(translations[currentLang].bankDeleteError);
                        }
                    }
                }
            });
        }

        // Coupon Management Functions
        function loadCoupons() {
            if (!db || !isDeveloperMode) return;
            const q = query(collection(db, `artifacts/${appId}/public/data/coupons`));
            onSnapshot(q, (snapshot) => {
                const coupons = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                devCouponsList.innerHTML = '';
                if (coupons.length === 0) {
                    devCouponsList.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400">لم تتم إضافة أي كوبونات بعد.</p>`;
                    return;
                }
                coupons.forEach(coupon => {
                    const couponEl = document.createElement('div');
                    couponEl.className = 'flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 rounded-lg border';
                    couponEl.innerHTML = `
                        <div class="flex-grow">
                            <p class="font-semibold text-lg">${coupon.code}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${translations[currentLang].devCouponDiscount} ${coupon.discount}%</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${translations[currentLang].devCouponUsageLimit} ${coupon.maxUses === -1 ? '∞' : coupon.maxUses}</p>
                            <p class="text-sm text-gray-500 dark:text-gray-300 mt-1">${translations[currentLang].devCouponUsed} ${coupon.uses || 0}</p>
                        </div>
                        <button class="btn-danger text-xs mt-2 sm:mt-0" data-id="${coupon.id}">${translations[currentLang].devCouponDelete}</button>
                    `;
                    couponEl.querySelector('button').onclick = () => deleteCoupon(coupon.id);
                    devCouponsList.appendChild(couponEl);
                });
            });
        }

        async function addCoupon(e) {
            e.preventDefault();
            if (!isDeveloperMode) return;
            const code = couponCodeInputDev.value.trim();
            const discount = parseInt(couponDiscountInput.value);
            const usageLimit = parseInt(couponUsageLimitInput.value);

            if (!code || !discount || discount <= 0 || discount > 100) {
                showAlert(translations[currentLang].devCouponValidationError || "Please fill all fields with valid values.");
                return;
            }

            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/coupons`), {
                    code: code,
                    discount: discount,
                    maxUses: usageLimit === 0 ? -1 : usageLimit, // -1 means unlimited
                    uses: 0,
                    createdAt: new Date()
                });
                showAlert(translations[currentLang].devCouponAddedSuccess);
                couponForm.reset();
            } catch (err) {
                console.error("Error adding coupon:", err);
                showAlert(translations[currentLang].devCouponAddError);
            }
        }

        function deleteCoupon(id) {
            showAlert(translations[currentLang].devCouponDeleteConfirm, 'confirm', {
                onConfirm: async (confirmed) => {
                    if (confirmed) {
                        try {
                            await deleteDoc(doc(db, `artifacts/${appId}/public/data/coupons`, id));
                            showAlert(translations[currentLang].devCouponDeletedSuccess);
                        } catch (err) {
                            console.error("Error deleting coupon:", err);
                            showAlert(translations[currentLang].devCouponDeleteError);
                        }
                    }
                }
            });
        }

        // Initial setup
        window.onload = async function() {
            await initFirebase();
            userLocation = await getGeolocation();
            setupStarRating(starRatingInputContainer, commentRatingValue);
            applyDarkMode(localStorage.getItem('darkMode') === 'enabled');
            // Apply the saved language or detected browser language
            setLanguage(currentLang);
            paymentMethodForm.addEventListener('submit', addPaymentMethod);
            couponForm.addEventListener('submit', addCoupon);
            
            // Load coupons if in developer mode
            if (isDeveloperMode) {
                loadCoupons();
            }
            
            // إضافة معالج الحدث لزر تحديث قواعد الأمان
            const updateSecurityRulesBtn = document.getElementById('updateSecurityRulesBtn');
            if (updateSecurityRulesBtn) {
                updateSecurityRulesBtn.addEventListener('click', async function() {
                    // التحقق من أن المستخدم مطور مصرح له
                    const isAuthorized = await checkAuthorizedDeveloper();
                    if (isAuthorized) {
                        await updateSecurityRules();
                    } else {
                        showAlert("alertWrongDevCode");
                    }
                });
            }
        }
    </script>
    
    </div> <!-- End Main Content -->
    
    <!-- Loading Screen JavaScript -->
    <script>
        // Loading screen functionality with language support
        (function() {
            // Get the current language
            function detectBrowserLanguage() {
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.startsWith('ar')) {
                    return 'ar';
                } else if (browserLang.startsWith('zh')) {
                    return 'zh';
                } else {
                    return 'en';
                }
            }
            
            const currentLang = localStorage.getItem('lang') || detectBrowserLanguage();
            
            // Loading text translations
            const loadingTexts = {
                ar: 'بوابة الخدمات - تصميم وتطوير المشاريع',
                en: 'Gate Of Services - Design & Development',
                zh: '服务门户 - 设计与开发'
            };
            
            // Function to update loading text
            function updateLoadingText() {
                const loadingTextElement = document.getElementById('loadingTextElement');
                if (loadingTextElement && loadingTexts[currentLang]) {
                    loadingTextElement.textContent = loadingTexts[currentLang];
                }
            }
            
            // Apply immediately if DOM is ready, otherwise wait for it
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', updateLoadingText);
            } else {
                updateLoadingText();
            }
        })();
        
        document.addEventListener('DOMContentLoaded', function() {
            // Additional DOM ready functionality can go here
        });
        
        // Loading screen functionality
        window.addEventListener('load', function() {
            const loadingScreen = document.getElementById('loadingScreen');
            const mainContent = document.getElementById('mainContent');
            
            // Minimum loading time of 3 seconds for better UX
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                
                // Show main content after loading screen starts fading
                setTimeout(() => {
                    mainContent.classList.add('show');
                }, 500);
                
                // Remove loading screen from DOM after transition
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 1000);
            }, 3000);
        });
        
        // Loading text translations removed - using static text in HTML
    </script>
    
    <!-- Copy Notification -->
    <div id="copyNotification" class="copy-notification"></div>
    
</body>
</html>
