<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="siteTitle">خدمتنا - تصميم وتطوير المشاريع</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Light Mode Styles (Default) */
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; scroll-behavior: smooth; transition: background-color 0.3s ease, color 0.3s ease; }
        .hero-section { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; padding: 4rem 1rem; border-bottom-left-radius: 50px; border-bottom-right-radius: 50px; }
        .section-heading { position: relative; display: inline-block; margin-bottom: 2rem; font-size: 2.25rem; font-weight: 700; color: #1e293b; }
        .section-heading::after { content: ''; position: absolute; bottom: -8px; right: 0; width: 70%; height: 4px; background-color: #6366f1; border-radius: 2px; }
        .card { background-color: white; border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); padding: 2rem; transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .btn-primary { background-color: #6366f1; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; }
        .btn-primary:hover { background-color: #4f46e5; transform: translateY(-2px); }
        .contact-link { display: inline-flex; align-items: center; background-color: #10b981; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; transition: background-color 0.3s ease, transform 0.2s ease; }
        .contact-link:hover { background-color: #059669; transform: translateY(-2px); }
        .whatsapp-icon { width: 24px; height: 24px; margin-left: 0.5rem; }
        .telegram-icon { width: 24px; height: 24px; margin-left: 0.5rem; fill: white; }
        .navbar { background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); border-bottom-left-radius: 1rem; border-bottom-right-radius: 1rem; transition: background-color 0.3s ease, box-shadow 0.3s ease; }
        .nav-link { color: #334155; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.3s ease, color 0.3s ease; }
        .nav-link:hover { background-color: #e2e8f0; color: #1e293b; }
        .hamburger-icon { display: none; cursor: pointer; flex-direction: column; justify-content: space-between; width: 30px; height: 20px; }
        .hamburger-icon span { display: block; width: 100%; height: 3px; background-color: #334155; border-radius: 2px; transition: all 0.3s ease; }
        .hamburger-icon.open span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        .hamburger-icon.open span:nth-child(2) { opacity: 0; }
        .hamburger-icon.open span:nth-child(3) { transform: translateY(-9px) rotate(-45deg); }
        
        /* Dark Mode Styles */
        body.dark { background-color: #1a202c; color: #e2e8f0; }
        body.dark .navbar { background-color: rgba(26, 32, 44, 0.95); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); }
        body.dark .nav-link { color: #cbd5e0; }
        body.dark .nav-link:hover { background-color: #2d3748; color: #f7fafc; }
        body.dark .section-heading { color: #f7fafc; }
        body.dark .section-heading::after { background-color: #8b5cf6; }
        body.dark .card { background-color: #2d3748; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1); color: #cbd5e0; }
        body.dark .card h3 { color: #a78bfa; }
        body.dark .card p { color: #cbd5e0; }
        body.dark .hamburger-icon span { background-color: #e2e8f0; }
        body.dark .nav-links-container { background-color: rgba(26, 32, 44, 0.98); }
        body.dark .hero-section .bg-yellow-400 { background-color: #f6ad55; color: #1a202c; }
        body.dark #about-us { background-color: #2d3748; }
        body.dark #contact { background-color: #1a202c; }
        body.dark #comments { background-color: #1a202c; }
        body.dark #darkModeToggle { background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: background-color 0.3s ease; }
        body.dark #darkModeToggle:hover { background-color: rgba(255, 255, 255, 0.1); }
        .dark-mode-icon { width: 24px; height: 24px; color: #334155; }
        body.dark .dark-mode-icon { color: #f7fafc; }

        /* Language Dropdown Styles */
        .language-dropdown-container { position: relative; display: inline-block; }
        .language-dropdown-button { background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: background-color 0.3s ease; display: flex; align-items: center; justify-content: center; font-weight: 500; color: #334155; }
        .language-dropdown-button:hover { background-color: rgba(0, 0, 0, 0.05); }
        body.dark .language-dropdown-button { color: #e2e8f0; }
        body.dark .language-dropdown-button:hover { background-color: rgba(255, 255, 255, 0.1); }
        .language-icon { width: 24px; height: 24px; margin-right: 0.25rem; }
        .language-dropdown-menu { position: absolute; top: 100%; right: 0; background-color: white; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); min-width: 120px; z-index: 1001; overflow: hidden; display: none; }
        body.dark .language-dropdown-menu { background-color: #2d3748; box-shadow: 0 44px 6px rgba(0, 0, 0, 0.3); }
        .language-dropdown-menu.active { display: block; }
        .language-dropdown-menu li { padding: 0.75rem 1rem; cursor: pointer; color: #334155; transition: background-color 0.2s ease; }
        .language-dropdown-menu li:hover { background-color: #e2e8f0; }
        body.dark .language-dropdown-menu li { color: #e2e8f0; }
        body.dark .language-dropdown-menu li:hover { background-color: #4a5568; }

        /* Comment & UI Styles */
        #customAlertModal { transition: opacity 0.3s ease; }
        #customAlertModal.hidden { opacity: 0; pointer-events: none; }
        #customAlertModal .modal-buttons { display: flex; flex-direction: column; justify-content: center; gap: 1rem; margin-top: 1rem; }
        #customAlertModal .modal-buttons button { padding: 0.5rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; }
        #customAlertModal .modal-buttons .confirm-btn { background-color: #ef4444; color: white; }
        #customAlertModal .modal-buttons .confirm-btn:hover { background-color: #dc2626; }
        #customAlertModal .modal-buttons .cancel-btn { background-color: #cbd5e0; color: #334155; }
        body.dark #customAlertModal .modal-buttons .cancel-btn { background-color: #4a5568; color: #e2e8f0; }
        body.dark #customAlertModal .modal-buttons .cancel-btn:hover { background-color: #64748b; }
        #commentsList > div { background-color: #00000009; transition: background-color 0.3s ease, color 0.3s ease; }
        #commentsList > div p { color: rgb(65, 77, 102); }
        body.dark #commentsList > div { background-color: #43526b42; }
        body.dark #commentsList > div p { color: #e2e8f0; }
        .custom-file-input { position: relative; overflow: hidden; display: inline-block; cursor: pointer; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; background-color: #f8fafc; color: #334155; border: 1px solid #e2e8f0; text-align: center; }
        .custom-file-input:hover { background-color: #e2e8f0; border-color: #cbd5e0; }
        body.dark .custom-file-input { background-color: #334155; color: #e2e8f0; border-color: #475569; }
        body.dark .custom-file-input:hover { background-color: #4a5568; border-color: #64748b; }
        #imagePreview { max-width: 100px; max-height: 100px; margin-top: 1rem; border-radius: 0.5rem; object-fit: cover; }
        #comments input[type="text"], #comments textarea, #developerPasswordInput, #orderForm input[type="text"], #orderForm input[type="email"], #orderForm input[type="tel"], #orderForm select, #orderForm textarea, #orderTrackInput { background-color: #f6f7ff; color: #1a202c; border-color: #e2e8f0; }
        #comments input[type="text"]::placeholder, #comments textarea::placeholder, #developerPasswordInput::placeholder, #orderForm input::placeholder, #orderForm textarea::placeholder, #orderTrackInput::placeholder { color: #64748b; }
        body.dark #comments input[type="text"], body.dark #comments textarea, body.dark #developerPasswordInput, body.dark #orderForm input, body.dark #orderForm select, body.dark #orderForm textarea, body.dark #orderTrackInput { background-color: #334155; color: #e2e8f0; border-color: #475569; }
        body.dark #comments input[type="text"]::placeholder, body.dark #comments textarea::placeholder, body.dark #developerPasswordInput::placeholder, body.dark #orderForm input::placeholder, body.dark #orderForm textarea::placeholder, body.dark #orderTrackInput::placeholder { color: #94a3b8; }
        
        @media (max-width: 767px) {
            .hamburger-icon { display: flex; }
            .nav-links-container { display: none; flex-direction: column; width: 100%; background-color: rgba(255, 255, 255, 0.98); padding-bottom: 1rem; border-radius: 1rem; }
            body.dark .nav-links-container { background-color: rgba(26, 32, 44, 0.98); }
            .nav-links-container.open { display: flex; }
            .nav-link { padding: 0.75rem 1rem; text-align: center; }
        }
        
        #developerModeIndicator { position: fixed; bottom: 4rem; right: 4rem; background-color: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; z-index: 50; display: none; }
        body.dark #developerModeIndicator { background-color: #dc2626; }
        #fullImageModal, #orderModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        #fullImageModal.active, #orderModal.active { opacity: 1; pointer-events: auto; }
        #fullImageModal img { max-width: 90%; max-height: 90%; border-radius: 0.5rem; }
        .comment-image { width: 100px; height: 100px; object-fit: cover; border-radius: 0.5rem; cursor: pointer; transition: transform 0.2s ease; }
        .comment-image:hover { transform: scale(1.05); }

        /* Star Rating Styles */
        .star-rating { display: flex; direction: ltr; align-items: center; gap: 0.125rem; }
        .star-rating svg { width: 1.25rem; height: 1.25rem; color: #cbd5e0; }
        .star-rating.interactive svg { cursor: pointer; }
        .star-rating svg.filled { color: #f59e0b; }
        body.dark .star-rating svg { color: #4a5568; }
        body.dark .star-rating svg.filled { color: #f59e0b; }
        #commentForm .star-rating svg { width: 1.5rem; height: 1.5rem; transition: color 0.2s ease, transform 0.2s ease; }
        #commentForm .star-rating.interactive svg:hover { color: #f59e0b; transform: scale(1.1); }
        
        /* Comment Actions (Like/Dislike) Styles */
        .comment-actions { display: flex; align-items: center; gap: 1rem; margin-top: 0.75rem; }
        .action-btn { background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.35rem; font-size: 0.875rem; color: #64748b; transition: color 0.2s ease; padding: 0.25rem; border-radius: 9999px; }
        .action-btn:hover { color: #1e293b; }
        .action-btn.liked { color: #4f46e5; }
        .action-btn.disliked { color: #ef4444; }
        .action-btn svg { width: 1.2rem; height: 1.2rem; }
        body.dark .action-btn { color: #94a3b8; }
        body.dark .action-btn:hover { color: #e2e8f0; }
        body.dark .action-btn.liked { color: #818cf8; }
        body.dark .action-btn.disliked { color: #f87171; }
        .dev-action-btn { color: #ef4444; }
        body.dark .dev-action-btn { color: #f87171; }
        .dev-action-btn:hover { opacity: 0.7; }
        
        /* Styling for the green 'Order Now' button */
        .btn-order-now {
            background-color: #10B981; /* green-500 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .btn-order-now:hover, .btn-order-now:active {
            background-color: #047857; /* A darker green for hover/active state */
            transform: translateY(-2px);
        }

        /* Styling for the navbar 'Order Now' button */
        .nav-link.order-now-btn {
            background-color: #10B981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .nav-link.order-now-btn:hover, .nav-link.order-now-btn:active {
            background-color: #059669;
            color: white;
            transform: translateY(-2px);
        }

        /* Styling for the popup order form container */
        .order-form-container {
            background-color: white;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Dark mode styling for the popup order form container */
        body.dark .order-form-container {
            background-color: #2d3748; /* Dark gray background */
            color: #e2e8f0; /* Light text for dark mode */
        }

        /* Specific styling for the form submit button in the modal */
        #submitOrderBtn {
            background-color: #10B981; /* green-500 */
        }
        #submitOrderBtn:hover, #submitOrderBtn:active {
            background-color: #047857; /* darker green for hover and active states */
        }

        .custom-file-input {
            position: relative;
            overflow: hidden;
            display: inline-block;
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            background-color: #f8fafc;
            color: #334155;
            border: 1px solid #e2e8f0;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            text-align: center;
        }
        .custom-file-input:hover {
            background-color: #e2e8f0;
            border-color: #cbd5e0;
        }
        .custom-file-input input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        body.dark .custom-file-input {
            background-color: #334155;
            color: #e2e8f0;
            border-color: #475569;
        }
        body.dark .custom-file-input:hover {
            background-color: #4a5568;
            border-color: #64748b;
        }
        
        .device-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #64748b;
            font-size: 0.875rem;
        }

        body.dark .device-info {
            color: #94a3b8;
        }
        
        .file-list-container {
            margin-top: 0.5rem;
        }
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #e2e8f0;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            word-break: break-all;
        }
        body.dark .file-item {
            background-color: #4a5568;
        }
        .file-item .file-name {
            font-size: 0.875rem;
            color: #334155;
        }
        body.dark .file-item .file-name {
            color: #f7fafc;
        }
        .file-item .remove-btn {
            color: #ef4444;
            margin-right: 0.5rem;
            cursor: pointer;
        }
        .file-item .remove-btn:hover {
            color: #b91c1c;
        }

        .map-link {
            text-decoration: underline;
            color: #6366f1;
            transition: color 0.2s ease;
        }
        .map-link:hover {
            color: #4f46e5;
        }

        .ip-address {
            color: #4f46e5; /* Tailwind's indigo-600 */
            font-weight: normal;
        }
        body.dark .ip-address {
            color: #a78bfa; /* Tailwind's violet-400 */
        }

        /* Order Tracking and Developer Mode Styles */
        .progress-container {
            position: relative;
            margin-top: 2rem;
            padding: 0 10px;
        }
        .progress-steps-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
            z-index: 2;
        }
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
        }
        .progress-label {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            word-break: break-all;
            line-height: 1.2;
            color: #64748b;
        }
        .progress-label.active {
            color: #10b981;
        }
        body.dark .progress-label {
            color: #a0aec0;
        }
        body.dark .progress-label.active {
            color: #10b981;
        }
        #track-order-section {
            /* إضافة لون خلفية صريح للوضع الفاتح */
            background-color: #f8fafc;
        }
        body.dark #track-order-section {
            background-color: #1a202c;
        }
        .order-preview-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .order-preview-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .order-preview-image:hover {
            transform: scale(1.05);
        }
        
        /* Updated styles for Developer Dashboard to be horizontally scrollable */
        .dev-order-list {
            display: flex;
            overflow-x: auto;
            gap: 1.5rem;
            padding: 1rem;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .dev-order-list .card {
            min-width: 320px; /* Adjust as needed */
            flex-shrink: 0;
            scroll-snap-align: start;
            padding: 1.5rem;
        }
    </style>
</head>
<body class="font-sans antialiased">

    <!-- Custom Alert Modal (No changes) -->
    <div id="customAlertModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[2000] hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="customAlertMessage" class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4"></p>
            <div id="customAlertButtons" class="modal-buttons"></div>
        </div>
    </div>

    <!-- Full Image Modal (No changes) -->
    <div id="fullImageModal">
        <img id="fullImage" src="#" alt="Full size comment image">
    </div>

    <!-- Order Now Modal (No changes) -->
    <div id="orderModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[3000] hidden">
        <div class="order-form-container p-8 rounded-xl shadow-2xl max-w-lg w-full m-4 relative">
            <button id="closeOrderModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-2xl font-bold text-center mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="orderFormTitle">نموذج طلب خدمة</h2>
            <!-- Updated action and method for formspree -->
            <form id="orderForm" action="https://formspree.io/f/xrbllnal" method="POST" class="space-y-4">
                <div>
                    <label for="orderName" class="block text-sm font-medium" data-lang-key="orderNameLabel">الاسم الكامل:</label>
                    <input type="text" id="orderName" name="name" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderNamePlaceholder" placeholder="الاسم الكامل" required>
                </div>
                <div>
                    <label for="orderEmail" class="block text-sm font-medium" data-lang-key="orderEmailLabel">البريد الإلكتروني:</label>
                    <input type="email" id="orderEmail" name="email" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderEmailPlaceholder" placeholder="yourname@example.com" required>
                </div>
                <div>
                    <label for="orderPhone" class="block text-sm font-medium" data-lang-key="orderPhoneLabel">رقم الهاتف:</label>
                    <input type="tel" id="orderPhone" name="phone" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderPhonePlaceholder" placeholder="+966 50 123 4567" required>
                </div>
                <div>
                    <label for="orderService" class="block text-sm font-medium" data-lang-key="orderServiceLabel">نوع الخدمة المطلوبة:</label>
                    <select id="orderService" name="service" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600">
                        <option value="" data-lang-key="orderServiceSelect" disabled selected>اختر خدمة...</option>
                        <option value="تصميم ثلاثي الأبعاد" data-lang-key="service1Title">تصميم ثلاثي الأبعاد</option>
                        <option value="عروض تقديمية (بوربوينت)" data-lang-key="service2Title">عروض تقديمية (بوربوينت)</option>
                        <option value="تنسيق ملفات إكسل" data-lang-key="service3Title">تنسيق ملفات إكسل</option>
                        <option value="تصاميم هندسية ومخططات" data-lang-key="service4Title">تصاميم هندسية ومخططات</option>
                        <option value="كتابة وتنسيق تقارير" data-lang-key="service5Title">كتابة وتنسيق تقارير</option>
                        <option value="تصميم وتعديل فيديوهات وصور" data-lang-key="service6Title">تصميم وتعديل فيديوهات وصور</option>
                        <option value="برمجة وتطوير مواقع الويب" data-lang-key="service7Title">برمجة وتطوير مواقع الويب</option>
                        <option value="أخرى" data-lang-key="orderServiceOther">أخرى...</option>
                    </select>
                </div>
                <div id="otherServiceField" class="hidden">
                    <label for="otherServiceText" class="block text-sm font-medium" data-lang-key="orderServiceOtherLabel">الرجاء تحديد الخدمة المطلوبة:</label>
                    <input type="text" id="otherServiceText" name="other_service" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderServiceOtherPlaceholder" placeholder="اكتب الخدمة المخصصة هنا...">
                </div>
                <div>
                    <label for="orderMessage" class="block text-sm font-medium" data-lang-key="orderMessageLabel">تفاصيل المشروع:</label>
                    <textarea id="orderMessage" name="details" rows="5" class="mt-1 block w-full rounded-md shadow-sm border-gray-300 dark:border-gray-600" data-lang-key="orderMessagePlaceholder" placeholder="اشرح متطلبات مشروعك بالتفصيل..." required></textarea>
                </div>
                <div>
                    <label for="orderFiles" class="block text-sm font-medium" data-lang-key="orderFilesLabel">إضافة صور (اختياري):</label>
                    <div class="relative mt-1">
                        <!-- Updated to accept only image files -->
                        <input type="file" id="orderFiles" name="files" multiple accept="image/jpeg,image/png,image/gif,image/jpg" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                        <div class="custom-file-input"><span id="orderFileInputText" data-lang-key="fileInputChoose">اختيار صور</span></div>
                    </div>
                    <div id="orderImagesPreview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mt-4"></div>
                </div>
                <!-- Geolocation field for the order form -->
                <div id="orderGeolocationField" class="hidden">
                    <input type="hidden" id="orderGeolocation" name="geolocation_link">
                </div>
                <!-- New hidden field for IP Address -->
                <input type="hidden" name="ip_address" id="orderIpAddressInput">
                <!-- Add a hidden input to hold the full formatted message for Formspree -->
                <input type="hidden" name="formspree_message" id="formspreeMessage">
                <button type="submit" id="submitOrderBtn" class="btn-primary w-full" data-lang-key="orderSubmitBtn">تقديم الطلب</button>
            </form>
        </div>
    </div>

    <!-- Order Submitted Modal -->
    <div id="orderSubmittedModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[3000] hidden">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl max-w-md w-full m-4 text-center">
            <svg class="mx-auto h-16 w-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <h3 class="mt-4 text-2xl font-bold text-gray-900 dark:text-white" data-lang-key="orderSuccess">تم استلام طلبك بنجاح!</h3>
            <p class="mt-2 text-gray-600 dark:text-gray-400" data-lang-key="orderIdMessage">الرجاء الاحتفاظ برقم طلبك لتتبع حالته:</p>
            <p id="submittedOrderId" class="mt-4 text-4xl font-extrabold text-indigo-600 dark:text-indigo-400 select-all"></p>
            <button id="closeOrderSubmittedModal" class="mt-6 px-6 py-2 btn-primary" data-lang-key="customAlertClose">حسناً</button>
        </div>
    </div>


    <!-- Navbar -->
    <nav class="navbar py-4 px-6">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <a href="#hero" class="text-2xl font-bold text-indigo-700" data-lang-key="siteTitle">خدمتنا</a>
            <div class="flex items-center gap-4 sm:gap-6">
                <!-- Navigation Links and icons combined into one flex container -->
                <div class="nav-links-container hidden md:flex items-center gap-4 sm:gap-6" id="navLinks">
                    <a href="#hero" class="nav-link" data-lang-key="navHome">الرئيسية</a>
                    <a href="#features" class="nav-link" data-lang-key="navWhyChooseUs">لماذا تختارنا؟</a>
                    <a href="#about-us" class="nav-link" data-lang-key="navAboutUs">من نحن؟</a>
                    <a href="#services" class="nav-link" data-lang-key="navServices">ماذا نقدم؟</a>
                    <a href="#contact" class="nav-link" data-lang-key="navContact">تواصل معنا</a>
                    <a href="#comments" class="nav-link" data-lang-key="navComments">التعليقات</a>
                    <a href="#track-order-section" class="nav-link" data-lang-key="navTrackOrder">تتبع طلبك</a>
                    <button id="orderNowNavBtn" class="nav-link order-now-btn" data-lang-key="orderNowBtn">اطلب الآن</button>
                    <!-- Language Dropdown -->
                    <div class="language-dropdown-container">
                        <button id="languageDropdownButton" class="language-dropdown-button" aria-label="Toggle language dropdown">
                            <svg class="language-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v3h-1c-.9 0-1.64.58-1.9 1.39-.77-2.31-1.04-4.83-.5-7.44h6.89c.54 2.61.27 5.13-.5 7.44zM12 4.07c3.95.49 7 3.85 7 7.93 0 .62-.08 1.21-.21 1.79L15 9V8c0-1.1-.9-2-2-2H9v-.93c.71-.1 1.45-.17 2.21-.17.76 0 1.5.07 2.21.17z"/></svg>
                            <span id="currentLanguageText">AR</span>
                        </button>
                        <ul id="languageDropdownMenu" class="language-dropdown-menu">
                            <li data-lang="ar">العربية</li>
                            <li data-lang="en">English</li>
                            <li data-lang="zh">中文</li>
                        </ul>
                    </div>
                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" aria-label="Toggle dark mode">
                        <svg class="dark-mode-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path id="darkModeIconPath" d="M12 3a9 9 0 109 9c0-.46-.04-.92-.12-1.36a5.999 5.999 0 01-8.588-8.588C12.92 3.04 12.46 3 12 3z"/></svg>
                    </button>
                </div>
                <!-- Mobile Hamburger Menu -->
                <div class="hamburger-icon md:hidden" id="hamburger"><span></span><span></span><span></span></div>
            </div>
        </div>
    </nav>

    <header id="hero" class="hero-section text-center">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold mb-4 leading-tight" data-lang-key="heroTitle">مصممون جميع أنواع المشاريع والمواقع والتصاميم والبحوث والواجبات</h1>
            <p class="text-2xl sm:text-3xl font-light mb-8"><span class="bg-yellow-400 text-gray-900 px-4 py-2 rounded-lg shadow-lg inline-block transform -rotate-1 skew-x-2" data-lang-key="heroDiscount">خصم 30% لفترة محدودة على كامل الخدمات</span></p>
            <p class="text-lg sm:text-xl font-light mb-8" data-lang-key="heroSubtitle">نقدم لكم حلولاً متكاملة لتلبية جميع احتياجاتكم الأكاديمية والمهنية</p>
            <!-- New prominent "Order Now" button -->
            <button id="heroOrderNowBtn" class="btn-order-now inline-block text-lg" data-lang-key="orderNowBtn">اطلب الآن</button>
        </div>
    </header>

    <main>
        <!-- Features Section (No changes) -->
        <section id="features" class="py-16 px-4">
            <div class="max-w-6xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="featuresHeading">لماذا تختارنا؟</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m1.636 6.364l.707-.707M6 21v-1m6.364-1.636l-.707-.707M12 21h-1m-4.636-1.636l-.707.707M3 12h1m-.707-6.364l.707-.707M12 3v1m-6.364 1.636l-.707.707M21 12h-1m-4.636-1.636l-.707-.707M12 21v-1m6.364-1.636l-.707-.707M12 3v1m-6.364 1.636l-.707.707M21 12h-1m-4.636-1.636l-.707-.707M12 21v-1m6.364-1.636l-.707-.707"/></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature1Title">تنسيقات شكل رائعة </h3><p class="text-gray-600" data-lang-key="feature1Desc">نقدم العديد من التنسيقات الجمالية التي تبرز عملك.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature2Title">تنسيق كلام احترافي</h3><p class="text-gray-600" data-lang-key="feature2Desc">تنسيق دقيق للمحتوى في البحوث والمشاريع.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature3Title">أكثر من 100 نوع خط</h3><p class="text-gray-600" data-lang-key="feature3Desc">اختر من مجموعة واسعة من الخطوط المميزة.</p></div>
                    <div class="card text-center"><div class="text-indigo-600 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m-4 8h4m10-8h4m-4 8h4M7 12h10l4-8H3l4 8zm0 0v8a2 2 0 002 2h6a2 2 0 002-2v-8m-12 4h.01M17 12h.01"></path></svg></div><h3 class="text-xl font-semibold mb-2" data-lang-key="feature4Title">عروض تقديمية مميزة</h3><p class="text-gray-600" data-lang-key="feature4Desc">تصميم عروض بوربوينت جذابة ومبتكرة.</p></div>
                </div>
            </div>
        </section>

        <!-- About Us Section (No changes) -->
        <section id="about-us" class="py-16 px-4 bg-white">
            <div class="max-w-6xl mx-auto text-center">
                <h2 class="section-heading mb-12" data-lang-key="aboutUsHeading">من نحن؟ </h2>
                <div class="card p-8 md:p-12">
                    <p class="text-lg md:text-xl leading-relaxed text-gray-700" data-lang-key="aboutUsParagraph1">نحن فريق متقدم من خريجي جامعة UCSI الماليزية، نجمع بين المعرفة الأكاديمية العميقة والخبرة العملية الواسعة في تصميم وتنفيذ العديد من المشاريع الكبيرة والصغيرة.</p></div>
        </section>

        <!-- Services Section (No changes) -->
        <section id="services" class="py-16 px-4">
            <div class="max-w-6xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="servicesHeading">ماذا نقدم؟</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service1Title">تصميم ثلاثي الأبعاد</h3><p class="text-gray-600" data-lang-key="service1Desc">تصميم جميع أنواع القطع ثلاثية الأبعاد على برامج الأوتوكاد وبرامج الطباعة ثلاثية الأبعاد بجميع صيغ الملفات القابلة للطباعة.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service2Title">عروض تقديمية (بوربوينت)</h3><p class="text-gray-600" data-lang-key="service2Desc">تصميم عروض تقديمية على البوربوينت مع كامل التنسيق وإضافة الصور والحركات المرئية.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service3Title">تنسيق ملفات إكسل</h3><p class="text-gray-600" data-lang-key="service3Desc">تصميم وتعديل وتنسيق ملفات إكسل باحترافية عالية.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service4Title">تصاميم هندسية ومخططات</h3><p class="text-gray-600" data-lang-key="service4Desc">تصاميم هندسية، مخططات، كهرباء، وغيرها من الأعمال الهندسية المتخصصة.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service5Title">كتابة وتنسيق تقارير</h3><p class="text-gray-600" data-lang-key="service5Desc">كتابة وتنسيق التقارير على برنامج الوورد بجودة ودقة عالية.</p></div>
                    <div class="card"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service6Title">تصميم وتعديل فيديوهات وصور</h3><p class="text-gray-600" data-lang-key="service6Desc">تصميم وتعديل الفيديوهات والصور بجودة عالية لتناسب جميع احتياجاتكم.</p></div>
                    <div class="card lg:col-span-3"><h3 class="text-xl font-semibold mb-3 text-indigo-700" data-lang-key="service7Title">برمجة وتطوير مواقع الويب</h3><p class="text-gray-600" data-lang-key="service7Desc">برمجة مواقع ويب تفاعلية وجمالية باستخدام لغة JavaScript وتنسيق الشكل باستخدام CSS، مع إضافة الموقع على سيرفر وإنشاء رابط خاص به.</p></div>
                </div>
            </div>
        </section>

        <!-- New: Order Tracking Section -->
        <section id="track-order-section" class="py-16 px-4 bg-gray-100 dark:bg-gray-900">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="section-heading mb-12" data-lang-key="trackOrderHeading">تتبع طلبك</h2>
                <div class="card p-8">
                    <p class="text-lg md:text-xl mb-6 text-gray-700 dark:text-gray-300" data-lang-key="trackOrderSubtitle">أدخل رقم طلبك المكون من 6 أرقام لتتبع حالته.</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <input type="text" id="orderTrackInput" placeholder="أدخل رقم الطلب هنا..." class="w-full sm:w-2/3 md:w-1/2 p-3 rounded-lg shadow-sm border-gray-300 dark:border-gray-600 text-center" data-lang-key="trackOrderInputPlaceholder" pattern="\d{6}" title="الرجاء إدخال رقم مكون من 6 أرقام" required>
                        <button id="trackOrderBtn" class="btn-primary w-full sm:w-1/3 md:w-auto" data-lang-key="trackOrderBtn">تتبع</button>
                    </div>
                    <!-- Order Status Display Area -->
                    <div id="orderStatusDisplay" class="mt-8 hidden">
                        <h3 class="text-xl font-semibold mb-4 text-indigo-600 dark:text-indigo-400" data-lang-key="orderStatusTitle">حالة الطلب: <span id="displayedOrderId"></span></h3>
                        <div class="progress-container">
                            <canvas id="progressBarCanvas" width="800" height="80" class="w-full"></canvas>
                            <div class="progress-steps-container">
                                <div class="progress-step" data-step="1">
                                    <span class="progress-label" data-lang-key="status1">بانتظار الموافقة</span>
                                </div>
                                <div class="progress-step" data-step="2">
                                    <span class="progress-label" data-lang-key="status2">قيد التنفيذ</span>
                                </div>
                                <div class="progress-step" data-step="3">
                                    <span class="progress-label" data-lang-key="status3">معاينة المشروع</span>
                                </div>
                                <div class="progress-step" data-step="4">
                                    <span class="progress-label" data-lang-key="status4">بانتظار الدفع</span>
                                </div>
                                <div class="progress-step" data-step="5">
                                    <span class="progress-label" data-lang-key="status5">اكتمل</span>
                                </div>
                            </div>
                        </div>
                        <div id="orderPreviewImages" class="order-preview-images mt-6"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Developer Mode Section -->
        <section id="developer-dashboard" class="py-16 px-4 bg-gray-100 dark:bg-gray-900 hidden">
            <div class="max-w-6xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="devDashboardHeading">لوحة تحكم المطور</h2>
                <!-- Modified layout for horizontal scrolling -->
                <div class="dev-order-list" id="devOrdersList">
                    <p id="devLoadingText" class="text-center text-gray-500 dark:text-gray-400 col-span-full" data-lang-key="devLoading">جاري تحميل الطلبات...</p>
                    <p id="noOrders" class="text-center text-gray-500 dark:text-gray-400 col-span-full hidden" data-lang-key="noOrders">لا توجد طلبات حتى الآن.</p>
                </div>
            </div>
        </section>

        <!-- Contact Section (No changes) -->
        <section id="contact" class="py-16 px-4 bg-gray-100">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="section-heading mb-12" data-lang-key="contactHeading">للتواصل معنا</h2>
                <p class="text-lg md:text-xl mb-8" data-lang-key="contactSubtitle">يسعدنا استقبال استفساراتكم وطلباتكم عبر وسائل التواصل التالية:</p>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-6">
                    <a href="https://wa.me/966500900329" target="_blank" class="contact-link"><svg class="whatsapp-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.58 15.36 3.42 16.92L2.06 22L7.3 20.64C8.86 21.49 10.56 21.94 12.29 21.94H12.04C17.5 21.94 21.95 17.49 21.95 12.04C21.95 6.58 17.5 2 12.04 2ZM17.29 15.5L16.4 17.46C16.14 17.97 15.54 18.15 15.03 17.89C13.97 17.34 12.78 16.71 11.66 15.93C10.27 14.96 9.17 13.82 8.21 12.43C7.43 11.31 6.8 10.12 6.25 9.06C5.99 8.55 6.17 7.95 6.68 7.69L8.64 6.8C9.15 6.54 9.75 6.72 10.01 7.23L10.66 8.59C10.92 9.1 10.74 9.7 10.23 9.96L9.62 10.27C9.28 10.45 9.16 10.86 9.34 11.2C9.89 12.26 10.74 13.11 11.8 13.66C12.14 13.84 12.55 13.72 12.73 13.38L13.04 12.77C13.3 12.26 13.9 12.08 14.41 12.34L15.77 12.99C16.28 13.25 16.46 13.85 16.2 14.36L15.5 15.5ZM12.04 4C16.46 4 20.04 7.58 20.04 12.04C20.04 16.46 16.46 20.04 12.04 20.04C10.61 20.04 9.25 19.68 8.05 18.99L7.66 18.77L4.69 19.53L5.45 16.56L5.23 16.17C4.54 14.97 4.18 13.61 4.18 12.04C4.18 7.58 7.76 4 12.04 4Z"/></svg><span data-lang-key="whatsappNumberKSA">0500900329 داخل المملكة</span></a>
                    <a href="https://wa.me/60163340537" target="_blank" class="contact-link"><svg class="whatsapp-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v3h-1c-.9 0-1.64.58-1.9 1.39-.77-2.31-1.04-4.83-.5-7.44h6.89c.54 2.61.27 5.13-.5 7.44zM12 4.07c3.95.49 7 3.85 7 7.93 0 .62-.08 1.21-.21 1.79L15 9V8c0-1.1-.9-2-2-2H9v-.93c.71-.1 1.45-.17 2.21-.17.76 0 1.5.07 2.21.17z"/></svg><span data-lang-key="whatsappNumberOutsideKSA">+60163340537 خارج المملكة</span></a>
                    <a href="https://t.me/AHMADxx41" target="_blank" class="contact-link bg-blue-500 hover:bg-blue-600"><svg class="telegram-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.35 7.6l-2.45 7.42c-.22.68-.83.92-1.39.63l-2.73-2.1c-.24-.19-.48-.2-.72-.01l-1.35 1.04c-.3.23-.74.07-.82-.3l-.9-4.22c-.09-.43.14-.86.53-1.02l9.08-3.41c.42-.16.85.16.85.6v.01c-.01.35-.13.6-.33.72zm-4.38 5.75l.95-.73c.12-.1.29-.1.41 0l2.36 1.83c.1.08.13.23.07.35l-.83.74c-.08.07-.19.1-.3.07l-2.5-1.92c-.1-.08-.13-.23-.07-.35zm1.53-2.85l-4.52 3.49-1.96-1.51c-.1-.08-.24-.05-.32.06l-.72.93c-.08.1-.06.26.04.34l2.12 1.63c.1.08.24.05.32-.06l5.36-4.13c.1-.08.06-.23-.04-.32l-1.22-1.24c-.11-.11-.27-.11-.38 0z"/></svg><span data-lang-key="telegramContact">التواصل عبر التلجرام</span></a>
                </div>
            </div>
        </section>

        <!-- Comments Section (No changes) -->
        <section id="comments" class="py-16 px-4">
            <div class="max-w-4xl mx-auto">
                <h2 class="section-heading text-center mb-12" data-lang-key="commentsHeading">التعليقات</h2>
                <div class="card p-8 md:p-12">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="leaveComment">أضف تعليقك</h3>
                    <form id="commentForm" class="space-y-4">
                        <div>
                            <label for="commentName" class="block text-sm font-medium" data-lang-key="commentNameLabel">اسمك:</label>
                            <input type="text" id="commentName" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="commentNamePlaceholder" placeholder="ادخل اسمك" required>
                        </div>
                        <div>
                            <label for="commentText" class="block text-sm font-medium" data-lang-key="commentTextLabel">تعليقك:</label>
                            <textarea id="commentText" rows="4" class="mt-1 block w-full rounded-md shadow-sm" data-lang-key="commentTextPlaceholder" placeholder="اكتب تعليقك هنا..." required></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium" data-lang-key="commentRatingLabel">تقييمك:</label>
                            <div id="starRatingInput" class="star-rating interactive flex mt-1"></div>
                            <input type="hidden" id="commentRatingValue" value="0">
                        </div>
                        <div>
                            <label for="commentImage" class="block text-sm font-medium" data-lang-key="commentImageLabel">إضافة صورة (اختياري):</label>
                            <div class="relative mt-1">
                                <!-- Updated to accept only image files -->
                                <input type="file" id="commentImage" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                                <div class="custom-file-input"><span id="fileInputText" data-lang-key="fileInputChoose">اختيار ملف</span></div>
                            </div>
                            <img id="imagePreview" src="#" alt="Image Preview" class="hidden">
                        </div>
                        <button type="submit" class="btn-primary w-full" data-lang-key="commentSubmitBtn">إرسال التعليق</button>
                    </form>
                    <hr class="my-8 border-gray-200 dark:border-gray-600">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-700 dark:text-indigo-400" data-lang-key="allComments">جميع التعليقات</h3>
                    <div id="commentsList" class="space-y-6">
                        <p id="commentsLoading" class="text-center text-gray-500 dark:text-gray-400" data-lang-key="commentsLoading">جاري تحميل التعليقات...</p>
                        <p id="noComments" class="text-center text-gray-500 dark:text-gray-400 hidden" data-lang-key="noComments">لا توجد تعليقات حتى الآن. كن أول من يعلق!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8 text-center">
        <p id="footerCopyright" data-lang-key="footerText">© 2025 جميع الحقوق محفوظة لفريق التصميم والمشاريع.</p>
    </footer>

    <div id="modeIndicator" class="fixed bottom-4 right-4 bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold z-50">الوضع الفاتح</div>
    <div id="developerModeIndicator" class="hidden">وضع المطور</div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, doc, deleteDoc, runTransaction, arrayUnion, arrayRemove, getDoc, where, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Initialization
        // ملاحظة: سيتم توفير متغيرات البيئة تلقائيًا بواسطة نظام Canvas
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyBbL9kbE7oP5CW4HmZJGCCmZRY2L5wxxkM",
            authDomain: "ourservices-c5658.firebaseapp.com",
            projectId: "ourservices-c5658",
            storageBucket: "ourservices-c5658.appspot.com",
            messagingSenderId: "951641862997",
            appId: "1:951641862997:web:4744607ef9c0c516d9f5dc",
            measurementId: "G-5LTEVPPJW1"
        };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let app, db, auth, userId;
        let isAuthReady = false;
        let isDeveloperMode = false;
        const DEVELOPER_MODE_SECRET = "Ahmad@2006";
        const IMGBB_API_KEY = "c6af93a30efee65fec6b505a82033875";
        const FORMSPREE_ENDPOINT = "https://formspree.io/f/xrbllnal";


        // DOM Elements
        const customAlertModal = document.getElementById('customAlertModal');
        const customAlertMessage = document.getElementById('customAlertMessage');
        const customAlertButtons = document.getElementById('customAlertButtons');
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIconPath = document.getElementById('darkModeIconPath');
        const body = document.body;
        const modeIndicator = document.getElementById('modeIndicator');
        const developerModeIndicator = document.getElementById('developerModeIndicator');
        const languageDropdownButton = document.getElementById('languageDropdownButton');
        const languageDropdownMenu = document.getElementById('languageDropdownMenu');
        const commentForm = document.getElementById('commentForm');
        const commentsList = document.getElementById('commentsList');
        const commentsLoading = document.getElementById('commentsLoading');
        const noComments = document.getElementById('noComments');
        const footerCopyright = document.getElementById('footerCopyright');
        const commentImageInput = document.getElementById('commentImage');
        const imagePreview = document.getElementById('imagePreview');
        const fullImageModal = document.getElementById('fullImageModal');
        const fullImage = document.getElementById('fullImage');
        const fileInputText = document.getElementById('fileInputText');
        const starRatingInputContainer = document.getElementById('starRatingInput');
        const commentRatingValue = document.getElementById('commentRatingValue');
        
        // New Order Form Elements
        const orderModal = document.getElementById('orderModal');
        const orderSubmittedModal = document.getElementById('orderSubmittedModal');
        const closeOrderModal = document.getElementById('closeOrderModal');
        const closeOrderSubmittedModal = document.getElementById('closeOrderSubmittedModal');
        const heroOrderNowBtn = document.getElementById('heroOrderNowBtn');
        const orderNowNavBtn = document.getElementById('orderNowNavBtn');
        const orderForm = document.getElementById('orderForm');
        const orderServiceSelect = document.getElementById('orderService');
        const otherServiceField = document.getElementById('otherServiceField');
        const otherServiceText = document.getElementById('otherServiceText');
        const submitOrderBtn = document.getElementById('submitOrderBtn');
        const orderFilesInput = document.getElementById('orderFiles');
        const orderFileInputText = document.getElementById('orderFileInputText');
        const orderImagesPreview = document.getElementById('orderImagesPreview');
        const orderGeolocationInput = document.getElementById('orderGeolocation');
        const orderIpAddressInput = document.getElementById('orderIpAddressInput');
        const formspreeMessage = document.getElementById('formspreeMessage');

        // New Order Tracking Elements
        const trackOrderInput = document.getElementById('orderTrackInput');
        const trackOrderBtn = document.getElementById('trackOrderBtn');
        const orderStatusDisplay = document.getElementById('orderStatusDisplay');
        const displayedOrderId = document.getElementById('displayedOrderId');
        const progressBarCanvas = document.getElementById('progressBarCanvas');
        const progressStepsLabels = document.querySelectorAll('.progress-step');
        const orderPreviewImages = document.getElementById('orderPreviewImages');

        // New Developer Mode Elements
        const developerDashboard = document.getElementById('developer-dashboard');
        const devOrdersList = document.getElementById('devOrdersList');
        const devLoadingText = document.getElementById('devLoadingText');
        const noOrders = document.getElementById('noOrders');
        
        // List to hold files chosen for the order form
        let orderFiles = [];
        let userLocation = { latitude: null, longitude: null };

        // Function to get the user's IP address using a more reliable API
        async function getIPAddress() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (!response.ok) {
                    throw new Error(`API returned status code ${response.status}`);
                }
                const data = await response.json();
                return data.ip || 'غير متوفر';
            } catch (error) {
                console.error('Failed to fetch IP address:', error);
                return 'غير متوفر';
            }
        }

        async function initFirebase() {
            try {
                const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
                    apiKey: "AIzaSyBbL9kbE7oP5CW4HmZJGCCmZRY2L5wxxkM", // تأكد من أن هذا المفتاح صحيح
                    authDomain: "ourservices-c5658.firebaseapp.com",
                    projectId: "ourservices-c5658",
                    storageBucket: "ourservices-c5658.appspot.com",
                    messagingSenderId: "951641862997",
                    appId: "1:951641862997:web:4744607ef9c0c516d9f5dc",
                    measurementId: "G-5LTEVPPJW1"
                };

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        loadComments();
                        // أضفنا استدعاء جديد لتحميل الطلبات في وضع المطور
                        if (isDeveloperMode) {
                            loadDevOrders();
                        }
                    } else {
                        await signInAnonymously(auth);
                    }
                });
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showAlert("alertFirebaseInitError");
            }
        }
        
        // كائن الترجمات المحدث مع إضافة نصوص جديدة لنظام تتبع الطلبات
        const translations = {
            ar: {  
                siteTitle: "خدمتنا - تصميم وتطوير المشاريع", navHome: "الرئيسية", navWhyChooseUs: "لماذا تختارنا؟", navAboutUs: "من نحن؟", navServices: "ماذا نقدم؟", navContact: "تواصل معنا", navComments: "التعليقات", navTrackOrder: "تتبع طلبك", heroTitle: "مصممون جميع أنواع المشاريع والمواقع والتصاميم والبحوث والواجبات", heroDiscount: "خصم 30% لفترة محدودة على كامل الخدمات", heroSubtitle: "نقدم لكم حلولاً متكاملة لتلبية جميع احتياجاتكم الأكاديمية والمهنية", heroContactBtn: "تواصل معنا الآن", featuresHeading: "لماذا تختارنا؟", feature1Title: "تنسيقات شكل رائعة", feature1Desc: "نقدم العديد من التنسيقات الجمالية التي تبرز عملك.", feature2Title: "تنسيق كلام احترافي", feature2Desc: "تنسيق دقيق للمحتوى في البحوث والمشاريع.", feature3Title: "أكثر من 100 نوع خط", feature3Desc: "اختر من مجموعة واسعة من الخطوط المميزة.", feature4Title: "عروض تقديمية مميزة", feature4Desc: "تصميم عروض بوربوينت جذابة ومبتكرة.", aboutUsHeading: "من نحن؟", aboutUsParagraph1: "نحن فريق متقدم من خريجي جامعة UCSI الماليزية، نجمع بين المعرفة الأكاديمية العميقة والخبرة العملية الواسعة في تصميم وتنفيذ العديد من المشاريع الكبيرة والصغيرة.", aboutUsParagraph2: "نلتزم بتقديم خدمات عالية الجودة بأسعار تنافسية للغاية، مع التركيز الدائم على تحقيق رضا العميل كشعارنا الأول والأخير ✨.", servicesHeading: "ماذا نقدم؟", service1Title: "تصميم ثلاثي الأبعاد", service1Desc: "تصميم جميع أنواع القطع ثلاثية الأبعاد على برامج الأوتوكاد وبرامج الطباعة ثلاثية الأبعاد بجميع صيغ الملفات القابلة للطباعة.", service2Title: "عروض تقديمية (بوربوينت)", service2Desc: "تصميم عروض تقديمية على البوربوينت مع كامل التنسيق وإضافة الصور والحركات المرئية.", service3Title: "تنسيق ملفات إكسل", service3Desc: "تصميم وتعديل وتنسيق ملفات إكسل باحترافية عالية.", service4Title: "تصاميم هندسية ومخططات", service4Desc: "تصاميم هندسية، مخططات، كهرباء، وغيرها من الأعمال الهندسية المتخصصة.", service5Title: "كتابة وتنسيق تقارير", service5Desc: "كتابة وتنسيق التقارير على برنامج الوورد بجودة ودقة عالية.", service6Title: "تصميم وتعديل فيديوهات وصور", service6Desc: "تصميم وتعديل الفيديوهات والصور بجودة عالية لتناسب جميع احتياجاتكم.", service7Title: "برمجة وتطوير مواقع الويب", service7Desc: "برمجة مواقع ويب تفاعلية وجمالية باستخدام لغة JavaScript وتنسيق الشكل باستخدام CSS، مع إضافة الموقع على سيرفر وإنشاء رابط خاص به.", contactHeading: "للتواصل معنا", contactSubtitle: "يسعدنا استقبال استفساراتكم وطلباتكم عبر وسائل التواصل التالية:", whatsappNumberKSA: "0500900329 داخل المملكة", whatsappNumberOutsideKSA: "+60163340537 خارج المملكة", telegramContact: "التواصل عبر التلجرام", footerText: "© 2025 جميع الحقوق محفوظة لفريق التصميم والمشاريع.", modeLight: "الوضع الفاتح", modeDark: "الوضع الداكن", commentsHeading: "التعليقات", leaveComment: "أضف تعليقك", commentNameLabel: "اسمك:", commentNamePlaceholder: "ادخل اسمك", commentTextLabel: "تعليقك:", commentTextPlaceholder: "اكتب تعليقك هنا...", commentRatingLabel: "تقييمك:", commentImageLabel: "إضافة صورة (اختياري):", fileInputChoose: "اختيار ملف", fileInputNoFile: "لم يتم اختيار أي ملف", commentSubmitBtn: "إرسال التعليق", allComments: "جميع التعليقات", commentsLoading: "جاري تحميل التعليقات...", noComments: "لا توجد تعليقات حتى الآن. كن أول من يعلق!", commentDateUnavailable: "التاريخ غير متوفر", alertNameTextEmpty: "الرجاء إدخال اسمك.", alertCommentTextEmpty: "الرجاء إدخال تعليقك.", alertCommentAddedSuccess: "تم إرسال تعليقك بنجاح!", alertCommentAddError: "حدث خطأ أثناء إضافة التعليق. الرجاء المحاولة مرة أخرى.", alertFirebaseInitError: "فشل تهيئة Firebase. قد لا تعمل التعليقات بشكل صحيح.", alertFirebaseNotReady: "Firebase غير جاهز بعد. الرجاء الانتظار.", alertDeleteConfirm: "هل أنت متأكد أنك تريد حذف هذا التعليق؟", alertDeleteSuccess: "تم حذف التعليق بنجاح!", alertDeleteError: "حدث خطأ أثناء حذف التعليق. الرجاء المحاولة مرة أخرى.", alertNoPermission: "ليس لديك صلاحية لحذف هذا التعليق.", alertDeveloperModePrompt: "الرجاء إدخال الكود السري للدخول إلى وضع المطور:", alertDeveloperModeSuccess: "تم تفعيل وضع المطور بنجاح!", alertDeveloperModeInvalid: "الكود السري غير صحيح. الرجاء المحاولة مرة أخرى.", alertDeveloperModeExit: "تم الخروج من وضع المطور.", confirmText: "نعم", cancelText: "إلغاء", customAlertClose: "حسناً", developerModeIndicatorText: "وضع المطور", translateBtnText: "ترجمة", translateError: "فشل في الترجمة.", imageUploadError: "فشل رفع الصورة. الرجاء المحاولة مرة أخرى.", resetDislikesConfirm: "هل أنت متأكد من إعادة تعيين الإعجابات السلبية؟", resetDislikesSuccess: "تم إعادة تعيين الإعجابات السلبية بنجاح!", resetDislikesError: "فشل إعادة تعيين الإعجابات السلبية.",
                // New translations for the order form
                orderNowBtn: "اطلب الآن",
                orderFormTitle: "نموذج طلب خدمة",
                orderNameLabel: "الاسم الكامل:",
                orderNamePlaceholder: "الاسم الكامل",
                orderEmailLabel: "البريد الإلكتروني:",
                orderEmailPlaceholder: "yourname@example.com",
                orderPhoneLabel: "رقم الهاتف:",
                orderPhonePlaceholder: "+966 50 123 4567",
                orderServiceLabel: "نوع الخدمة المطلوبة:",
                orderServiceSelect: "اختر خدمة...",
                orderServiceOther: "أخرى...",
                orderServiceOtherLabel: "الرجاء تحديد الخدمة المطلوبة:",
                orderServiceOtherPlaceholder: "اكتب الخدمة المخصصة هنا...",
                orderMessageLabel: "تفاصيل المشروع:",
                orderMessagePlaceholder: "اشرح متطلبات مشروعك بالتفصيل...",
                orderFilesLabel: "إضافة صور (اختياري):", // Added translation
                orderSubmitBtn: "تقديم الطلب",
                orderSuccess: "شكراً لك! تم استلام طلبك بنجاح.",
                orderIdMessage: "الرجاء الاحتفاظ برقم طلبك لتتبع حالته:",
                orderError: "حدث خطأ أثناء إرسال طلبك. الرجاء المحاولة مرة أخرى.",
                orderFieldRequired: "This field is required.",
                locationUnavailable: "الموقع غير متوفر",

                // New translations for order tracking
                navTrackOrder: "تتبع طلبك",
                trackOrderHeading: "تتبع طلبك",
                trackOrderSubtitle: "أدخل رقم طلبك المكون من 6 أرقام لتتبع حالته.",
                trackOrderInputPlaceholder: "أدخل رقم الطلب هنا...",
                trackOrderBtn: "تتبع",
                orderStatusTitle: "حالة الطلب:",
                status1: "بانتظار الموافقة",
                status2: "قيد التنفيذ",
                status3: "معاينة المشروع",
                status4: "بانتظار الدفع",
                status5: "اكتمل",
                orderNotFound: "لم يتم العثور على طلب بهذا الرقم.",
                orderTrackError: "حدث خطأ أثناء تتبع الطلب. الرجاء المحاولة مرة أخرى.",
                orderPreviewImagesTitle: "صور معاينة للمشروع:",
                
                // New translations for developer dashboard
                devDashboardHeading: "لوحة تحكم المطور",
                devLoading: "جاري تحميل الطلبات...",
                noOrders: "لا توجد طلبات حتى الآن.",
                devOrderId: "رقم الطلب:",
                devOrderUser: "العميل:",
                devOrderStatus: "الحالة:",
                devActions: "الإجراءات:",
                devUpdateStatus: "تحديث الحالة",
                devUploadImages: "رفع صور",
                devImagesLabel: "صور المعاينة:",
                devNoImages: "لا توجد صور معاينة بعد.",
                devOrderDate: "تاريخ الطلب:",
            },
            en: {  
                siteTitle: "Our Services - Project Design & Development", navHome: "Home", navWhyChooseUs: "Why Choose Us?", navAboutUs: "About Us", navServices: "What We Offer?", navContact: "Contact Us", navComments: "Comments", navTrackOrder: "Track Your Order", heroTitle: "Designers of all types of projects, websites, designs, research, and assignments", heroDiscount: "30% discount for a limited time on all services", heroSubtitle: "We offer integrated solutions to meet all your academic and professional needs", heroContactBtn: "Contact Us Now", featuresHeading: "Why Choose Us?", feature1Title: "Excellent Visual Formats", feature1Desc: "We provide many aesthetic formats that highlight your work.", feature2Title: "Professional Text Formatting", feature2Desc: "Precise content formatting for research and projects.", feature3Title: "Over 100 Font Types", feature3Desc: "Choose from a wide range of distinctive fonts.", feature4Title: "Outstanding Presentations", feature4Desc: "Designing attractive and innovative PowerPoint presentations.", aboutUsHeading: "Who Are We?", aboutUsParagraph1: "We are an advanced team of UCSI Malaysian University graduates, combining deep academic knowledge with extensive practical experience in designing and implementing many large and small projects.", aboutUsParagraph2: "We are committed to providing high-quality services at highly competitive prices, with a constant focus on achieving customer satisfaction as our first and last motto ✨.", servicesHeading: "What We Offer?", service1Title: "3D Design", service1Desc: "Designing all types of 3D parts on AutoCAD and 3D printing software in all printable file formats.", service2Title: "Presentations (PowerPoint)", service2Desc: "Designing PowerPoint presentations with full formatting and adding images and visual effects.", service3Title: "Excel File Formatting", service3Desc: "Designing, modifying, and formatting Excel files with high professionalism.", service4Title: "Engineering Designs & Plans", service4Desc: "Engineering designs, plans, electrical works, and other specialized engineering works.", service5Title: "Report Writing & Formatting", service5Desc: "Writing and formatting reports in Word with high quality and accuracy.", service6Title: "Video & Photo Design/Editing", service6Desc: "Designing and editing videos and photos with high quality to suit all your needs.", service7Title: "Web Programming & Development", service7Desc: "Programming interactive and aesthetic websites using JavaScript and styling with CSS, including hosting the site on a server and creating a dedicated link.", contactHeading: "Contact Us", contactSubtitle: "We are happy to receive your inquiries and requests via the following channels:", whatsappNumberKSA: "0500900329 Inside KSA", whatsappNumberOutsideKSA: "+60163340537 Outside KSA", telegramContact: "Contact via Telegram", footerText: "© 2025 All rights reserved for the Design and Projects Team.", modeLight: "Light Mode", modeDark: "Dark Mode", commentsHeading: "Comments", leaveComment: "Leave a comment", commentNameLabel: "Your Name:", commentNamePlaceholder: "Enter your name", commentTextLabel: "Your Comment:", commentTextPlaceholder: "Write your comment here...", commentRatingLabel: "Your Rating:", commentImageLabel: "Add an image (optional):", fileInputChoose: "Choose file", fileInputNoFile: "No file chosen", commentSubmitBtn: "Submit Comment", allComments: "All Comments", commentsLoading: "Loading comments...", noComments: "No comments yet. Be the first to comment!", commentDateUnavailable: "Date Unavailable", alertNameTextEmpty: "Please enter your name.", alertCommentTextEmpty: "Please enter your comment.", alertCommentAddedSuccess: "Comment submitted successfully!", alertCommentAddError: "An error occurred while adding the comment. Please try again.", alertFirebaseInitError: "Firebase initialization failed. Comments may not work correctly.", alertFirebaseNotReady: "Firebase is not ready yet. Please wait.", alertDeleteConfirm: "Are you sure you want to delete this comment?", alertDeleteSuccess: "Comment deleted successfully!", alertDeleteError: "An error occurred while deleting the comment. Please try again.", alertNoPermission: "You do not have permission to delete this comment.", alertDeveloperModePrompt: "Please enter the secret code to enter developer mode:", alertDeveloperModeSuccess: "Developer mode activated successfully!", alertDeveloperModeInvalid: "Incorrect secret code. Please try again.", alertDeveloperModeExit: "Exited developer mode.", confirmText: "Yes", cancelText: "Cancel", customAlertClose: "OK", developerModeIndicatorText: "Developer Mode", translateBtnText: "Translate", translateError: "Translation failed.", imageUploadError: "Image upload failed. Please try again.", resetDislikesConfirm: "Are you sure you want to reset the dislikes?", resetDislikesSuccess: "Dislikes reset successfully!", resetDislikesError: "Failed to reset dislikes.",
                // New translations for the order form
                orderNowBtn: "Order Now",
                orderFormTitle: "Service Request Form",
                orderNameLabel: "Full Name:",
                orderNamePlaceholder: "Full Name",
                orderEmailLabel: "Email Address:",
                orderEmailPlaceholder: "yourname@example.com",
                orderPhoneLabel: "Phone Number:",
                orderPhonePlaceholder: "+966 50 123 4567",
                orderServiceLabel: "Requested Service:",
                orderServiceSelect: "Select a service...",
                orderServiceOther: "Other...",
                orderServiceOtherLabel: "Please specify the requested service:",
                orderServiceOtherPlaceholder: "Write your custom service here...",
                orderMessageLabel: "Project Details:",
                orderMessagePlaceholder: "Explain your project requirements in detail...",
                orderFilesLabel: "Add images (optional):",
                orderSubmitBtn: "Submit Request",
                orderSuccess: "Thank you! Your request has been received successfully.",
                orderIdMessage: "Please save your order ID to track its status:",
                orderError: "An error occurred while submitting your request. Please try again.",
                orderFieldRequired: "This field is required.",
                locationUnavailable: "Location unavailable",

                // New translations for order tracking
                navTrackOrder: "Track Your Order",
                trackOrderHeading: "Track Your Order",
                trackOrderSubtitle: "Enter your 6-digit order ID to check its status.",
                trackOrderInputPlaceholder: "Enter Order ID here...",
                trackOrderBtn: "Track",
                orderStatusTitle: "Order Status:",
                status1: "Awaiting Approval",
                status2: "In Progress",
                status3: "Project Preview",
                status4: "Awaiting Payment",
                status5: "Completed",
                orderNotFound: "Order with this ID was not found.",
                orderTrackError: "An error occurred while tracking the order. Please try again.",
                orderPreviewImagesTitle: "Project Preview Images:",
                
                // New translations for developer dashboard
                devDashboardHeading: "Developer Dashboard",
                devLoading: "Loading orders...",
                noOrders: "No orders have been placed yet.",
                devOrderId: "Order ID:",
                devOrderUser: "Client:",
                devOrderStatus: "Status:",
                devActions: "Actions:",
                devUpdateStatus: "Update Status",
                devUploadImages: "Upload Images",
                devImagesLabel: "Preview Images:",
                devNoImages: "No preview images yet.",
                devOrderDate: "Order Date:",
            }
        };

        let currentLang = localStorage.getItem('lang') || 'ar';
        const htmlElement = document.documentElement;

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            htmlElement.lang = lang;
            htmlElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const translation = translations[currentLang]?.[key] || translations.en[key];
                if (translation) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
                        element.placeholder = translation;
                        if (element.tagName === 'SELECT' && element.options[0]) {
                            element.options[0].textContent = translation;
                        }
                    } else {
                        element.textContent = translation;
                    }
                }
            });

            const serviceOptions = orderServiceSelect.options;
            const serviceTitles = [
                'service1Title', 'service2Title', 'service3Title', 'service4Title', 'service5Title', 'service6Title', 'service7Title', 'orderServiceOther'
            ];
            for (let i = 1; i < serviceOptions.length; i++) {
                const key = serviceTitles[i - 1];
                const translation = translations[currentLang]?.[key] || translations.en[key];
                serviceOptions[i].textContent = translation;
            }
            
            document.getElementById('currentLanguageText').textContent = lang.toUpperCase();
            updateModeIndicatorText();
            updateDeveloperModeIndicatorText();
            loadComments();
        }

        function showAlert(messageKey, type = 'alert', onConfirm = null) {
            customAlertMessage.textContent = translations[currentLang][messageKey] || messageKey;
            customAlertButtons.innerHTML = '';
            if (type === 'alert') {
                const closeBtn = document.createElement('button');
                closeBtn.className = 'btn-primary';
                closeBtn.textContent = translations[currentLang].customAlertClose;
                closeBtn.onclick = () => customAlertModal.classList.add('hidden');
                customAlertButtons.appendChild(closeBtn);
            } else if (type === 'confirm') {
                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'confirm-btn';
                confirmBtn.textContent = translations[currentLang].confirmText;
                confirmBtn.onclick = () => { customAlertModal.classList.add('hidden'); if (onConfirm) onConfirm(true); };

                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'cancel-btn';
                cancelBtn.textContent = translations[currentLang].cancelText;
                cancelBtn.onclick = () => { customAlertModal.classList.add('hidden'); if (onConfirm) onConfirm(false); };
                
                customAlertButtons.appendChild(confirmBtn);
                customAlertButtons.appendChild(cancelBtn);
            } else if (type === 'prompt') {
                customAlertButtons.innerHTML = '';
                const passwordInput = document.createElement('input');
                passwordInput.type = 'password';
                passwordInput.id = 'developerPasswordInput';
                passwordInput.className = 'mt-4 block w-full rounded-md shadow-sm p-2';
                passwordInput.placeholder = 'Secret Code...';
                customAlertButtons.appendChild(passwordInput);

                const submitBtn = document.createElement('button');
                submitBtn.className = 'btn-primary mt-4';
                submitBtn.textContent = translations[currentLang].confirmText;
                submitBtn.onclick = () => {
                    if (passwordInput.value === DEVELOPER_MODE_SECRET) {
                        isDeveloperMode = true;
                        customAlertModal.classList.add('hidden');
                        showAlert("alertDeveloperModeSuccess");
                        developerModeIndicator.style.display = 'block';
                        updateDeveloperModeIndicatorText();
                        loadComments();
                        loadDevOrders(); // New: Load orders in dev mode
                    } else {
                        showAlert("alertDeveloperModeInvalid");
                    }
                };
                customAlertButtons.appendChild(submitBtn);
            }
            customAlertModal.classList.remove('hidden');
        }

        hamburger.addEventListener('click', () => {
            navLinks.classList.toggle('hidden');
            navLinks.classList.toggle('open');
            hamburger.classList.toggle('open');
        });

        navLinks.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 767) {
                    navLinks.classList.add('hidden');
                    navLinks.classList.remove('open');
                    hamburger.classList.remove('open');
                }
            });
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const targetId = this.getAttribute('href');
                if (!targetId || targetId === '#') {
                    e.preventDefault();
                    return;
                }
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    e.preventDefault();
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        function updateModeIndicatorText() {
            if (modeIndicator) {
                if (body.classList.contains('dark')) {
                    modeIndicator.textContent = translations[currentLang].modeDark;
                    modeIndicator.className = 'fixed bottom-4 right-4 bg-gray-700 text-gray-100 px-3 py-1 rounded-full text-xs font-semibold z-50';
                } else {
                    modeIndicator.textContent = translations[currentLang].modeLight;
                    modeIndicator.className = 'fixed bottom-4 right-4 bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold z-50';
                }
            }
        }
        
        function applyDarkMode(isDark) {
            if (isDark) {
                body.classList.add('dark');
                darkModeIconPath.setAttribute('d', 'M12 2.5a.5.5 0 01.5.5v2a.5.5 0 01-1 0v-2a.5.5 0 01.5-.5zM18.364 5.636a.5.5 0 01.354.854l-1.414 1.414a.5.5 0 01-.707-.707l1.414-1.414a.5.5 0 01.353-.147zM21.5 12a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM18.364 18.364a.5.5 0 01-.354.854l-1.414-1.414a.5.5 0 01.707.707l1.414 1.414a.5.5 0 01-.353.147zM12 21.5a.5.5 0 01-.5-.5v-2a.5.5 0 011 0v2a.5.5 0 01-.5.5zM5.636 18.364a.5.5 0 01-.354-.854l1.414-1.414a.5.5 0 01.707.707l-1.414 1.414a.5.5 0 01-.353.147zM2.5 12a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM5.636 5.636a.5.5 0 01.354-.854l1.414 1.414a.5.5 0 01-.707.707L5.283 5.99a.5.5 0 01.353-.147zM12 7a5 5 0 100 10 5 5 0 000-10z');
            } else {
                body.classList.remove('dark');
                darkModeIconPath.setAttribute('d', 'M12 3a9 9 0 109 9c0-.46-.04-.92-.12-1.36a5.999 5.999 0 01-8.588-8.588C12.92 3.04 12.46 3 12 3z');
            }
            updateModeIndicatorText();
        }

        darkModeToggle.addEventListener('click', () => {
            const isDark = !body.classList.contains('dark');
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
            applyDarkMode(isDark);
        });

        languageDropdownButton.addEventListener('click', (e) => {
            languageDropdownMenu.classList.toggle('active');
            e.stopPropagation();
        });

        document.addEventListener('click', (e) => {
            if (!languageDropdownMenu.contains(e.target) && !languageDropdownButton.contains(e.target)) {
                languageDropdownMenu.classList.remove('active');
            }
        });

        languageDropdownMenu.querySelectorAll('li').forEach(item => {
            item.addEventListener('click', (e) => {
                setLanguage(e.target.getAttribute('data-lang'));
                languageDropdownMenu.classList.remove('active');
            });
        });
        
        commentImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    imagePreview.src = event.target.result;
                    imagePreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
                fileInputText.textContent = file.name.length > 20 ? file.name.substring(0, 17) + '...' : file.name;
            } else {
                imagePreview.src = '#';
                imagePreview.classList.add('hidden');
                fileInputText.textContent = translations[currentLang].fileInputChoose;
            }
        });

        function setupStarRating(container, input) {
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('span');
                star.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"></path></svg>`;
                star.dataset.value = i;
                container.appendChild(star);
            }
            
            const stars = container.querySelectorAll('span');
            const updateStars = (rating) => {
                stars.forEach(star => star.querySelector('svg').classList.toggle('filled', star.dataset.value <= rating));
            };

            container.addEventListener('click', e => {
                const star = e.target.closest('span');
                if (star) {
                    input.value = star.dataset.value;
                    updateStars(input.value);
                }
            });

            container.addEventListener('mouseover', e => {
                const star = e.target.closest('span');
                if (star) updateStars(star.dataset.value);
            });
            
            container.addEventListener('mouseout', () => updateStars(input.value));
            updateStars(input.value);
        }

        commentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }

            const commentName = document.getElementById('commentName').value.trim();
            const commentText = document.getElementById('commentText').value.trim();
            const rating = parseInt(commentRatingValue.value, 10);
            const commentImageFile = commentImageInput.files[0];

            if (!commentName) { showAlert('alertNameTextEmpty'); return; }
            if (!commentText) { showAlert('alertCommentTextEmpty'); return; }

            let imageUrl = null;
            if (commentImageFile) {
                const formData = new FormData();
                formData.append("image", commentImageFile);
                try {
                    const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
                    const result = await res.json();
                    if (result.success) imageUrl = result.data.url;
                    else throw new Error(result.error.message);
                } catch (err) {
                    console.error("Image upload failed:", err);
                    showAlert("imageUploadError");
                    return;
                }
            }

            const { device, browser, deviceName } = getDeviceInfo();
            const ipAddress = await getIPAddress();
            
            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/comments`), {
                    name: commentName,
                    text: commentText,
                    rating,
                    imageUrl,
                    timestamp: serverTimestamp(),
                    userId,
                    likes: 0,
                    dislikes: 0,
                    likedBy: [],
                    dislikedBy: [],
                    device,
                    browser,
                    deviceName,
                    latitude: userLocation.latitude,
                    longitude: userLocation.longitude,
                    ipAddress
                });
                commentForm.reset();
                imagePreview.classList.add('hidden');
                fileInputText.textContent = translations[currentLang].fileInputChoose;
                commentRatingValue.value = "0";
                setupStarRating(starRatingInputContainer, commentRatingValue);
                showAlert("alertCommentAddedSuccess");
            } catch (err) {
                console.error("Error adding comment: ", err);
                showAlert("alertCommentAddError");
            }
        });
        
        function createStarDisplay(rating) {
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                starsHTML += `<svg class="${i <= rating ? 'filled' : ''}" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"></path></svg>`;
            }
            return `<div class="star-rating">${starsHTML}</div>`;
        }
        
        function getDeviceIcon(device) {
            if (device === 'Desktop') {
                return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor"><rect width="20" height="14" x="2" y="3" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>`;
            } else if (device === 'Tablet') {
                return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tablet"><rect width="18" height="14" x="3" y="5" rx="2"/><path d="M7 19h10"/></svg>`;
            } else if (device === 'Mobile') {
                return `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-smartphone"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>`;
            }
            return '';
        }

        function getDeviceInfo() {
            const userAgent = navigator.userAgent;
            let device = "Desktop";
            let browser = "Unknown";
            let os = "Unknown OS";
            let deviceModel = "";

            if (/(tablet|ipad|playbook)|(android(?!.*mobile))|(kindle)|(silk)|(gt\-p)|(sm\-t)/i.test(userAgent)) {
                device = "Tablet";
            } else if (/(Mobi|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini)/i.test(userAgent)) {
                device = "Mobile";
            }

            if (userAgent.indexOf("Chrome") !== -1 && userAgent.indexOf("Edg") === -1) {
                browser = "Chrome";
            } else if (userAgent.indexOf("Firefox") !== -1) {
                browser = "Firefox";
            } else if (userAgent.indexOf("Safari") !== -1 && userAgent.indexOf("Chrome") === -1) {
                browser = "Safari";
            } else if (userAgent.indexOf("Edge") !== -1) {
                browser = "Edge";
            } else if (userAgent.indexOf("Opera") !== -1 || userAgent.indexOf("OPR") !== -1) {
                browser = "Opera";
            }

            if (userAgent.indexOf("Win") !== -1) os = "Windows";
            if (userAgent.indexOf("Mac") !== -1) os = "MacOS";
            if (userAgent.indexOf("Linux") !== -1) os = "Linux";
            if (userAgent.indexOf("Android") !== -1) os = "Android";
            if (userAgent.match(/iPhone/i)) {
                const iphoneModel = userAgent.match(/iPhone\s(.*?);/i);
                if (iphoneModel && iphoneModel[1]) {
                    deviceModel = `iPhone ${iphoneModel[1].replace(';','')}`;
                } else {
                    deviceModel = 'iPhone';
                }
            } else if (userAgent.match(/iPad/i)) {
                deviceModel = 'iPad';
            } else if (userAgent.match(/Android/i)) {
                const androidModel = userAgent.match(/Android\s[0-9.]+;\s([^;)]*)/i);
                if (androidModel && androidModel[1]) {
                    deviceModel = androidModel[1];
                } else {
                    deviceModel = 'Android Device';
                }
            }
            
            const deviceName = deviceModel ? `${os} - ${deviceModel}` : `${os} - ${device}`;

            return { device, browser, deviceName };
        }

        async function getGeolocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            userLocation = {
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                            };
                            resolve(userLocation);
                        },
                        (error) => {
                            let errorMessage = "Geolocation permission denied or location is unavailable.";
                            if (error.code === error.PERMISSION_DENIED) {
                                errorMessage = "Geolocation permission was denied by the user or disabled by a permissions policy.";
                            } else if (error.message) {
                                errorMessage = `Geolocation error: ${error.message}`;
                            }
                            console.error(errorMessage);
                            userLocation = { latitude: null, longitude: null };
                            resolve(userLocation);
                        }
                    );
                } else {
                    console.log("Geolocation is not supported by this browser.");
                    userLocation = { latitude: null, longitude: null };
                    resolve(userLocation);
                }
            });
        }

        async function handleReaction(commentId, reactionType) {
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }
            const commentRef = doc(db, `artifacts/${appId}/public/data/comments`, commentId);
            try {
                await runTransaction(db, async (transaction) => {
                    const commentDoc = await transaction.get(commentRef);
                    if (!commentDoc.exists()) throw "Document does not exist!";
                    const data = commentDoc.data();
                    let { likes, dislikes, likedBy, dislikedBy } = data;
                    likedBy = likedBy || []; dislikedBy = dislikedBy || [];
                    const hasLiked = likedBy.includes(userId);
                    const hasDisliked = dislikedBy.includes(userId);

                    if (reactionType === 'like') {
                        if (hasLiked) { transaction.update(commentRef, { likes: likes - 1, likedBy: arrayRemove(userId) }); }  
                        else {
                            const updates = { likes: likes + 1, likedBy: arrayUnion(userId) };
                            if (hasDisliked) { updates.dislikes = dislikes - 1; updates.dislikedBy = arrayRemove(userId); }
                            transaction.update(commentRef, updates);
                        }
                    } else if (reactionType === 'dislike') {
                        if (hasDisliked) { transaction.update(commentRef, { dislikes: dislikes - 1, dislikedBy: arrayRemove(userId) }); }  
                        else {
                            const updates = { dislikes: dislikes + 1, dislikedBy: arrayUnion(userId) };
                            if (hasLiked) { updates.likes = likes - 1; updates.likedBy = arrayRemove(userId); }
                            transaction.update(commentRef, updates);
                        }
                    }
                });
            } catch (e) { console.error("Reaction transaction failed: ", e); }
        }
        
        async function resetDislikes(commentId) {
            showAlert("resetDislikesConfirm", 'confirm', async (confirmed) => {
                if (confirmed) {
                    const commentRef = doc(db, `artifacts/${appId}/public/data/comments`, commentId);
                    try {
                        await runTransaction(db, async (t) => t.update(commentRef, { dislikes: 0, dislikedBy: [] }));
                        showAlert("resetDislikesSuccess");
                    } catch (e) { console.error("Error resetting dislikes:", e); showAlert("resetDislikesError"); }
                }
            });
        }

        async function deleteComment(commentId, commentUserId) {
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }
            if (userId !== commentUserId && !isDeveloperMode) { showAlert("alertNoPermission"); return; }
            showAlert("alertDeleteConfirm", 'confirm', async (confirmed) => {
                if (confirmed) {
                    try {
                        await deleteDoc(doc(db, `artifacts/${appId}/public/data/comments`, commentId));
                        showAlert("alertDeleteSuccess");
                    } catch (e) { console.error("Error deleting document: ", e); showAlert("alertDeleteError"); }
                }
            });
        }
        
        const commentTextCache = new Map();
        
        function loadComments() {
            if (!db) return;
            const q = query(collection(db, `artifacts/${appId}/public/data/comments`));
            const unsubscribe = onSnapshot(q, async (snapshot) => {
                let comments = [];
                snapshot.docs.forEach((doc) => {
                    comments.push({ ...doc.data(), id: doc.id });
                });
                comments.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));
                commentsList.innerHTML = '';
                commentsLoading.classList.add('hidden');
                noComments.classList.toggle('hidden', comments.length > 0);
                comments.forEach((comment) => {
                    const commentId = comment.id;
                    const commentElement = document.createElement('div');
                    commentElement.className = 'p-4 rounded-lg shadow-sm relative';
                    commentElement.dataset.commentId = commentId;
                    const hasLiked = comment.likedBy?.includes(userId);
                    const hasDisliked = comment.dislikedBy?.includes(userId);
                    const originalText = comment.text;
                    const commentDate = comment.timestamp ? new Date(comment.timestamp.toDate()).toLocaleString(currentLang) : translations[currentLang].commentDateUnavailable;
                    const geolocationHTML = (comment.latitude && comment.longitude) ?  
                        `<a href="https://www.google.com/maps/search/?api=1&query=${comment.latitude},${comment.longitude}" target="_blank" class="map-link">عرض الموقع</a>` : translations[currentLang].locationUnavailable;
                    const deviceInfoHTML = isDeveloperMode ?
                    `<div class="device-info mt-1">
                        ${getDeviceIcon(comment.device)}
                        <span class="text-xs text-gray-500 dark:text-gray-400">
                            ${comment.deviceName || comment.device || 'Unknown Device'} - ${comment.browser || 'Unknown Browser'}
                        </span>
                        <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                            <span class="mr-1">الموقع:</span>
                            ${geolocationHTML}
                        </div>
                    </div>` : '';
                    
                    const ipAddressHTML = (isDeveloperMode && comment.ipAddress && comment.ipAddress !== 'غير متوفر') ?
                        `<span class="text-sm font-light text-gray-500 dark:text-gray-400 ml-2">(IP: <span class="ip-address">${comment.ipAddress}</span>)</span>` : '';
                    
                    commentElement.innerHTML = `
                        <div class="flex items-start justify-between mb-2 gap-4">
                            <div class="flex items-center gap-3">
                                <p class="font-semibold text-indigo-600 dark:text-indigo-300">${comment.name || 'Anonymous'}</p>
                                ${ipAddressHTML}
                                ${comment.rating > 0 ? createStarDisplay(comment.rating) : ''}
                            </div>
                            <div class="flex items-center flex-shrink-0">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mx-2">${commentDate}</p>
                                ${(userId === comment.userId || isDeveloperMode) ? `
                                    <button class="text-red-500 hover:text-red-700 p-1 rounded-full focus:outline-none ml-1" data-action="delete" aria-label="Delete">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm2 3a1 1 0 011-1h2a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                                    </button>` : ''}
                                ${isDeveloperMode ? `<button class="action-btn dev-action-btn" data-action="reset-dislikes" title="${translations[currentLang].resetDislikesConfirm}"><svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75V4.5h8V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 6a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 6ZM4.5 6.5A.75.75 0 0 1 5.25 6h9.5a.75.75 0 0 1 0 1.5h-9.5A.75.75 0 0 1 4.5 6.5Z" clip-rule="evenodd" /><path d="M6.05 8.05a.75.75 0 0 1 .75.75v6.25a.75.75 0 0 1-1.5 0V8.8a.75.75 0 0 1 .75-.75Zm4.5 0a.75.75 0 0 1 .75.75v6.25a.75.75 0 0 1-1.5 0V8.8a.75.75 0 0 1 .75-.75Zm3.75.75a.75.75 0 0 0-1.5 0v6.25a.75.75 0 0 0 1.5 0V8.8Z" /><path d="M4 5.5a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1V15a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5.5Zm1.5 0a.5.5 0 0 0-.5.5V15a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-9Z" /></svg></button>` : ''}
                            </div>
                        </div>
                        ${deviceInfoHTML}
                        <p class="text-gray-900 dark:text-gray-200 mt-1" data-comment-text-id="${commentId}" data-original-text="${originalText}">${comment.text}</p>
                        ${comment.imageUrl ? `<img src="${comment.imageUrl}" alt="Comment Image" class="mt-4 comment-image" onclick="window.showFullImage('${comment.imageUrl}')">` : ''}
                        <div class="comment-actions">
                            <button class="action-btn ${hasLiked ? 'liked' : ''}" data-action="like" aria-label="Like"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333V19h8.333a2 2 0 001.992-1.838l.93-5.585A2 2 0 0015.333 9H12V4.5a2.5 2.5 0 00-5 0V9H6Z"></path></svg><span>${comment.likes || 0}</span></button>
                            <button class="action-btn ${hasDisliked ? 'disliked' : ''}" data-action="dislike" aria-label="Dislike"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667V1H5.667a2 2 0 00-1.992 1.838l-.93-5.585A2 2 0 004.667 11H8v4.5a2.5 2.5 0 005 0V11h3.333Z"></path></svg><span>${comment.dislikes || 0}</span></button>
                        </div>`;
                    commentsList.appendChild(commentElement);

                    commentElement.addEventListener('click', (e) => {
                        const button = e.target.closest('button[data-action]');
                        if (!button) return;
                        const action = button.dataset.action;

                        if (action === 'like' || action === 'dislike') {
                            handleReaction(commentId, action);
                        } else if (action === 'delete') {
                            deleteComment(commentId, comment.userId);
                        } else if (action === 'reset-dislikes' && isDeveloperMode) {
                            resetDislikes(commentId);
                        }
                    });
                });
            }, (error) => {
                console.error("Error listening to comments:", error);
                commentsLoading.textContent = translations[currentLang].alertCommentAddError;
                commentsLoading.classList.remove('hidden');
            });
        }
        
        let footerClickCount = 0, lastFooterClickTime = 0;
        footerCopyright.addEventListener('click', () => {
            const now = Date.now();
            if (now - lastFooterClickTime < 3000) footerClickCount++; else footerClickCount = 1;
            lastFooterClickTime = now;
            if (footerClickCount === 5) {
                footerClickCount = 0;
                showDeveloperModePrompt();
            }
        });

        function showDeveloperModePrompt() {
            showAlert("alertDeveloperModePrompt", 'prompt');
        }

        function updateDeveloperModeIndicatorText() {
            if (developerModeIndicator) {
                developerModeIndicator.textContent = translations[currentLang].developerModeIndicatorText;
            }
        }
        
        developerModeIndicator.addEventListener('click', () => {
            isDeveloperMode = false;
            developerModeIndicator.style.display = 'none';
            showAlert("alertDeveloperModeExit");
            loadComments();
            // Hide developer dashboard when exiting dev mode
            developerDashboard.classList.add('hidden');
        });
        
        window.showFullImage = (imageUrl) => {
            fullImage.src = imageUrl;
            fullImageModal.classList.add('active');
        };
        fullImageModal.addEventListener('click', () => fullImageModal.classList.remove('active'));

        // Order Form Logic
        function showOrderModal() {
            orderModal.classList.add('active');
            getGeolocation().then(() => {
                if (userLocation.latitude && userLocation.longitude) {
                    orderGeolocationInput.value = `https://www.google.com/maps/search/?api=1&query=${userLocation.latitude},${userLocation.longitude}`;
                } else {
                    orderGeolocationInput.value = translations[currentLang].locationUnavailable;
                }
            });
        }
        
        function hideOrderModal() {
            orderModal.classList.remove('active');
            orderForm.reset();
            otherServiceField.classList.add('hidden');
            orderFiles = [];
            updateOrderFilePreview();
            orderFileInputText.textContent = translations[currentLang].fileInputChoose;
            orderIpAddressInput.value = '';
        }

        // New function to show the "Order Submitted" modal
        function showOrderSubmittedModal(orderId) {
            document.getElementById('submittedOrderId').textContent = orderId;
            orderSubmittedModal.classList.remove('hidden');
        }
        
        heroOrderNowBtn.addEventListener('click', showOrderModal);
        orderNowNavBtn.addEventListener('click', showOrderModal);
        closeOrderModal.addEventListener('click', hideOrderModal);
        orderModal.addEventListener('click', (e) => {
            if (e.target === orderModal) {
                hideOrderModal();
            }
        });

        // New event listener for the close button on the new modal
        closeOrderSubmittedModal.addEventListener('click', () => {
            orderSubmittedModal.classList.add('hidden');
            // Do not clear the track input so user can easily track their order
            // orderTrackInput.value = document.getElementById('submittedOrderId').textContent;
        });

        orderServiceSelect.addEventListener('change', (e) => {
            if (e.target.value === 'أخرى') {
                otherServiceField.classList.remove('hidden');
                otherServiceText.setAttribute('required', 'required');
            } else {
                otherServiceField.classList.add('hidden');
                otherServiceText.removeAttribute('required');
            }
        });
        
        function updateOrderFilePreview() {
            orderImagesPreview.innerHTML = '';
            if (orderFiles.length > 0) {
                orderFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'relative flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm';
                    
                    const fileNameSpan = document.createElement('span');
                    fileNameSpan.className = 'text-xs truncate';
                    fileNameSpan.textContent = file.name;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-600';
                    removeBtn.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>`;
                    removeBtn.onclick = (e) => {
                        e.preventDefault();
                        orderFiles.splice(index, 1);
                        updateOrderFilePreview();
                    };

                    fileItem.appendChild(fileNameSpan);
                    fileItem.appendChild(removeBtn);
                    orderImagesPreview.appendChild(fileItem);
                });
                orderFileInputText.textContent = `${orderFiles.length} صور`;
            } else {
                orderFileInputText.textContent = translations[currentLang].fileInputChoose;
            }
        }
        
        orderFilesInput.addEventListener('change', (e) => {
            orderFiles = Array.from(e.target.files).filter(file => file.type.startsWith('image/'));
            updateOrderFilePreview();
            orderFilesInput.value = null;
        });

        // Updated Order Form Submission logic to use both Formspree and Firestore
        orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }
            
            submitOrderBtn.disabled = true;
            submitOrderBtn.textContent = '...إرسال';
            
            const ipAddress = await getIPAddress();
            const { device, browser, deviceName } = getDeviceInfo();
            
            let uploadedImageUrls = [];
            if (orderFiles.length > 0) {
                try {
                    const uploadPromises = orderFiles.map(file => {
                        const imgbbFormData = new FormData();
                        imgbbFormData.append("image", file);
                        return fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: imgbbFormData })
                            .then(res => res.json())
                            .then(result => {
                                if (result.success) return result.data.url;
                                throw new Error(result.error.message);
                            });
                    });
                    
                    uploadedImageUrls = await Promise.all(uploadPromises);
                } catch (err) {
                    console.error("Image upload failed:", err);
                    showAlert("imageUploadError");
                    submitOrderBtn.disabled = false;
                    submitOrderBtn.textContent = translations[currentLang].orderSubmitBtn;
                    return;
                }
            }

            // Generate a random 6-digit order ID
            const orderId = Math.floor(100000 + Math.random() * 900000);
            
            // Prepare a message string to be sent via Formspree
            const formspreeMessageText = `
                New Order Received!
                Order ID: ${orderId}
                Name: ${orderForm.elements['name'].value}
                Email: ${orderForm.elements['email'].value}
                Phone: ${orderForm.elements['phone'].value}
                Service: ${orderForm.elements['service'].value === 'أخرى' ? orderForm.elements['other_service'].value : orderForm.elements['service'].value}
                Details: ${orderForm.elements['details'].value}
                Images: ${uploadedImageUrls.join(', ') || 'N/A'}
                IP Address: ${ipAddress}
                Device: ${deviceName}
                Geolocation: ${userLocation.latitude && userLocation.longitude ? `https://www.google.com/maps/search/?api=1&query=${userLocation.latitude},${userLocation.longitude}` : 'N/A'}
            `;
            formspreeMessage.value = formspreeMessageText;

            // Create a FormData object for Formspree
            const formspreeFormData = new FormData(orderForm);
            formspreeFormData.append('_subject', `New Order Request - ID: ${orderId}`);

            try {
                // First, send the email via Formspree
                const formspreeResponse = await fetch(FORMSPREE_ENDPOINT, {
                    method: 'POST',
                    body: formspreeFormData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!formspreeResponse.ok) {
                    throw new Error("Formspree submission failed.");
                }

                // If Formspree is successful, then add the order to Firestore
                const orderData = {
                    orderId: String(orderId),
                    userId,
                    name: orderForm.elements['name'].value,
                    email: orderForm.elements['email'].value,
                    phone: orderForm.elements['phone'].value,
                    service: orderForm.elements['service'].value === 'أخرى' ? orderForm.elements['other_service'].value : orderForm.elements['service'].value,
                    details: orderForm.elements['details'].value,
                    images: uploadedImageUrls,
                    status: 1, // 1: Awaiting Approval, 2: In Progress, 3: Preview, 4: Awaiting Payment, 5: Completed
                    timestamp: serverTimestamp(),
                    ipAddress,
                    device,
                    browser,
                    deviceName,
                    latitude: userLocation.latitude,
                    longitude: userLocation.longitude,
                    previewImages: [],
                };
                await addDoc(collection(db, `artifacts/${appId}/public/data/orders`), orderData);

                hideOrderModal();
                showOrderSubmittedModal(orderId);
            } catch (err) {
                console.error("Error submitting form: ", err);
                showAlert("orderError");
            } finally {
                submitOrderBtn.disabled = false;
                submitOrderBtn.textContent = translations[currentLang].orderSubmitBtn;
            }
        });

        // Order Tracking Logic for Users
        trackOrderBtn.addEventListener('click', async () => {
            const orderNumber = trackOrderInput.value.trim();
            if (orderNumber.length !== 6 || isNaN(orderNumber)) {
                showAlert("orderNotFound");
                return;
            }
            if (!isAuthReady) { showAlert("alertFirebaseNotReady"); return; }

            orderStatusDisplay.classList.add('hidden');
            const q = query(collection(db, `artifacts/${appId}/public/data/orders`), where('orderId', '==', orderNumber));
            
            // Listen for real-time updates on this specific order
            onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    showAlert("orderNotFound");
                    return;
                }
                const order = snapshot.docs[0].data();
                drawProgressBar(order.status);
                displayOrderStatus(order);
            }, (error) => {
                console.error("Error tracking order:", error);
                showAlert("orderTrackError");
            });
        });

        // New function to draw the progress bar using Canvas
        function drawProgressBar(currentStatus) {
            const canvas = progressBarCanvas;
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const numSteps = 5;
            const circleRadius = 15;
            const horizontalPadding = 50; // Padding from the edges of the canvas
            const stepSpacing = (width - horizontalPadding * 2) / (numSteps - 1);
            const lineY = height / 2.5;

            // Clear the canvas
            ctx.clearRect(0, 0, width, height);
            
            const isDarkMode = body.classList.contains('dark');
            const inactiveColor = isDarkMode ? '#4a5568' : '#e2e8f0';
            const activeColor = '#10b981';

            // Draw inactive line (from right to left)
            ctx.beginPath();
            ctx.lineWidth = 4;
            ctx.strokeStyle = inactiveColor;
            ctx.moveTo(width - horizontalPadding, lineY);
            ctx.lineTo(horizontalPadding, lineY);
            ctx.stroke();

            // Draw active line (from right to left)
            ctx.beginPath();
            ctx.strokeStyle = activeColor;
            ctx.lineWidth = 4;
            ctx.moveTo(width - horizontalPadding, lineY);
            // Calculate the end point of the green line (from right to left)
            const endX = width - horizontalPadding - (currentStatus - 1) * stepSpacing;
            ctx.lineTo(endX, lineY);
            ctx.stroke();

            // Draw circles and numbers
            for (let i = 0; i < numSteps; i++) {
                // Calculate position from right to left
                const x = width - horizontalPadding - i * stepSpacing;
                const y = lineY;
                const stepNumber = i + 1;
                const isCurrent = stepNumber === currentStatus;
                const isActive = stepNumber <= currentStatus;

                // Draw outer shadow for active circle
                if (isCurrent) {
                    ctx.beginPath();
                    ctx.arc(x, y, circleRadius + 2, 0, 2 * Math.PI);
                    ctx.fillStyle = 'rgba(16, 185, 129, 0.5)';
                    ctx.fill();
                }

                // Draw circle
                ctx.beginPath();
                ctx.arc(x, y, circleRadius, 0, 2 * Math.PI);
                ctx.fillStyle = isActive ? activeColor : inactiveColor;
                ctx.fill();

                // Draw number
                ctx.fillStyle = isActive ? 'white' : (isDarkMode ? '#cbd5e0' : '#64748b');
                ctx.font = 'bold 16px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(stepNumber, x, y);
            }
        }
        
        function displayOrderStatus(order) {
            orderStatusDisplay.classList.remove('hidden');
            displayedOrderId.textContent = order.orderId;
            const currentStatus = order.status;
            
            // Re-draw the canvas bar
            drawProgressBar(currentStatus);

            progressStepsLabels.forEach(step => {
                const stepNumber = parseInt(step.dataset.step, 10);
                const label = step.querySelector('.progress-label');
                
                label.classList.toggle('active', stepNumber === currentStatus);
            });
            
            // Display preview images if status is 'Preview' (status 3) or higher
            orderPreviewImages.innerHTML = '';
            // New condition to show images from status 3 onwards
            if (currentStatus >= 3 && order.previewImages && order.previewImages.length > 0) {
                orderPreviewImages.classList.remove('hidden');
                order.previewImages.forEach(imageUrl => {
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.alt = translations[currentLang].orderPreviewImagesTitle;
                    img.className = 'order-preview-image';
                    img.onclick = () => window.showFullImage(imageUrl);
                    orderPreviewImages.appendChild(img);
                });
            } else {
                orderPreviewImages.classList.add('hidden');
            }
        }
        
        // Developer Dashboard Logic
        function loadDevOrders() {
            if (!isAuthReady || !isDeveloperMode) {
                developerDashboard.classList.add('hidden');
                return;
            }
            developerDashboard.classList.remove('hidden');
            const q = query(collection(db, `artifacts/${appId}/public/data/orders`));
            
            onSnapshot(q, (snapshot) => {
                let orders = [];
                snapshot.docs.forEach((doc) => {
                    orders.push({ ...doc.data(), id: doc.id });
                });
                orders.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));
                
                devOrdersList.innerHTML = '';
                devLoadingText.classList.add('hidden');
                noOrders.classList.toggle('hidden', orders.length > 0);

                orders.forEach(order => {
                    const orderDate = order.timestamp ? new Date(order.timestamp.toDate()).toLocaleString() : 'N/A';
                    const orderElement = document.createElement('div');
                    orderElement.className = 'card space-y-4';
                    orderElement.innerHTML = `
                        <div>
                            <h4 class="font-bold text-lg text-indigo-500" data-lang-key="devOrderId">${translations[currentLang].devOrderId}</h4>
                            <span class="text-xl font-bold">${order.orderId}</span>
                        </div>
                        <p><strong data-lang-key="devOrderUser">${translations[currentLang].devOrderUser}</strong> ${order.name}</p>
                        <p><strong data-lang-key="devOrderDate">${translations[currentLang].devOrderDate}</strong> ${orderDate}</p>
                        <p><strong data-lang-key="orderServiceLabel">${translations[currentLang].orderServiceLabel}</strong> ${order.service}</p>
                        <p class="text-gray-600 dark:text-gray-400"><strong>${translations[currentLang].orderMessageLabel}</strong> ${order.details}</p>
                        <div class="flex items-center gap-2">
                            <strong data-lang-key="devOrderStatus">${translations[currentLang].devOrderStatus}</strong>
                            <select id="status-select-${order.id}" class="rounded-md shadow-sm p-1 dark:bg-gray-700">
                                <option value="1" ${order.status === 1 ? 'selected' : ''}>${translations[currentLang].status1}</option>
                                <option value="2" ${order.status === 2 ? 'selected' : ''}>${translations[currentLang].status2}</option>
                                <option value="3" ${order.status === 3 ? 'selected' : ''}>${translations[currentLang].status3}</option>
                                <option value="4" ${order.status === 4 ? 'selected' : ''}>${translations[currentLang].status4}</option>
                                <option value="5" ${order.status === 5 ? 'selected' : ''}>${translations[currentLang].status5}</option>
                            </select>
                        </div>
                        <div>
                            <strong data-lang-key="devImagesLabel">${translations[currentLang].devImagesLabel}</strong>
                            <div id="dev-preview-${order.id}" class="grid grid-cols-3 gap-2 mt-2">
                                ${order.previewImages && order.previewImages.length > 0 ? order.previewImages.map(img => `<img src="${img}" class="w-16 h-16 object-cover rounded-md cursor-pointer" onclick="window.showFullImage('${img}')">`).join('') : `<p class="text-sm italic">${translations[currentLang].devNoImages}</p>`}
                            </div>
                            <div class="mt-4">
                                <label class="custom-file-input">
                                    <span data-lang-key="devUploadImages">${translations[currentLang].devUploadImages}</span>
                                    <input type="file" id="dev-image-upload-${order.id}" accept="image/*">
                                </label>
                                <div id="dev-upload-indicator-${order.id}" class="mt-2 text-sm text-gray-500 hidden">...جاري الرفع</div>
                            </div>
                        </div>
                    `;
                    devOrdersList.appendChild(orderElement);

                    // Update status listener
                    document.getElementById(`status-select-${order.id}`).addEventListener('change', async (e) => {
                        try {
                            const newStatus = parseInt(e.target.value, 10);
                            const orderRef = doc(db, `artifacts/${appId}/public/data/orders`, order.id);
                            await updateDoc(orderRef, { status: newStatus });
                        } catch (err) {
                            console.error("Failed to update order status:", err);
                        }
                    });

                    // Image upload listener
                    document.getElementById(`dev-image-upload-${order.id}`).addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;

                        const uploadIndicator = document.getElementById(`dev-upload-indicator-${order.id}`);
                        uploadIndicator.classList.remove('hidden');

                        const formData = new FormData();
                        formData.append("image", file);
                        try {
                            const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
                            const result = await res.json();
                            if (result.success) {
                                const imageUrl = result.data.url;
                                const orderRef = doc(db, `artifacts/${appId}/public/data/orders`, order.id);
                                await updateDoc(orderRef, { previewImages: arrayUnion(imageUrl) });
                                showAlert("imageUploadSuccess");
                            } else {
                                throw new Error(result.error.message);
                            }
                        } catch (err) {
                            console.error("Developer image upload failed:", err);
                            showAlert("imageUploadError");
                        } finally {
                            uploadIndicator.classList.add('hidden');
                        }
                    });
                });
            }, (error) => {
                console.error("Error listening to dev orders:", error);
                devLoadingText.textContent = "فشل تحميل الطلبات.";
                devLoadingText.classList.remove('hidden');
            });
        }

        // Initial setup
        window.onload = function() {
            initFirebase();
            setupStarRating(starRatingInputContainer, commentRatingValue);
            applyDarkMode(localStorage.getItem('darkMode') === 'enabled');
            setLanguage(currentLang);
        }
    </script>
</body>
</html>
